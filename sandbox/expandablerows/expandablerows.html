<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

	<title>Data Table with Expandable Rows</title>
	
	<link rel="stylesheet" type="text/css" href="../../build/fonts/fonts.css">
	<link rel="stylesheet" type="text/css" href="../../build/datatable/assets/skins/sam/datatable.css" />
	<link rel="stylesheet" type="text/css" href="expandablerows.css" />
	<style>
		body{ text-align: left; }
	</style>
	
</head>

<body class=" yui-skin-sam">


<h1>Data Table with Expandable Rows</h1>

<div class="exampleIntro">
	<p>A demonstration of the DataTable's expandable row feature.</p>
			
</div>

<div id="basic"></div>
<script type="text/javascript" src="../../build/yahoo/yahoo.js"></script> 
<script type="text/javascript" src="data.js"></script>
<script type="text/javascript" src="../../build/dom/dom.js"></script> 
<script type="text/javascript" src="../../build/event/event.js"></script>
<script type="text/javascript" src="../../build/dragdrop/dragdrop.js"></script>
<script type="text/javascript" src="../../build/element/element.js"></script> 
<script type="text/javascript" src="../../build/datasource/datasource.js"></script>
<script type="text/javascript" src="../../build/datatable/datatable.js"></script>
<script>
	
	YAHOO.widget.DataTable.prototype.getRecord = function(row) {
		var oRecord = this._oRecordSet.getRecord(row);

		if(!oRecord) {
			// Validate TR element
			var elRow = this.getTrEl(row);
				if(elRow) {
					// This is the line that changed
					oRecord = this._oRecordSet.getRecord(elRow.id);
				 }
		 }

		 if(oRecord instanceof YAHOO.widget.Record) {
				 return this._oRecordSet.getRecord(oRecord);
		 }
		 else {
				 YAHOO.log("Could not get Record for row at " + row, "info", this.toString());
				 return null;
		 }
	};
	
</script>
<script type="text/javascript" src="expandablerows.js"></script>

<script>

YAHOO.util.Event.addListener(window, "load", function() {
		YAHOO.example.Basic = function() {
				var myColumnDefs = [
				
						{
							key:"details",
							label:"",
							formatter:YAHOO.widget.DataTable.formatExpandRowTrigger
						},
						{
							key:"date", 
							formatter:YAHOO.widget.DataTable.formatDate, 
							sortable:true, 
							sortOptions:{
								defaultDir:YAHOO.widget.DataTable.CLASS_DESC
							},
							resizeable:true
						},
						{
							key:"quantity", 
							formatter:YAHOO.widget.DataTable.formatNumber, 
							sortable:true, 
							resizeable:true
						},
						{
							key:"amount", 
							formatter:YAHOO.widget.DataTable.formatCurrency, 
							sortable:true, 
							resizeable:true
						},
						{
							key:"title", 
							sortable:true, 
							resizeable:true
						}
						
				];

				var myDataSource = new YAHOO.util.DataSource(YAHOO.example.Data.bookorders);
				myDataSource.responseType = YAHOO.util.DataSource.TYPE_JSARRAY;
				myDataSource.responseSchema = {
					fields: ["id","date","quantity","amount","title","details"]
				};

				var myDataTable = new YAHOO.widget.DataTable(
					"basic",
					myColumnDefs, 
					myDataSource
				);

				//Init expandable rows
				myDataTable.initExpandableRows( 
					'details', 
					'<img src="{image_url}" />' 
				);
				
				//Set row specific template
				myDataTable.setRowState(
					2,
					'expandable_template',
					'I am indeed a strange row <img src="{image_url}" />'
				);
				
				//Subscribe to a click event to bind to
				myDataTable.subscribe( 'cellClickEvent', function( cell_click, args ){

					if( YAHOO.util.Dom.hasClass( cell_click.target, 'yui-dt-expandablerow-trigger' ) ){
						
						var row = myDataTable.getTrEl(cell_click.target)

						this.toggleRowExpansion( row );

					}

				} );
				
				return {
						oDS: myDataSource,
						oDT: myDataTable
				};
		}();
});

</script>

</body>
</html>