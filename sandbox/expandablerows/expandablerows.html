<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

	<title>Data Table with Expandable Rows</title>
	
	<link rel="stylesheet" type="text/css" href="../../build/fonts/fonts.css">
	<link rel="stylesheet" type="text/css" href="../../build/datatable/assets/skins/sam/datatable.css" />
	<style>
		body{ text-align: left; }
	</style>
	
</head>

<body class=" yui-skin-sam">


<h1>Data Table with Expandable Rows</h1>

<div class="exampleIntro">
	<p>A demonstration of the DataTable's expandable row feature.</p>
			
</div>

<div id="basic"></div>
<script type="text/javascript" src="../../build/yahoo/yahoo.js"></script> 
<script type="text/javascript" src="data.js"></script>
<script type="text/javascript" src="../../build/dom/dom.js"></script> 
<script type="text/javascript" src="../../build/event/event.js"></script>
<script type="text/javascript" src="../../build/dragdrop/dragdrop.js"></script>
<script type="text/javascript" src="../../build/element/element.js"></script> 
<script type="text/javascript" src="../../build/datasource/datasource.js"></script>
<script type="text/javascript" src="../../build/datatable/datatable.js"></script>
<script type="text/javascript" src="../../build/logger/logger.js"></script>

<script type="text/javascript">

//Add prototype methods
YAHOO.lang.augmentObject( 
	YAHOO.widget.DataTable.prototype , 
	{
		_initExpandableRows : function( field ){
			
			//Create state column
			var records = this.getRecordSet().getRecords();
			
			//Augment records
			for( var i=0, l=records.length; l > i; i++ ){
				
				var	record = records[ i ]
						state_object = record.getData( 'yui_dt_state' );
				
				//Create row object if needed
				if( !state_object ){
					
					record.setData( 'yui_dt_state', {} );
					var state_object = record.getData( 'yui_dt_state' );
					
				}
				
				//Set row state
				state_object.expanded = ( record.getData( field ) ) ? false : null //set expanded property to null if no data is available
				
			}//for
			
		},
		
		expandRow : function(){
			
			console.log( 'Augmented!' );
			
		}
	}
);

YAHOO.widget.DataTable.formatExpandRowTrigger = function(el, oRecord, oColumn, oData) {
	
	//TODO: Move this to expand function
	if( !this._er ){
		
		this._er = true;
		
		this._initExpandableRows( oColumn.key );
		
		//Subscribe to a click event to bind to
		this.subscribe( 'rowClickEvent', function(){ console.log(this) } );
		
	}
	
	var	state_object = oRecord.getData( 'yui_dt_state' );
	
	//Marker class for the formatted cell
	YAHOO.util.Dom.addClass(el, 'yui-dt-expandablerow-trigger');
	
	//Set trigger
	if( state_object && state_object.expanded === false ){ //Row is closed
		
		el.innerHTML = "X";
		
	} else if( state_object && state_object.expanded === true ){
		
		el.innerHTML = "L";
		
	}else{
		
		el.innerHTML = "_";
		
	}
	
/*


    //Add click event
    if (!STATE.expandRow.hasClickEvent) {

        this.SATG_DATAGRID.subscribe(
                "TbodyClick",
                function(event, options) {

                    var target = EVENT.getTarget(event.event),
                            rowEl = DOM.getAncestorByTagName(
                                    target,
                                    'tr'
                                    );


                    if (
                            DOM.hasClass(
                                    target,
                                    'yui-expandablerow-trigger'
                                    )
                            ) {

                        this.SATG_DATAGRID.toggleExpandableRow(rowEl);

                        if (DOM.hasClass(target, 'yui-closed')) {

                            DOM.replaceClass(target, 'yui-closed', 'yui-open');

                        } else {

                            DOM.replaceClass(target, 'yui-open', 'yui-closed');

                        }

                    }

                },
        {element:el,state:STATE[ "expandRow" ]},
                this
                );

        STATE.expandRow.hasClickEvent = true;

    }

    //Create custom events in the dataGrid scope
    this.SATG_DATAGRID.createEvent('beforeExpandRow');
    this.SATG_DATAGRID.createEvent('afterExpandRow');
    this.SATG_DATAGRID.createEvent('beforeCollapseRow');
    this.SATG_DATAGRID.createEvent('afterCollapseRow');

    //Apply markup to cell if expandable row data exists
    if (oColumn.formatterOptions && oColumn.formatterOptions.dataField && oRecord.getData()[oColumn.formatterOptions.dataField]) {

        STATE[ "expandRow" ][ 'hasData' ] = true;

        el.innerHTML = GridControl._markupStrings.expandableRowTrigger;

    }

    //Apply marker class to header and body cells
    DOM.addClass(
            [
                DOM.getAncestorByTagName(el, 'td'),
                oColumn.getThEl()
            ],
            GridControl.CLASS_EXPANDABLEROW_TRIGGER_CELL
            );
*/

}


YAHOO.util.Event.addListener(window, "load", function() {
    YAHOO.example.Basic = function() {
        var myColumnDefs = [
        
            {
            	key:"details",
					label:"",
					formatter:YAHOO.widget.DataTable.formatExpandRowTrigger,
					formatterOptions:{
					}
            },
            {
            	key:"date", 
            	formatter:YAHOO.widget.DataTable.formatDate, 
            	sortable:true, 
            	sortOptions:{
            		defaultDir:YAHOO.widget.DataTable.CLASS_DESC
            	},
            	resizeable:true
            },
            {
            	key:"quantity", 
            	formatter:YAHOO.widget.DataTable.formatNumber, 
            	sortable:true, 
            	resizeable:true
            },
            {
            	key:"amount", 
            	formatter:YAHOO.widget.DataTable.formatCurrency, 
            	sortable:true, 
            	resizeable:true
            },
            {
            	key:"title", 
            	sortable:true, 
            	resizeable:true
            }
            
        ];

        var myDataSource = new YAHOO.util.DataSource(YAHOO.example.Data.bookorders);
        myDataSource.responseType = YAHOO.util.DataSource.TYPE_JSARRAY;
        myDataSource.responseSchema = {
            fields: ["id","date","quantity","amount","title","details"]
        };

        var myDataTable = new YAHOO.widget.DataTable(
        	"basic",
            myColumnDefs, 
            myDataSource
        );
                
        return {
            oDS: myDataSource,
            oDT: myDataTable
        };
    }();
});

</script>

</body>
</html>