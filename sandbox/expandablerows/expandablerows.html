<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

	<title>Data Table with Expandable Rows</title>
	
	<link rel="stylesheet" type="text/css" href="../../build/fonts/fonts.css">
	<link rel="stylesheet" type="text/css" href="../../build/datatable/assets/skins/sam/datatable.css" />
	<link type="text/css" rel="stylesheet" href="../../build/logger/assets/skins/sam/logger.css">
	<link rel="stylesheet" type="text/css" href="../../build/yuitest/assets/skins/sam/yuitest.css" />
	<style>
		body{ text-align: left; }
		.yui-log{
			filter:alpha(opacity=50);
			-moz-opacity:0.5;
			-khtml-opacity: 0.5;
			opacity: 0.5;
		}
		.yui-dt-expanded .yui-dt-expandablerow-trigger{
			width:18px;
			height:22px;
			cursor:pointer;
			background:url(http://yui.yahooapis.com/2.7.0/build/treeview/assets/skins/sam/treeview-sprite.gif) 0 -4000px no-repeat;
		}
		.yui-dt-expandablerow-trigger, .yui-dt-collapsed .yui-dt-expandablerow-trigger{
			width:18px;
			height:22px;
			cursor:pointer;
			background:url(http://yui.yahooapis.com/2.7.0/build/treeview/assets/skins/sam/treeview-sprite.gif) 0 -6400px no-repeat;
		}
	</style>
	
</head>

<body class=" yui-skin-sam">

<h1>Data Table with Expandable Rows</h1>

<div class="exampleIntro">
	<p>A demonstration of the DataTable's expandable row feature.</p>
			
</div>

<div id="basic"></div>
<script type="text/javascript" src="../../build/yahoo/yahoo.js"></script> 
<script type="text/javascript" src="data.js"></script>
<script type="text/javascript" src="../../build/dom/dom.js"></script> 
<script type="text/javascript" src="../../build/event/event.js"></script>
<script type="text/javascript" src="../../build/dragdrop/dragdrop.js"></script>
<script type="text/javascript" src="../../build/element/element.js"></script> 
<script type="text/javascript" src="../../build/logger/logger-min.js"></script>
<script type="text/javascript" src="../../build/yuitest/yuitest-min.js"></script>
<script type="text/javascript" src="../../build/datasource/datasource.js"></script>
<script type="text/javascript" src="../../build/datatable/datatable.js"></script>
<script>
	
	YAHOO.widget.DataTable.prototype.getRecord = function(row) {
		var oRecord = this._oRecordSet.getRecord(row);

		if(!oRecord) {
			// Validate TR element
			var elRow = this.getTrEl(row);
				if(elRow) {
					// This is the line that changed
					oRecord = this._oRecordSet.getRecord(elRow.id);
				 }
		 }

		 if(oRecord instanceof YAHOO.widget.Record) {
				 return this._oRecordSet.getRecord(oRecord);
		 }
		 else {
				 YAHOO.log("Could not get Record for row at " + row, "info", this.toString());
				 return null;
		 }
	};
	
</script>
<script type="text/javascript" src="expandablerows.js"></script>

<script>

YAHOO.util.Event.onDOMReady( function() {
		YAHOO.example.Basic = function() {

				var expansionFormatter = function(el, oRecord, oColumn, oData) {

					var	cell_element = this.getTdEl(el),
							state_object = oRecord.getData( STRING_STATENAME ),
							this_static = YAHOO.widget.DataTable.formatExpandRowTrigger;

					//Set trigger
					if( oData ){ //Row is closed

						YAHOO.util.Dom.addClass( cell_element, "yui-dt-expandablerow-trigger" );

					}

				};

				var myColumnDefs = [
				
						{
							key:"image_url",
							label:"",
							formatter:expansionFormatter
						},
						{
							key:"date",
							sortable:true, 
							sortOptions:{
								defaultDir:YAHOO.widget.DataTable.CLASS_DESC
							},
							resizeable:true
						},
						{
							key:"quantity", 
							formatter:YAHOO.widget.DataTable.formatNumber, 
							sortable:true, 
							resizeable:true
						},
						{
							key:"amount", 
							formatter:YAHOO.widget.DataTable.formatCurrency, 
							sortable:true, 
							resizeable:true
						},
						{
							key:"title", 
							sortable:true, 
							resizeable:true
						}
						
				];

				var myDataSource = new YAHOO.util.DataSource(YAHOO.example.Data.bookorders);
				myDataSource.responseType = YAHOO.util.DataSource.TYPE_JSARRAY;
				myDataSource.responseSchema = {
					fields: ["id","date","quantity","amount","title","image_url"]
				};

				YAHOO.widget.DataTable.ExpansionFormatter = function(el, oRecord, oColumn, oData) {

					var cell_element = this.getTdEl(el),
						state_object = oRecord.getData( STRING_STATENAME ),
						this_static = YAHOO.widget.DataTable.formatExpandRowTrigger;

					//Set trigger
					if( oData ){ //Row is closed

						Dom.addClass( cell_element, "yui-dt-expandablerow-trigger" );

					}

				};

				var myDataTable = new YAHOO.widget.DataTable(
					"basic",
					myColumnDefs, 
					myDataSource,
					{ rowExpansionTemplate : '<img src="{image_url}" />' }
				);

				//Subscribe to a click event to bind to
				myDataTable.subscribe( 'cellClickEvent', function( cell_click, args ){

					if( YAHOO.util.Dom.hasClass( cell_click.target, 'yui-dt-expandablerow-trigger' ) ){
						
						//TODO: change this to just target after you normalize
						var row_element = cell_click.target;

						this.toggleRowExpansion( row_element );

					}

				} );
				
				return {
						oDS: myDataSource,
						oDT: myDataTable
				};
		}();
});

</script>
<script type="text/javascript" src="test_expandablerows.js"></script>

</body>
</html>