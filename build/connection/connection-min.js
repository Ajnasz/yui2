YAHOO.util.Connect={_msxml_progid:["Microsoft.XMLHTTP","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP"],_http_headers:{},_has_http_headers:false,_use_default_post_header:true,_default_post_header:"application/x-www-form-urlencoded; charset=UTF-8",_default_form_header:"application/x-www-form-urlencoded",_use_default_xhr_header:true,_default_xhr_header:"XMLHttpRequest",_has_default_headers:true,_default_headers:{},_isFormSubmit:false,_isFileUpload:false,_formNode:null,_sFormData:null,_poll:{},_timeOut:{},_polling_interval:50,_transaction_id:0,_submitElementValue:null,_hasSubmitListener:(function(){if(YAHOO.util.Event){YAHOO.util.Event.addListener(document,"click",function(d){var v=YAHOO.util.Event.getTarget(d);if(v.type&&v.type.toLowerCase()=="submit"){YAHOO.util.Connect._submitElementValue=encodeURIComponent(v.name)+"="+encodeURIComponent(v.value);}});return true;}return false;})(),startEvent:new YAHOO.util.CustomEvent("start"),completeEvent:new YAHOO.util.CustomEvent("complete"),successEvent:new YAHOO.util.CustomEvent("success"),failureEvent:new YAHOO.util.CustomEvent("failure"),uploadEvent:new YAHOO.util.CustomEvent("upload"),abortEvent:new YAHOO.util.CustomEvent("abort"),_customEvents:{onStart:["startEvent","start"],onComplete:["completeEvent","complete"],onSuccess:["successEvent","success"],onFailure:["failureEvent","failure"],onUpload:["uploadEvent","upload"],onAbort:["abortEvent","abort"]},setProgId:function(v){this._msxml_progid.unshift(v);},setDefaultPostHeader:function(v){if(typeof v=="string"){this._default_post_header=v;}else{if(typeof v=="boolean"){this._use_default_post_header=v;}}},setDefaultXhrHeader:function(v){if(typeof v=="string"){this._default_xhr_header=v;}else{this._use_default_xhr_header=v;}},setPollingInterval:function(v){if(typeof v=="number"&&isFinite(v)){this._polling_interval=v;}},createXhrObject:function(Z){var T,v;try{v=new XMLHttpRequest();T={conn:v,tId:Z};}catch(P){for(var d=0;d<this._msxml_progid.length;++d){try{v=new ActiveXObject(this._msxml_progid[d]);T={conn:v,tId:Z};break;}catch(P){}}}finally{return T;}},getConnectionObject:function(v){var P;var T=this._transaction_id;try{if(!v){P=this.createXhrObject(T);}else{P={};P.tId=T;P.isUpload=true;}if(P){this._transaction_id++;}}catch(d){}finally{return P;}},asyncRequest:function(Z,d,T,v){var P=(this._isFileUpload)?this.getConnectionObject(true):this.getConnectionObject();if(!P){return null;}else{if(T&&T.customevents){this.initCustomEvents(P,T);}if(this._isFormSubmit){if(this._isFileUpload){this.uploadFile(P,T,d,v);return P;}if(Z.toUpperCase()=="GET"){if(this._sFormData.length!==0){d+=((d.indexOf("?")==-1)?"?":"&")+this._sFormData;}}else{if(Z.toUpperCase()=="POST"){v=v?this._sFormData+"&"+v:this._sFormData;}}}if(Z.toUpperCase()=="GET"&&(T&&T.cache===false)){d+=((d.indexOf("?")==-1)?"?":"&")+"rnd="+new Date().valueOf().toString();}P.conn.open(Z,d,true);if(this._use_default_xhr_header){if(!this._default_headers["X-Requested-With"]){this.initHeader("X-Requested-With",this._default_xhr_header,true);}}if((Z.toUpperCase()=="POST"&&this._use_default_post_header)&&this._isFormSubmit===false){this.initHeader("Content-Type",this._default_post_header);}if(this._has_default_headers||this._has_http_headers){this.setHeader(P);}this.handleReadyState(P,T);P.conn.send(v||null);if(this._isFormSubmit===true){this.resetFormState();}this.startEvent.fire(P,(T.argument)?T.argument:null);if(P.startEvent){P.startEvent.fire(P,(T.argument)?T.argument:null);}return P;}},initCustomEvents:function(v,P){for(var d in P.customevents){if(this._customEvents[d][0]){v[this._customEvents[d][0]]=new YAHOO.util.CustomEvent(this._customEvents[d][1],(P.scope)?P.scope:null);v[this._customEvents[d][0]].subscribe(P.customevents[d]);}}},handleReadyState:function(d,P){var v=this;if(P&&P.timeout){this._timeOut[d.tId]=window.setTimeout(function(){v.abort(d,P,true);},P.timeout);}this._poll[d.tId]=window.setInterval(function(){if(d.conn&&d.conn.readyState===4){window.clearInterval(v._poll[d.tId]);delete v._poll[d.tId];if(P&&P.timeout){window.clearTimeout(v._timeOut[d.tId]);delete v._timeOut[d.tId];}v.completeEvent.fire(d,(P.argument)?P.argument:null);if(d.completeEvent){d.completeEvent.fire(d,(P.argument)?P.argument:null);}v.handleTransactionResponse(d,P);}},this._polling_interval);},handleTransactionResponse:function(Z,C,v){var P,d;try{if(Z.conn.status!==undefined&&Z.conn.status!==0){P=Z.conn.status;}else{P=13030;}}catch(T){P=13030;}if(P>=200&&P<300||P===1223){d=this.createResponseObject(Z,(C&&C.argument)?C.argument:undefined);if(C&&C.success){if(!C.scope){C.success(d);}else{C.success.apply(C.scope,[d]);}}this.successEvent.fire(d);if(Z.successEvent){Z.successEvent.fire(d);}}else{switch(P){case 12002:case 12029:case 12030:case 12031:case 12152:case 13030:d=this.createExceptionObject(Z.tId,(C&&C.argument)?C.argument:undefined,(v?v:false));if(C&&C.failure){if(!C.scope){C.failure(d);}else{C.failure.apply(C.scope,[d]);}}break;default:d=this.createResponseObject(Z,(C&&C.argument)?C.argument:undefined);if(C&&C.failure){if(!C.scope){C.failure(d);}else{C.failure.apply(C.scope,[d]);}}}this.failureEvent.fire(d);if(Z.failureEvent){Z.failureEvent.fire(d);}}this.releaseObject(Z);d=null;},createResponseObject:function(v,W){var T={};var c={};try{var P=v.conn.getAllResponseHeaders();var C=P.split("\n");for(var Z=0;Z<C.length;Z++){var d=C[Z].indexOf(":");if(d!=-1){c[C[Z].substring(0,d)]=C[Z].substring(d+2);}}}catch(p){}T.tId=v.tId;T.status=(v.conn.status==1223)?204:v.conn.status;T.statusText=(v.conn.status==1223)?"No Content":v.conn.statusText;T.getResponseHeader=c;T.getAllResponseHeaders=P;T.responseText=v.conn.responseText;T.responseXML=v.conn.responseXML;if(typeof W!==undefined){T.argument=W;}return T;},createExceptionObject:function(i,T,v){var C=0;var W="communication failure";var P=-1;var d="transaction aborted";var Z={};Z.tId=i;if(v){Z.status=P;Z.statusText=d;}else{Z.status=C;Z.statusText=W;}if(T){Z.argument=T;}return Z;},initHeader:function(v,T,P){var d=(P)?this._default_headers:this._http_headers;d[v]=T;if(P){this._has_default_headers=true;}else{this._has_http_headers=true;}},setHeader:function(v){if(this._has_default_headers){for(var d in this._default_headers){if(YAHOO.lang.hasOwnProperty(this._default_headers,d)){v.conn.setRequestHeader(d,this._default_headers[d]);}}}if(this._has_http_headers){for(var d in this._http_headers){if(YAHOO.lang.hasOwnProperty(this._http_headers,d)){v.conn.setRequestHeader(d,this._http_headers[d]);}}delete this._http_headers;this._http_headers={};this._has_http_headers=false;}},resetDefaultHeaders:function(){delete this._default_headers;this._default_headers={};this._has_default_headers=false;},setForm:function(x,Z,d){this.resetFormState();var l;if(typeof x=="string"){l=(document.getElementById(x)||document.forms[x]);}else{if(typeof x=="object"){l=x;}else{return ;}}if(Z){var C=this.createFrame(d?d:null);this._isFormSubmit=true;this._isFileUpload=true;this._formNode=l;return ;}var v,c,W,f;var p=false;for(var T=0;T<l.elements.length;T++){v=l.elements[T];f=v.disabled;c=v.name;W=v.value;if(!f&&c){switch(v.type){case "select-one":case "select-multiple":for(var P=0;P<v.options.length;P++){if(v.options[P].selected){if(window.ActiveXObject){this._sFormData+=encodeURIComponent(c)+"="+encodeURIComponent(v.options[P].attributes["value"].specified?v.options[P].value:v.options[P].text)+"&";}else{this._sFormData+=encodeURIComponent(c)+"="+encodeURIComponent(v.options[P].hasAttribute("value")?v.options[P].value:v.options[P].text)+"&";}}}break;case "radio":case "checkbox":if(v.checked){this._sFormData+=encodeURIComponent(c)+"="+encodeURIComponent(W)+"&";}break;case "file":case undefined:case "reset":case "button":break;case "submit":if(p===false){if(this._hasSubmitListener&&this._submitElementValue){this._sFormData+=this._submitElementValue+"&";}else{this._sFormData+=encodeURIComponent(c)+"="+encodeURIComponent(W)+"&";}p=true;}break;default:this._sFormData+=encodeURIComponent(c)+"="+encodeURIComponent(W)+"&";}}}this._isFormSubmit=true;this._sFormData=this._sFormData.substr(0,this._sFormData.length-1);this.initHeader("Content-Type",this._default_form_header);return this._sFormData;},resetFormState:function(){this._isFormSubmit=false;this._isFileUpload=false;this._formNode=null;this._sFormData="";},createFrame:function(v){var d="yuiIO"+this._transaction_id;var P;if(window.ActiveXObject){P=document.createElement("<iframe id=\""+d+"\" name=\""+d+"\" />");if(typeof v=="boolean"){P.src="javascript:false";}else{if(typeof secureURI=="string"){P.src=v;}}}else{P=document.createElement("iframe");P.id=d;P.name=d;}P.style.position="absolute";P.style.top="-1000px";P.style.left="-1000px";document.body.appendChild(P);},appendPostData:function(v){var T=[];var d=v.split("&");for(var P=0;P<d.length;P++){var Z=d[P].indexOf("=");if(Z!=-1){T[P]=document.createElement("input");T[P].type="hidden";T[P].name=d[P].substring(0,Z);T[P].value=d[P].substring(Z+1);this._formNode.appendChild(T[P]);}}return T;},uploadFile:function(T,f,Z,P){var p="yuiIO"+T.tId;var c="multipart/form-data";var l=document.getElementById(p);var r=this;var d={action:this._formNode.getAttribute("action"),method:this._formNode.getAttribute("method"),target:this._formNode.getAttribute("target")};this._formNode.setAttribute("action",Z);this._formNode.setAttribute("method","POST");this._formNode.setAttribute("target",p);if(this._formNode.encoding){this._formNode.setAttribute("encoding",c);}else{this._formNode.setAttribute("enctype",c);}if(P){var x=this.appendPostData(P);}this._formNode.submit();this.startEvent.fire(T,(f.argument)?f.argument:null);if(T.startEvent){T.startEvent.fire(T,(f.argument)?f.argument:null);}if(f&&f.timeout){this._timeOut[T.tId]=window.setTimeout(function(){r.abort(T,f,true);},f.timeout);}if(x&&x.length>0){for(var W=0;W<x.length;W++){this._formNode.removeChild(x[W]);}}for(var v in d){if(YAHOO.lang.hasOwnProperty(d,v)){if(d[v]){this._formNode.setAttribute(v,d[v]);}else{this._formNode.removeAttribute(v);}}}this.resetFormState();var C=function(){if(f&&f.timeout){window.clearTimeout(r._timeOut[T.tId]);delete r._timeOut[T.tId];}r.completeEvent.fire(T,(f.argument)?f.argument:null);if(T.completeEvent){T.completeEvent.fire(T,(f.argument)?f.argument:null);}var o={};o.tId=T.tId;o.argument=f.argument;try{o.responseText=l.contentWindow.document.body?l.contentWindow.document.body.innerHTML:l.contentWindow.document.documentElement.textContent;o.responseXML=l.contentWindow.document.XMLDocument?l.contentWindow.document.XMLDocument:l.contentWindow.document;}catch(i){}if(f&&f.upload){if(!f.scope){f.upload(o);}else{f.upload.apply(f.scope,[o]);}}r.uploadEvent.fire(o);if(T.uploadEvent){T.uploadEvent.fire(o);}YAHOO.util.Event.removeListener(l,"load",C);setTimeout(function(){document.body.removeChild(l);r.releaseObject(T);},100);};YAHOO.util.Event.addListener(l,"load",C);},abort:function(T,C,v){var P;if(T.conn){if(this.isCallInProgress(T)){T.conn.abort();window.clearInterval(this._poll[T.tId]);delete this._poll[T.tId];if(v){window.clearTimeout(this._timeOut[T.tId]);delete this._timeOut[T.tId];}P=true;}}else{if(T.isUpload===true){var d="yuiIO"+T.tId;var Z=document.getElementById(d);if(Z){YAHOO.util.Event.removeListener(Z,"load");document.body.removeChild(Z);if(v){window.clearTimeout(this._timeOut[T.tId]);delete this._timeOut[T.tId];}P=true;}}else{P=false;}}if(P===true){this.abortEvent.fire(T,(C.argument)?C.argument:null);if(T.abortEvent){T.abortEvent.fire(T,(C.argument)?C.argument:null);}this.handleTransactionResponse(T,C,true);}return P;},isCallInProgress:function(d){if(d&&d.conn){return d.conn.readyState!==4&&d.conn.readyState!==0;}else{if(d&&d.isUpload===true){var v="yuiIO"+d.tId;return document.getElementById(v)?true:false;}else{return false;}}},releaseObject:function(v){if(v&&v.conn){v.conn=null;v=null;}}};YAHOO.register("connection",YAHOO.util.Connect,{version:"@VERSION@",build:"@BUILD@"});