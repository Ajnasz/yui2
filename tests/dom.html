<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>DOM Test Suite</title>

<link type="text/css" rel="stylesheet" href="../build/logger/assets/logger.css">
<link type="text/css" rel="stylesheet" href="../build/yuitest/assets/testlogger.css">     

<script type="text/javascript" src="../build/yahoo/yahoo.js"></script>
<script type="text/javascript" src="../build/event/event.js"></script>
<script type="text/javascript" src="../build/dom/dom.js"></script>
<script type="text/javascript" src="../build/logger/logger-min.js"></script>
<script type="text/javascript" src="../build/yuitest/yuitest-beta.js"></script>

<style>
#foo {
    float:left; /* required for getStyle test */
}
</style>

<script type="text/javascript">
(function() {
    var Y = YAHOO.util,
        tool = YAHOO.tool,
        suite = new tool.TestSuite("yuisuite");

    Y.Event.onDOMReady(function() {
        var logger = new YAHOO.tool.TestLogger(null, { height: '80%' });

        suite.add( new tool.TestCase({
            name: 'YAHOO.util.Dom',

            test_get: function() {
                YAHOO.util.Assert.areEqual(document.getElementById('doc'),
                        Y.Dom.get('doc'), 'wrong node returned');

                YAHOO.util.Assert.areEqual(document.getElementById('doc'),
                        Y.Dom.get(document.getElementById('doc')), 'wrong node returned');

                YAHOO.util.ArrayAssert.itemsAreEqual(
                    [ document.getElementById('hd'), document.getElementById('bd') ],
                    Y.Dom.get(['hd', document.getElementById('bd')]), 'wrong node returned');

                YAHOO.util.Assert.areEqual(null, Y.Dom.get('dox'), 'non-existant ID');
            },            

            test_getStyle: function() {
                YAHOO.util.Assert.areEqual('left',
                        Y.Dom.getStyle('foo', 'float'), 'wrong style returned');

                document.getElementById('doc').style.marginBottom = '10px';

                YAHOO.util.Assert.areEqual('10px',
                        Y.Dom.getStyle('doc', 'marginBottom'), 'wrong style returned');
            },            

            test_setStyle: function() {
                Y.Dom.setStyle('ft', 'opacity', 0.5);
                YAHOO.util.Assert.areEqual(Y.Dom.getStyle('ft', 'opacity'),
                        0.5, 'wrong style returned');

                Y.Dom.setStyle('main', 'float', 'none');
                YAHOO.util.Assert.areEqual(Y.Dom.getStyle('main', 'float'),
                        'none', 'wrong style returned');
            },            
            test_hasClass: function() {
                YAHOO.util.Assert.isTrue(Y.Dom.hasClass('lorem-ipsum', 'lorem'),
                        'hasClass failed with existing class');

                YAHOO.util.Assert.isFalse(Y.Dom.hasClass('lorem-ipsum', 'dolor'),
                        'hasClass failed with non-existing class');
            },            

            test_addClass: function() {
                Y.Dom.addClass('main', 'foo');

                YAHOO.util.Assert.areEqual(
                    'foo',
                    document.getElementById('main').className, 
                    'addClass failed to add');

                YAHOO.util.Assert.isFalse(Y.Dom.addClass('main', 'foo'),
                        'addClass should return false if element already hasClass');
            },            

            test_removeClass: function() {
                Y.Dom.removeClass('lorem-ipsum', 'ipsum');
                YAHOO.util.Assert.areEqual('lorem', Y.Dom.get('lorem-ipsum').className,
                        'removeClass failed');

                YAHOO.util.Assert.isFalse(Y.Dom.removeClass('main', 'bar'),
                        'removeClass should return false if class not present');

                YAHOO.util.Assert.isFalse(Y.Dom.removeClass('main'),
                        'removeClass should return false if no class argument');
            },            

            test_replaceClass: function() {
                Y.Dom.replaceClass('lorem-ipsum', 'lorem', 'ipsum');
                YAHOO.util.Assert.areEqual('ipsum', Y.Dom.get('lorem-ipsum').className,
                        'replaceClass failed');

                YAHOO.util.Assert.isFalse(Y.Dom.replaceClass('lorem-ipsum', 'ipsum'),
                        'replaceClass should return false if new class not specified');

                YAHOO.util.Assert.isTrue(Y.Dom.replaceClass('lorem-ipsum', '', 'lorem'),
                        'replaceClass should addClass if old class not specified');

                YAHOO.util.Assert.areEqual('ipsum lorem', Y.Dom.get('lorem-ipsum').className,
                        'replaceClass failed: should addClass if old class not specified');

                YAHOO.util.Assert.isFalse(Y.Dom.replaceClass('lorem-ipsum', 'ipsum', 'ipsum'),
                        'replaceClass should return false if new class and old are equal');

            },            

            test_generateId: function() {
                var header = document.getElementsByTagName('h1')[0];
                Y.Dom.generateId(header);
                YAHOO.util.Assert.areEqual('yui-gen0', header.id,
                        'generateId failed');

                header.id = '';
                Y.Dom.generateId(header, 'foo');
                YAHOO.util.Assert.areEqual('foo1', header.id,
                        'generateId custom prefix not used');

                var main = Y.Dom.get('main');
                Y.Dom.generateId('main');
                YAHOO.util.Assert.areEqual('main', document.getElementById('main').id,
                        'generateId must not wipe out existing IDs');

                YAHOO.util.Assert.areEqual('yui-gen2', Y.Dom.generateId(),
                        'generateId must return an ID when no element(s) provided');

                YAHOO.util.ArrayAssert.itemsAreEqual(['yui-gen3', 'yui-gen4'],
                        Y.Dom.generateId(document.getElementsByTagName('h3')),
                        'generateId failed for multiple elements');

                YAHOO.util.ArrayAssert.itemsAreEqual(['main', 'yui-gen5'],
                        Y.Dom.generateId(['main', null]),
                        'generateId failed for multiple elements');
            },            

            test_isAncestor: function() {
                YAHOO.util.Assert.isTrue(Y.Dom.isAncestor('bd', 'main'),
                        'isAncestor failed for true case');

                YAHOO.util.Assert.isFalse(Y.Dom.isAncestor('main', 'bd'),
                        'isAncestor failed for false case');
            },            

            test_inDocument: function() {
                YAHOO.util.Assert.isTrue(Y.Dom.inDocument('main'),
                        'inDocument failed for true ID case');

                YAHOO.util.Assert.isTrue(Y.Dom.inDocument(document.body),
                        'inDocument failed for true element case');

                var el = document.createElement('div');
                YAHOO.util.Assert.isFalse(Y.Dom.inDocument(el),
                        'inDocument failed for false element case');

                YAHOO.util.Assert.isFalse(Y.Dom.inDocument('fake-id'),
                        'inDocument failed for false ID case');
            },            

            test_batch: function() {
                var nodes = Y.Dom.batch(['hd', 'bd'], function(node) {
                    node.title = 'foobar';
                });

                YAHOO.util.Assert.areEqual('foobar', Y.Dom.get('hd').title,
                        'batch failed for multiple IDs');

                YAHOO.util.Assert.areEqual('foobar', Y.Dom.get('bd').title,
                        'batch failed for multiple IDs');

                Y.Dom.batch('ft', function(node) { node.title = 'barbaz'; } );

                YAHOO.util.Assert.areEqual('barbaz', Y.Dom.get('ft').title,
                        'batch failed for single ID');

                Y.Dom.batch(Y.Dom.get('ft'),
                        function(node) { node.title = 'foobaz'; } );

                YAHOO.util.Assert.areEqual('foobaz', Y.Dom.get('ft').title,
                        'batch failed for single HTMLElement');

                YAHOO.util.Assert.areEqual(0, Y.Dom.batch([], function() { return true; }).length,
                        'batch failed for empty array');

                YAHOO.util.Assert.isFalse(Y.Dom.batch(null), 'batch failed: node(s) required');
                YAHOO.util.Assert.isFalse(Y.Dom.batch([]), 'batch failed: method is required');
            },            

            test_getPreviousSiblingBy: function() {
                var el = Y.Dom.getPreviousSiblingBy(document.getElementById('foo'),
                    function(node) { return node.tagName == 'H2'; }
                );
                YAHOO.util.Assert.areEqual(document.getElementsByTagName('h2')[0],
                        el, 'wrong node returned');
            },            
            test_getPreviousSibling: function() {
                YAHOO.util.Assert.areEqual(Y.Dom.getPreviousSibling('bd'),
                        Y.Dom.get('hd'), 'wrong node returned');
            },            

            test_getNextSiblingBy: function() {
                var el = Y.Dom.getNextSiblingBy(document.getElementById('foo'),
                    function(node) { return node.className == 'mod'; }
                );
                YAHOO.util.Assert.areEqual(Y.Dom.getElementsByClassName('mod', 'div', 'main')[1],
                        el, 'wrong node returned');
            },            

            test_getNextSibling: function() {
                YAHOO.util.Assert.areEqual(Y.Dom.getNextSibling('bd'),
                        Y.Dom.get('ft'), 'wrong node returned');
            },

            test_getFirstChildBy: function() {
                var el = Y.Dom.getFirstChildBy(document.getElementById('doc'),
                    function(node) { return node.id == 'bd'; }
                );
                YAHOO.util.Assert.areEqual(document.getElementById('bd'),
                        el, 'wrong node returned');
            },            

            test_getFirstChild: function() {
                YAHOO.log(Y.Dom.getFirstChild(document.getElementById('doc')).id);
                YAHOO.util.Assert.areEqual(document.getElementById('hd'),
                        Y.Dom.getFirstChild(document.getElementById('doc')), 'wrong node returned');
            },            

            test_getLastChildBy: function() {
                var el = Y.Dom.getLastChildBy(document.getElementById('doc'),
                    function(node) { return node.id == 'bd'; }
                );
                YAHOO.util.Assert.areEqual(document.getElementById('bd'),
                        el, 'wrong node returned');
            },            

            test_getLastChild: function() {
                YAHOO.util.Assert.areEqual(
                    document.getElementById('ft'),
                    Y.Dom.getLastChild(document.getElementById('doc')),
                    'wrong node returned'
                );
            },            
            test_getChildrenBy: function() {
                var el = Y.Dom.getChildrenBy(document.getElementById('main'),
                    function(node) { return node.className == 'mod'; }
                );
                YAHOO.util.ArrayAssert.itemsAreEqual(
                    Y.Dom.getElementsByClassName('mod', 'div', 'main'),
                    el,
                    'wrong node returned'
                );
            },            

            test_getChildren: function() {
                YAHOO.util.ArrayAssert.itemsAreEqual(
                    [ Y.Dom.get('hd'), Y.Dom.get('bd'), Y.Dom.get('ft') ],
                    Y.Dom.getChildren('doc'),
                    'wrong node returned'
                );
            },            
            test_getAttribute: function() {
                YAHOO.util.Assert.areEqual(
                    'search-p',
                    Y.Dom.getAttribute(Y.Dom.get('search').getElementsByTagName('label')[0], 'for'),
                    'wrong node returned'
                );
            }

        })); 
        tool.TestRunner.add(suite);
        tool.TestRunner.run();
    }); 
})();
</script>
<style type="text/css">

</style>
</head>
<body>
    <div id="doc">
        <div id="hd">
            <h1>Page Header</h1>
        </div>
        <div id="bd">
            <div id="main">
                <h2>Section Header</h2>
                <em class="lorem ipsum ipsum" id="lorem-ipsum">lorem ipsum</em>
                <div class="mod" id="foo">
                    <div class="hd">
                        <h3>Module Header</h3>
                    </div>
                    <div class="bd">
                        <p>Fusce feugiat diam. Vestibulum elementum dui in augue. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Mauris pulvinar.</p>
                    </div>
                    <div class="ft"><a href="#">more</a></div>
                </div>
                <div class="mod">
                    <div class="hd">
                        <h3>Module Header</h3>
                    </div>
                    <div class="bd">
                        <form action="#" method="get" id="search">
                            <fieldset>
                                <legend>Search</legend>
                                    <label for="search-p">Query</label>
                                    <input type="text" name="p" id="search-p">
                                    <input type="submit" value="search">
                            </fieldset>
                        </form>
                    </div>
                    <div class="ft"><a href="http://www.developer.yahoo.com">more</a></div>
                </div>
            </div>
        </div>
        <div id="ft">
            <p>In hac habitasse platea dictumst. Sed sit amet ligula vitae justo consequat facilisis. Integer tortor. Integer erat. In hac habitasse platea dictumst. Phasellus convallis quam vitae turpis aliquam lobortis. Aliquam scelerisque condimentum lectus. Proin semper adipiscing leo. Nulla facilisi.</p>
        </div>
    </div>
</body>
</html>
