<?php require_once("titles.inc"); ?>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title><?php writeTitle(); ?></title>

        <?php require_once("styles.inc"); ?>

        <!-- Page-specific styles -->

        <style type="text/css">

            h1 { 

                font-weight:bold; 
                margin:0 0 1em 0;
            }

            body {
            
                padding:1em;
            
            }

            p, ul {

                margin:1em 0;

            }

            h1 em,
            p em,
            #operainstructions li em {

                font-weight:bold;

            }

            #operainstructions {

                list-style-type:square;
                margin-left:2em;

            }

            #dataset {

                border:solid 1px #000;

            }

            #dataset tr.odd {

                background-color:#ccc;
            
            }

            
            #dataset tr.selected {

                background-color:#039;
            
            }
            

            #dataset td {

                border:solid 1px #000;
                padding:.25em .5em;
            
            }

        </style>

        <?php require_once("scripts.inc"); ?>

        <!-- Page-specific script -->

        <script type="text/javascript">

            /*
                 Utility function used to return the parent TR element of the
                 actual node in the "dataset" table that fired the 
                 "contextmenu" event
            */

            function GetTableRowFromEventTarget(p_oNode) {

                if(p_oNode.tagName.toUpperCase() == "TR") {
                
                    return p_oNode;

                }
                else {

                    /*
                         If the target of the event was a child of a TR, 
                         get the parent TR element
                    */

                    do {
    
                        if(p_oNode.tagName.toUpperCase() == "TR") {

                            return p_oNode;                            

                            break;
                        
                        }
    
                    }
                    while((p_oNode = p_oNode.parentNode));
                
                }
            
            }

            
            /*
                 Utility function for triming the extra white space from the 
                 begining and end of a string.
            */

            String.prototype.trim = function() {

                var s = this.replace(/^\s+/, "");
                return s.replace(/\s+$/, "");

            };
            

            // "contentready" handler for the "dataset" table
            
            function onDataSetReady(p_oEvent) {

                var oContextMenuItems = {
                
                    "type1": [
                                "Context Menu 1, Item 1", 
                                {
                                    text: "Context Menu 1, Item 2", 
                                    submenu: { 
                                                id: "submenu1", 
                                                lazyload:true, 
                                                itemdata: ["Context Menu 1 Submenu, Item 1", "Context Menu 1 Submenu, Item 2", "Context Menu 1 Submenu, Item 3", "Context Menu 1 Submenu, Item 4" ] 
                                            } 
                                }, 
                                "Context Menu 1, Item 3", 
                                "Context Menu 1, Item 4"
                            ],

                    "type2": [
                                "Context Menu 2, Item 1", 
                                "Context Menu 2, Item 2", 
                                "Context Menu 2, Item 3", 
                                "Context Menu 2, Item 4", 
                                "Context Menu 2, Item 5", 
                                "Context Menu 2, Item 6", 
                                "Context Menu 2, Item 7", 
                                "Context Menu 2, Item 8", 
                                "Context Menu 2, Item 9", 
                                "Context Menu 2, Item 10"
                            ],

                    "type3": ["Context Menu 3, Item 1", "Context Menu 3, Item 2", "Context Menu 3, Item 3", "Context Menu 3, Item 4"],
                    "type4": ["Context Menu 4, Item 1", "Context Menu 4, Item 2"],
                    "type5": ["Context Menu 5, Item 1", "Context Menu 5, Item 2", "Context Menu 5, Item 3", "Context Menu 5, Item 4", "Context Menu 5, Item 5", "Context Menu 5, Item 6"]
                
                };


                // "beforeshow" event handler for the context menu

                function onContextMenuBeforeShow(p_sType, p_aArgs, p_oMenu) {

                    var oTR = GetTableRowFromEventTarget(this.contextEventTarget),
                        aMenuItems;


                    if(YAHOO.util.Dom.hasClass(oTR, "odd")) {

                        var aClasses = oTR.className.split(" ");

                        aMenuItems = oContextMenuItems[aClasses[0]];
                    
                    }
                    else {
                        
                        aMenuItems = oContextMenuItems[oTR.className.trim()];

                    }

                    this.clearContent();
                    this.addItems(aMenuItems);
                    this.render();

                    YAHOO.util.Dom.addClass(oTR, "selected");
                    
                }


                // "hide" event handler for the context menu

                function onContextMenuHide(p_sType, p_aArgs, p_oMenu) {

                    var oTR = GetTableRowFromEventTarget(this.contextEventTarget);

                    YAHOO.util.Dom.removeClass(oTR, "selected");
                
                }


                // Create the context menu

                var oContextMenu = new YAHOO.widget.ContextMenu("contextmenu", { trigger: "dataset", lazyload:true });
                                    
                
                // Subscribe to the "beforeshow" and "hide" events

                oContextMenu.beforeShowEvent.subscribe(onContextMenuBeforeShow, oContextMenu, true);
                oContextMenu.hideEvent.subscribe(onContextMenuHide, oContextMenu, true);

            }

            YAHOO.util.Event.onContentReady("dataset", onDataSetReady);

        </script>

    </head>
    <body>

        <h1><?php writeTitle(); ?> <em>[<a href="index.html">Examples Home</a>]</em></h1>

        <p>
            When adding context menus to large data structures like a 
            <code>&#60;table&#62;</code> or large list (<code>&#60;ol&#62;</code> 
            or <code>&#60;ul&#62;</code>), it is recommended to bind a single 
            YAHOO.widget.ContextMenu instance to the structure's root element, than to a set 
            of its child nodes (<code>&#60;tr&#62;</code>s or <code>&#60;li&#62;</code>s).
            
            Doing so significantly improves the performance of a web page or 
            application by reducing the number of "contextmenu" event handlers 
            as well as the number of YAHOO.widget.ContextMenu instances in memory.
        </p>

        <p>
            This example demonstrates this technique, as well as how to create 
            a context-sensitive context menu; a context menu whose content 
            changes based on the element that triggered its display.
        </p>

        <p><em>Please Note:</em> Opera users will need to do the following to use this example:</p>

        <ul id="operainstructions">
            <li><em>Opera for Windows:</em>  Hold down the control key and click with the left mouse button.</li>
            <li><em>Opera for OS X:</em>  Hold down the command key (&#8984;) and click with the left mouse button.</li>
        </ul>
    
        <table id="dataset">
<?php

        $nRows = 100;

        $sHTML = "";

        for($i=0; $i<$nRows; $i++) {

            $sHTML .= "<tr class=\"type" . (rand(1, 5));

            if(!($i%2)) {

                $sHTML .= " odd";

            }


            $sHTML .= "\">" .
            "<td>Row " . $i . ", Column 1</td>" .
            "<td>Row " . $i . ", Column 2</td>" .
            "<td>Row " . $i . ", Column 3</td>" .
            "<td>Row " . $i . ", Column 4</td>" .
            "</tr>\r";
        
        }

        echo $sHTML;

?>
        </table>

    </body>
</html>