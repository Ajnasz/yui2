
<html>
<head>
	<title>JavaScript Documentation - menu.js</title>
	<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>

<body>

<div id="header">
	<h1>JavaScript Documentation</h1>
	<h3><a href="./index.html">Yahoo! Menuing Library</a></h3>

	<div class="breadcrumbs">
					
			
			
			
				<a href="./index.html">Yahoo! Menuing Library</a>
				&gt;
				<strong>menu.js</strong>
			
			
			
			
			
			
			
			
			
			
			
		
	</div>
</div>

<div id="body">
	
	
	<div class="nav">
		<div class="module resources">
			<ul class="content">
				<li><a href="overview-tree.html">Tree View</a></li>
				<li><a href="index-all.html">Element Index</a></li>
			</ul>
		</div>
		
		
			<div class="module">
				<h4><a href="./allclasses-noframe.html">Classes</a></h4>
				<ul class="content">
					
						<li>
							<a href="YAHOO.widget.html">
								YAHOO.widget</a>
						</li>
					
						<li>
							<a href="YAHOO.widget.Menu.html">
								YAHOO.widget.Menu</a>
						</li>
					
						<li>
							<a href="YAHOO.widget.MenuItem.html">
								YAHOO.widget.MenuItem</a>
						</li>
					
				</ul>
			</div>
		
		
		
			<div class="module">
				<h4><a href="./overview-summary.html">Files</a></h4>
				<ul class="content">		
					
						<li>
							<a href="overview-summary-menu.js.html">
								menu.js</a>
						</li>
					
						<li>
							<a href="overview-summary-menuitem.js.html">
								menuitem.js</a>
						</li>
					
				</ul>
			</div>
		
	</div>
	
	<div class="main">
			
		
		
			
			   <h2>menu.js</h2>
			
			
				
					
				
				
				
<div class="meta">
	
	
	
	
	
	
	
	
	
	
		
	
	
	
	
	
	
</div>

			
		
		
		
		
			<div class="quick-links">
				<strong>Quick Links:</strong>&nbsp;
				
					
						<a href="#classSummary">Class Summary</a> |
					
					|
				
				
					<a href="#methodSummary">Method Summary</a> |
					<a href="#methodDetails">Method Details</a>
					|
				
				
					<a href="#source">Source Code</a>
				
			</div>
		
			
				<div class="section class summaries">
					 <h3><a name="classSummary">Class Summary</a> <span class="top">[<a href="#top">top</a>]</span></h3>
			
				<div class="content">
					<table border="1" cellpadding="3" cellspacing="0">
						
						<tr>
							<td class="name">
								<a href="YAHOO.widget.Menu.html">YAHOO.widget.Menu</a>
							</td>
							<td class="overview">The Menu class allows you to create menus that can overlay other   elements on the page.</td>
						</tr>
						
					</table>
				</div>
			</div>
		
			<div class="section source">
				<h3><a name="source">Souce Code</a> <span class="top">[<a href="#top">top</a>]</span></h3>
				<pre class="sourceview"><span class="comment">/*
Copyright (c) 2006, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.net/yui/license.txt
*/</span>

<span class="comment">/**
* <span class="attrib">@class</span> The Menu class allows you to create menus that can overlay other 
* elements on the page.
* <span class="attrib">@constructor</span>
* <span class="attrib">@extends</span> YAHOO.widget.Overlay
* <span class="attrib">@base</span> YAHOO.widget.Overlay
* <span class="attrib">@param</span> {String/HTMLElement} p_oElement String id or HTMLElement 
* (either HTMLSelectElement or HTMLDivElement) of the source HTMLElement node.
* <span class="attrib">@param</span> {Object} p_oUserConfig Optional. The configuration object literal 
* containing the configuration that should be set for this Menu. See 
* configuration documentation for more details.
*/</span>
YAHOO.widget.Menu = <span class="reserved">function</span>(p_oElement, p_oUserConfig) {

	<span class="reserved">if</span> (arguments.length &gt; 0) {

		YAHOO.widget.Menu.superclass.constructor.call(
            <span class="reserved">this</span>, 
            p_oElement, 
            p_oUserConfig
        );

	}

};

YAHOO.widget.Menu.<span class="reserved">prototype</span> = new YAHOO.widget.Overlay();
YAHOO.widget.Menu.<span class="reserved">prototype</span>.constructor = YAHOO.widget.Menu;
YAHOO.widget.Menu.superclass = YAHOO.widget.Overlay.<span class="reserved">prototype</span>;
<span class="comment">
// Constants</span>

<span class="comment">/**
* Constant representing the CSS class(es) to be applied to the root 
* HTMLDivElement of the Menu.
* <span class="attrib">@final</span>
* <span class="attrib">@type</span> String
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.CSS_CLASS_NAME = <span class="literal">"yuimenu"</span>;


<span class="comment">/**
* Constant representing the type of MenuItem to instantiate when creating 
* MenuItem instances from parsing the child nodes (either HTMLLIElement, 
* HTMLOptGroupElement or HTMLOptionElement) of the Menu's DOM.  The default 
* is YAHOO.widget.MenuItem.
* <span class="attrib">@final</span>
* <span class="attrib">@type</span> YAHOO.widget.MenuItem
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.MENUITEM_TYPE = null;
<span class="comment">

// Private properties</span>

<span class="comment">/**
* Multi-dimensional array of MenuItem instances.
* <span class="attrib">@private</span>
* <span class="attrib">@type</span> {Array}
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._aMenuItemGroups = null;


<span class="comment">/**
* An array of HTMLUListElements, each of which is the parent node of a MenuItem
* instance's HTMLLIElement node.
* <span class="attrib">@private</span>
* <span class="attrib">@type</span> {Array}
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._aListElements = null;


<span class="comment">/**
* Reference to the Event utility singleton.
* <span class="attrib">@private</span>
* <span class="attrib">@type</span> {YAHOO.util.Event}
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._oEventUtil = YAHOO.util.Event;


<span class="comment">/**
* Reference to the Dom utility singleton.
* <span class="attrib">@private</span>
* <span class="attrib">@type</span> {YAHOO.util.Dom}
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._oDom = YAHOO.util.Dom;


<span class="comment">/**
* Reference to the MenuItem instance the mouse is currently over.
* <span class="attrib">@private</span>
* <span class="attrib">@type</span> {YAHOO.widget.MenuItem}
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._oCurrentMenuItem = null;


<span class="comment">/** 
* The current state of the Menu's "mouseover" event
* <span class="attrib">@private</span>
* <span class="attrib">@type</span> {Boolean}
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._bFiredMouseOverEvent = false;


<span class="comment">/** 
* The current state of the Menu's "mouseout" event
* <span class="attrib">@private</span>
* <span class="attrib">@type</span> {Boolean}
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._bFiredMouseOutEvent = false;
<span class="comment">

// Public properties</span>


<span class="comment">/**
* Reference to the MenuItem instance that has focus.
* <span class="attrib">@private</span>
* <span class="attrib">@type</span> {YAHOO.widget.MenuItem}
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.activeMenuItem = null;


<span class="comment">/**
* Returns the parent MenuItem instance.
* <span class="attrib">@type</span> {YAHOO.widget.MenuItem}
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.parent = null;


<span class="comment">/**
* Returns the HTMLElement (either HTMLSelectElement or HTMLDivElement)
* used create the Menu instance.
* <span class="attrib">@type</span> {HTMLSelectElement/HTMLDivElement}
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.srcElement = null;
<span class="comment">


// Events</span>

<span class="comment">/**
* Fires when the mouse has entered a Menu instance.  Passes back the 
* DOM Event object as an argument.
* <span class="attrib">@type</span> {YAHOO.util.CustomEvent}
* <span class="attrib">@see</span> YAHOO.util.CustomEvent
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.mouseOverEvent = null;


<span class="comment">/**
* Fires when the mouse has left a Menu instance.  Passes back the DOM 
* Event object as an argument.
* <span class="attrib">@type</span> {YAHOO.util.CustomEvent}
* <span class="attrib">@see</span> YAHOO.util.CustomEvent
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.mouseOutEvent = null;


<span class="comment">/**
* Fires when the user mouses down on a Menu instance.  Passes back the 
* DOM Event object as an argument.
* <span class="attrib">@type</span> {YAHOO.util.CustomEvent}
* <span class="attrib">@see</span> YAHOO.util.CustomEvent
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.mouseDownEvent = null;


<span class="comment">/**
* Fires when the user releases a mouse button while the mouse is over 
* a Menu instance.  Passes back the DOM Event object as an argument.
* <span class="attrib">@type</span> {YAHOO.util.CustomEvent}
* <span class="attrib">@see</span> YAHOO.util.CustomEvent
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.mouseUpEvent = null;


<span class="comment">/**
* Fires when the user clicks the on a Menu instance.  Passes back the 
* DOM Event object as an argument.
* <span class="attrib">@type</span> {YAHOO.util.CustomEvent}
* <span class="attrib">@see</span> YAHOO.util.CustomEvent
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.clickEvent = null;


<span class="comment">/**
* Fires when the user presses an alphanumeric key.  Passes back the 
* DOM Event object as an argument.
* <span class="attrib">@type</span> {YAHOO.util.CustomEvent}
* <span class="attrib">@see</span> YAHOO.util.CustomEvent
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.keyPressEvent = null;


<span class="comment">/**
* Fires when the user presses a key.  Passes back the DOM Event 
* object as an argument.
* <span class="attrib">@type</span> {YAHOO.util.CustomEvent}
* <span class="attrib">@see</span> YAHOO.util.CustomEvent
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.keyDownEvent = null;


<span class="comment">/**
* Fires when the user releases a key.  Passes back the DOM Event 
* object as an argument.
* <span class="attrib">@type</span> {YAHOO.util.CustomEvent}
* <span class="attrib">@see</span> YAHOO.util.CustomEvent
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.keyUpEvent = null;


<span class="comment">/**
* The Menu class's initialization method. This method is automatically called 
* by the constructor, and sets up all DOM references for pre-existing markup, 
* and creates required markup if it is not already present.
* <span class="attrib">@param</span> {String/HTMLElement} p_oElement String id or HTMLElement 
* (either HTMLSelectElement or HTMLDivElement) of the source HTMLElement node.
* <span class="attrib">@param</span> {Object} p_oUserConfig The configuration object literal containing 
* the configuration that should be set for this Menu. See configuration 
* documentation for more details.
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.init = <span class="reserved">function</span>(p_oElement, p_oUserConfig) {

    <span class="reserved">if</span>(!<span class="reserved">this</span>.MENUITEM_TYPE) {

        <span class="reserved">this</span>.MENUITEM_TYPE = YAHOO.widget.MenuItem;

    }


    <span class="reserved">this</span>._aMenuItemGroups = [];
    <span class="reserved">this</span>._aListElements = [];


    var oElement;

    <span class="reserved">if</span>(typeof p_oElement == <span class="literal">"string"</span>) {

        oElement = document.getElementById(p_oElement);

    }
    <span class="reserved">else</span> <span class="reserved">if</span>(p_oElement.tagName) {

        oElement = p_oElement;

    }


    <span class="reserved">if</span>(oElement) {

        switch(oElement.tagName) {
    
            case <span class="literal">"DIV"</span>:

                <span class="reserved">if</span>(<span class="reserved">this</span>._oDom.hasClass(oElement, <span class="literal">"yuimenu"</span>)) {

                    <span class="reserved">this</span>.srcElement = oElement;
   
                    <span class="reserved">if</span>(!oElement.id) {

                        <span class="reserved">this</span>._oDom.generateId(oElement);

                    }
 
    
                    <span class="comment">/* 
                        Note that we don't pass the user config in here yet 
                        because we only want it executed once, at the lowest 
                        subclass level.
                    */</span> 
                
                    YAHOO.widget.Menu.superclass.init.call(<span class="reserved">this</span>, oElement.id); 
<span class="comment">    
    
                    // Populate the collection of ULs</span>

                    var oNode = <span class="reserved">this</span>.body.firstChild, 
                        i = 0;

                    do {

                        switch(oNode.tagName) {

                            case <span class="literal">"UL"</span>:

                                <span class="reserved">this</span>._aListElements[i] = oNode;
                                <span class="reserved">this</span>._aMenuItemGroups[i] = [];
                                i++;

                            break;

                        }

                    }
                    <span class="reserved">while</span>((oNode = oNode.nextSibling));


                    <span class="comment">/*
                        Apply the "first" class to the first UL to mimic 
                        the "first-child" psuedo class.
                    */</span>

                    <span class="reserved">if</span>(<span class="reserved">this</span>._aListElements[0]) {

                        <span class="reserved">this</span>._oDom.addClass(<span class="reserved">this</span>._aListElements[0], <span class="literal">"first"</span>);

                    }

                }
    
            break;
    
            case <span class="literal">"SELECT"</span>:
    
                <span class="reserved">this</span>.srcElement = oElement;
    
    
                <span class="comment">/*
                    The source element is not something that we can use 
                    outright, so we need to create a new Overlay
                */</span>
    
                var sId = <span class="reserved">this</span>._oDom.generateId();

                <span class="comment">/* 
                    Note that we don't pass the user config in here yet 
                    because we only want it executed once, at the lowest 
                    subclass level.
                */</span> 
            
                YAHOO.widget.Menu.superclass.init.call(<span class="reserved">this</span>, sId); 

            break;
    
        }

    }
    <span class="reserved">else</span> {

        <span class="comment">/* 
            Note that we don't pass the user config in here yet 
            because we only want it executed once, at the lowest 
            subclass level.
        */</span> 
    
        YAHOO.widget.Menu.superclass.init.call(<span class="reserved">this</span>, p_oElement);

    }

    <span class="reserved">if</span>(<span class="reserved">this</span>.element) {

        <span class="reserved">this</span>._oDom.addClass(<span class="reserved">this</span>.element, <span class="reserved">this</span>.CSS_CLASS_NAME);
<span class="comment">

        // Assign DOM event handlers</span>

        <span class="reserved">this</span>._oEventUtil.addListener(
            <span class="reserved">this</span>.element, 
            <span class="literal">"mouseover"</span>, 
            <span class="reserved">this</span>._onElementMouseOver, 
            <span class="reserved">this</span>,
            true
        );

        <span class="reserved">this</span>._oEventUtil.addListener(
            <span class="reserved">this</span>.element, 
            <span class="literal">"mouseout"</span>, 
            <span class="reserved">this</span>._onElementMouseOut, 
            <span class="reserved">this</span>,
            true
        );

        <span class="reserved">this</span>._oEventUtil.addListener(
            <span class="reserved">this</span>.element, 
            <span class="literal">"mousedown"</span>, 
            <span class="reserved">this</span>._onElementMouseDown, 
            <span class="reserved">this</span>,
            true
        );

        <span class="reserved">this</span>._oEventUtil.addListener(
            <span class="reserved">this</span>.element, 
            <span class="literal">"mouseup"</span>, 
            <span class="reserved">this</span>._onElementMouseUp, 
            <span class="reserved">this</span>,
            true
        );

        <span class="reserved">this</span>._oEventUtil.addListener(
            <span class="reserved">this</span>.element, 
            <span class="literal">"click"</span>, 
            <span class="reserved">this</span>._onElementClick, 
            <span class="reserved">this</span>,
            true
        );

        <span class="reserved">this</span>._oEventUtil.addListener(
            <span class="reserved">this</span>.element, 
            <span class="literal">"keydown"</span>, 
            <span class="reserved">this</span>._onElementKeyDown, 
            <span class="reserved">this</span>,
            true
        );

        <span class="reserved">this</span>._oEventUtil.addListener(
            <span class="reserved">this</span>.element, 
            <span class="literal">"keyup"</span>, 
            <span class="reserved">this</span>._onElementKeyUp, 
            <span class="reserved">this</span>,
            true
        );

        <span class="reserved">this</span>._oEventUtil.addListener(
            <span class="reserved">this</span>.element, 
            <span class="literal">"keypress"</span>, 
            <span class="reserved">this</span>._onElementKeyPress, 
            <span class="reserved">this</span>,
            true
        );
<span class="comment">

        // Create custom events</span>

        var CustomEvent = YAHOO.util.CustomEvent;

        <span class="reserved">this</span>.mouseOverEvent = new CustomEvent(<span class="literal">"mouseOverEvent"</span>, <span class="reserved">this</span>);
        <span class="reserved">this</span>.mouseOutEvent = new CustomEvent(<span class="literal">"mouseOutEvent"</span>, <span class="reserved">this</span>);
        <span class="reserved">this</span>.mouseDownEvent = new CustomEvent(<span class="literal">"mouseDownEvent"</span>, <span class="reserved">this</span>);
        <span class="reserved">this</span>.mouseUpEvent = new CustomEvent(<span class="literal">"mouseUpEvent"</span>, <span class="reserved">this</span>);
        <span class="reserved">this</span>.clickEvent = new CustomEvent(<span class="literal">"clickEvent"</span>, <span class="reserved">this</span>);
        <span class="reserved">this</span>.keyPressEvent = new CustomEvent(<span class="literal">"keyPressEvent"</span>, <span class="reserved">this</span>);
        <span class="reserved">this</span>.keyDownEvent = new CustomEvent(<span class="literal">"keyDownEvent"</span>, <span class="reserved">this</span>);
        <span class="reserved">this</span>.keyUpEvent = new CustomEvent(<span class="literal">"keyUpEvent"</span>, <span class="reserved">this</span>);


        <span class="reserved">if</span>(p_oUserConfig) {
    
            <span class="reserved">this</span>.cfg.applyConfig(p_oUserConfig);
    
        }

        <span class="reserved">if</span>(<span class="reserved">this</span>.srcElement) {

            <span class="reserved">this</span>._initSubTree();

        }

    }

};
<span class="comment">

// Private methods</span>

<span class="comment">/**
* Adds a MenuItem instance to a group of MenuItem instances.
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {Number} p_nGroupIndex Number indicating the group to which
* the MenuItem belongs.
* <span class="attrib">@param</span> {YAHOO.widget.MenuItem} p_oMenuItem The MenuItem instance to be added.
* <span class="attrib">@param</span> {Number} p_nMenuItemIndex Optional. Index at which the MenuItem 
* should be added.
* <span class="attrib">@return</span> The MenuItem that was added to the Menu.
* <span class="attrib">@type</span> YAHOO.widget.MenuItem
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._addMenuItemToGroup = <span class="reserved">function</span>(p_nGroupIndex, p_oMenuItem, p_nMenuItemIndex) {

    <span class="reserved">if</span>(typeof p_nMenuItemIndex == <span class="literal">"number"</span>) {

        var nGroupIndex = typeof p_nGroupIndex == <span class="literal">"number"</span> ? p_nGroupIndex : 0,
            aGroup = <span class="reserved">this</span>._getMenuItemGroup(nGroupIndex);

        <span class="reserved">if</span>(!aGroup) {

            aGroup = <span class="reserved">this</span>._createMenuItemGroup(nGroupIndex);

        }

        var bFirstInsertion = (aGroup.length === 0);


        <span class="reserved">if</span>(aGroup[p_nMenuItemIndex]) {

            aGroup.splice(p_nMenuItemIndex, 0, p_oMenuItem);

        }
        <span class="reserved">else</span> {

            aGroup[p_nMenuItemIndex] = p_oMenuItem;

        }


        var oMenuItem = aGroup[p_nMenuItemIndex];

        <span class="reserved">if</span>(oMenuItem) {

            <span class="reserved">if</span>(bFirstInsertion &amp;&amp; !oMenuItem.element.parentNode) {
    
                <span class="reserved">this</span>._aListElements[nGroupIndex].appendChild(oMenuItem.element);

            }
            <span class="reserved">else</span> {

                <span class="reserved">function</span> getNextMenuItemSibling(p_aArray, p_nStartIndex) {
        
                    <span class="reserved">return</span> p_aArray[p_nStartIndex] || getNextMenuItemSibling(p_aArray, (p_nStartIndex+1));
        
                }


                var oNextMenuItemSibling = getNextMenuItemSibling(aGroup, (p_nMenuItemIndex+1));

                <span class="reserved">if</span>(oNextMenuItemSibling &amp;&amp; !oMenuItem.element.parentNode) {
        
                    <span class="reserved">this</span>._aListElements[nGroupIndex].insertBefore(oMenuItem.element, oNextMenuItemSibling.element);
    
                }

            }


            oMenuItem.parent = <span class="reserved">this</span>;
    
            <span class="reserved">this</span>._subscribeToMenuItemEvents(oMenuItem);

            <span class="reserved">this</span>._subscribeSubMenuToRenderEvent(oMenuItem);
            
            <span class="reserved">this</span>._updateMenuItemProperties(nGroupIndex);
    
            <span class="reserved">return</span> oMenuItem;

        }

    }
    <span class="reserved">else</span> {

        var nGroupIndex = typeof p_nGroupIndex == <span class="literal">"number"</span> ? p_nGroupIndex : 0,
            aGroup = <span class="reserved">this</span>._getMenuItemGroup(nGroupIndex);

        <span class="reserved">if</span>(!aGroup) {

            aGroup = <span class="reserved">this</span>._createMenuItemGroup(nGroupIndex);

        }

        var nMenuItemIndex = aGroup.length;

        aGroup[nMenuItemIndex] = p_oMenuItem;


        var oMenuItem = aGroup[nMenuItemIndex];

        <span class="reserved">if</span>(oMenuItem) {

            <span class="reserved">if</span>(
                !oMenuItem.element.parentNode || 
<span class="comment">
                // Check if the parentNode is a document fragment</span>

                (
                    oMenuItem.element.parentNode &amp;&amp; 
                    oMenuItem.element.parentNode.nodeType == 11
                )
            ) {

                <span class="reserved">this</span>._aListElements[nGroupIndex].appendChild(oMenuItem.element);

            }

            oMenuItem.element.setAttribute(<span class="literal">"groupindex"</span>, nGroupIndex);
            oMenuItem.element.setAttribute(<span class="literal">"index"</span>, nMenuItemIndex);
    
            oMenuItem.parent = <span class="reserved">this</span>;

            oMenuItem.index = nMenuItemIndex;
            oMenuItem.groupIndex = nGroupIndex;
    
            <span class="reserved">this</span>._subscribeToMenuItemEvents(oMenuItem);

            <span class="reserved">this</span>._subscribeSubMenuToRenderEvent(oMenuItem);

            <span class="reserved">if</span>(nMenuItemIndex === 0) {
    
                <span class="reserved">this</span>._oDom.addClass(oMenuItem.element, <span class="literal">"first"</span>);
    
            }
    
            <span class="reserved">return</span> oMenuItem;

        }

    }

};


<span class="comment">/**
* Removes a MenuItem instance from a group of MenuItem instances by index.
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {Number} p_nGroupIndex Number indicating the group to which
* the MenuItem belongs.
* <span class="attrib">@param</span> {Number} p_nMenuItem Number indicating the index of the MenuItem to  
* be removed.
* <span class="attrib">@return</span> The MenuItem instance that was removed.
* <span class="attrib">@type</span> YAHOO.widget.MenuItem
*/</span>    
YAHOO.widget.Menu.<span class="reserved">prototype</span>._removeMenuItemFromGroupByIndex = <span class="reserved">function</span>(p_nGroupIndex, p_nMenuItem) {

    var nGroupIndex = typeof p_nGroupIndex == <span class="literal">"number"</span> ? p_nGroupIndex : 0,
        aGroup = <span class="reserved">this</span>._getMenuItemGroup(nGroupIndex),
        aArray = aGroup.splice(p_nMenuItem, 1),
        oMenuItem = aArray[0];

    <span class="reserved">if</span>(oMenuItem) {
<span class="comment">
        // Update the index and className properties of each member        </span>
        
        <span class="reserved">this</span>._updateMenuItemProperties(nGroupIndex);

        <span class="reserved">if</span>(aGroup.length === 0) {
<span class="comment">
            // Remove the UL from the Menu's DOM</span>

            var oUL = <span class="reserved">this</span>._aListElements[nGroupIndex];

            <span class="reserved">if</span>(<span class="reserved">this</span>.body &amp;&amp; oUL) {

                <span class="reserved">this</span>.body.removeChild(oUL);

            }
<span class="comment">
            // Remove the group from the array of MenuItems</span>

            <span class="reserved">this</span>._aMenuItemGroups.splice(nGroupIndex, 1);
<span class="comment">

            // Remove the UL from the array of ULs</span>

            <span class="reserved">this</span>._aListElements.splice(nGroupIndex, 1);
<span class="comment">

            // Assign the "first" class to the new first UL in the collection</span>

            oUL = <span class="reserved">this</span>._aListElements[0];

            <span class="reserved">if</span>(oUL) {

                <span class="reserved">this</span>._oDom.addClass(oUL, <span class="literal">"first"</span>);

            }            

        }
<span class="comment">

        // Return a reference to the MenuItem instance that was removed</span>
    
        <span class="reserved">return</span> oMenuItem;

    }

};

<span class="comment">/**
* Removes a MenuItem instance from a group of MenuItem instances by reference.
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {Number} p_nGroupIndex Number indicating the group to which
* the MenuItem belongs.
* <span class="attrib">@param</span> {YAHOO.widget.MenuItem} p_oMenuItem The MenuItem to be removed.
* <span class="attrib">@return</span> The MenuItem instance that was removed.
* <span class="attrib">@type</span> YAHOO.widget.MenuItem
*/</span>    
YAHOO.widget.Menu.<span class="reserved">prototype</span>._removeMenuItemFromGroupByValue = <span class="reserved">function</span>(p_nGroupIndex, p_oMenuItem) {

    var aGroup = <span class="reserved">this</span>._getMenuItemGroup(p_nGroupIndex),
        nMenuItems = aGroup.length,
        nMenuItemIndex = -1;

    <span class="reserved">if</span>(nMenuItems &gt; 0) {

        var i = nMenuItems-1;
    
        do {
    
            <span class="reserved">if</span>(aGroup[i] == p_oMenuItem) {
    
                nMenuItemIndex = i;
                break;    
    
            }
    
        }
        <span class="reserved">while</span>(i--);
    
        <span class="reserved">if</span>(nMenuItemIndex &gt; -1) {
    
            <span class="reserved">return</span> <span class="reserved">this</span>._removeMenuItemFromGroupByIndex(p_nGroupIndex, nMenuItemIndex);
    
        }

    }

};


<span class="comment">/**
* Updates the index, groupindex, and className properties of MenuItem instances
* in the specified group. 
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {Number} p_nGroupIndex Number indicating the group of MenuItem
* instances to update.
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._updateMenuItemProperties = <span class="reserved">function</span>(p_nGroupIndex) {

    var aGroup = <span class="reserved">this</span>._getMenuItemGroup(p_nGroupIndex),
        nMenuItems = aGroup.length;

    <span class="reserved">if</span>(nMenuItems &gt; 0) {

        var i = nMenuItems - 1,
            oMenuItem;
<span class="comment">
        // Update the index and className properties of each member        </span>
    
        do {

            <span class="reserved">if</span>(aGroup[i]) {
    
                aGroup[i].index = i;
                aGroup[i].groupIndex = p_nGroupIndex;
                aGroup[i].element.setAttribute(<span class="literal">"groupindex"</span>, p_nGroupIndex);
                aGroup[i].element.setAttribute(<span class="literal">"index"</span>, i);
                <span class="reserved">this</span>._oDom.removeClass(aGroup[i].element, <span class="literal">"first"</span>);

                oMenuItem = aGroup[i];

            }
    
        }
        <span class="reserved">while</span>(i--);


        <span class="reserved">this</span>._oDom.addClass(oMenuItem.element, <span class="literal">"first"</span>);


    }

};


<span class="comment">/**
* Creates a new MenuItem group (array) and it's associated HTMLUlElement node 
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {Number} p_nIndex Number indicating the group to create.
* <span class="attrib">@return</span> A MenuItem group.
* <span class="attrib">@type</span> Array
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._createMenuItemGroup = <span class="reserved">function</span>(p_nIndex) {

    <span class="reserved">if</span>(!<span class="reserved">this</span>._aMenuItemGroups[p_nIndex]) {

        <span class="reserved">this</span>._aMenuItemGroups[p_nIndex] = [];

        var oUL = document.createElement(<span class="literal">"ul"</span>);

        <span class="reserved">this</span>._aListElements[p_nIndex] = oUL;

        <span class="reserved">return</span> <span class="reserved">this</span>._aMenuItemGroups[p_nIndex];

    }

};


<span class="comment">/**
* Returns the MenuItem group at the specified index.
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {Number} p_nIndex Number indicating the index of the MenuItem group to
* be retrieved.
* <span class="attrib">@return</span> An array of MenuItem instances.
* <span class="attrib">@type</span> Array
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._getMenuItemGroup = <span class="reserved">function</span>(p_nIndex) {

    var nIndex = ((typeof p_nIndex == <span class="literal">"number"</span>) ? p_nIndex : 0);

    <span class="reserved">return</span> <span class="reserved">this</span>._aMenuItemGroups[nIndex];

};


<span class="comment">/**
* Adds a subscriber to a Menu instance's renderEvent so submenus are rendered
* once their parent Menu has rendered.
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {YAHOO.widget.MenuItem} p_oMenuItem The MenuItem instance to listen
* for events on.
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._subscribeSubMenuToRenderEvent = <span class="reserved">function</span>(p_oMenuItem) {

    var oSubmenu = p_oMenuItem.cfg.getProperty(<span class="literal">"submenu"</span>);

    <span class="reserved">if</span>(oSubmenu) {

        <span class="reserved">this</span>.renderEvent.subscribe(<span class="reserved">this</span>._onRender, oSubmenu);

    }

};


<span class="comment">/**
* Subscribes a Menu instance to the specified MenuItem instance's Custom Events.
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {YAHOO.widget.MenuItem} p_oMenuItem The MenuItem instance to listen
* for events on.
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._subscribeToMenuItemEvents = <span class="reserved">function</span>(p_oMenuItem) {

    p_oMenuItem.focusEvent.subscribe(
        <span class="reserved">this</span>._onMenuItemFocus, 
        [<span class="reserved">this</span>, p_oMenuItem]
    );

    p_oMenuItem.blurEvent.subscribe(
        <span class="reserved">this</span>._onMenuItemBlur, 
        [<span class="reserved">this</span>, p_oMenuItem]
    );

    p_oMenuItem.cfg.configChangedEvent.subscribe(
        <span class="reserved">this</span>._onMenuItemConfigChange,
        [<span class="reserved">this</span>, p_oMenuItem]
    );

};


<span class="comment">/**
* Iterates the source element's childNodes collection and uses the child 
* nodes to instantiate Menu and MenuItem instances.
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {Array} p_aNode HTML Element
* objects that are direct descendants of the Menu's source element.
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._initSubTree = <span class="reserved">function</span>() {

    switch(<span class="reserved">this</span>.srcElement.tagName) {

        case <span class="literal">"DIV"</span>:

            var nListElements = <span class="reserved">this</span>._aListElements.length,
                i = 0,
                oNode;
    

            do {
    
                oNode = <span class="reserved">this</span>._aListElements[i].firstChild;

                do {

                    switch(oNode.tagName) {
    
                        case <span class="literal">"LI"</span>:
    
                            <span class="reserved">this</span>.addMenuItem(
                                
                                new <span class="reserved">this</span>.MENUITEM_TYPE(
                                    oNode, 
                                    { 
                                        initsubmenus: 
                                            (<span class="reserved">this</span>.cfg.getProperty(<span class="literal">"initsubmenus"</span>))
                                    }
                                ),
                                i
                                
                            );
    
                        break;
    
                    }
    
        
                }
                <span class="reserved">while</span>((oNode = oNode.nextSibling));
    
                i++;
        
            }
            <span class="reserved">while</span>(i&lt;nListElements);

        break;

        case <span class="literal">"SELECT"</span>:

            var oNode = <span class="reserved">this</span>.srcElement.firstChild;

            do {

                switch(oNode.tagName) {

                    case <span class="literal">"OPTGROUP"</span>:
                    case <span class="literal">"OPTION"</span>:

                        <span class="reserved">this</span>.addMenuItem(
                            (
                                new <span class="reserved">this</span>.MENUITEM_TYPE(
                                    oNode, 
                                    { 
                                        initsubmenus: 
                                            (<span class="reserved">this</span>.cfg.getProperty(<span class="literal">"initsubmenus"</span>))
                                    }
                                )
                            )
                        );

                    break;

                }

            }
            <span class="reserved">while</span>((oNode = oNode.nextSibling));

        break;

    }

};
<span class="comment">

// Private DOM event handlers</span>

<span class="comment">/**
* "mouseover" event handler for the Menu's root HTMLDivElement.
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {Event} p_oEvent Event object passed back by the 
* event utility (YAHOO.util.Event).
* <span class="attrib">@param</span> {YAHOO.widget.Menu} p_oMenu The Menu instance corresponding to the 
* HTMLDivElement that fired the event.
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._onElementMouseOver = <span class="reserved">function</span>(p_oEvent, p_oMenu) {

    <span class="comment">/*
        Because Menus can be embedded in eachother, stop the 
        propagation of the event at each Menu instance to make handling 
        the event easier for the user.
    */</span>

    <span class="reserved">this</span>._oEventUtil.stopPropagation(p_oEvent);


    <span class="comment">/*
        Calculate when the mouse has entered the Menu's root HTMLDivElement 
        to make handling the MouseOver event easier for the user.
    */</span>

    var oTarget = <span class="reserved">this</span>._oEventUtil.getTarget(p_oEvent, true);


    <span class="reserved">if</span>(
        (
            oTarget == <span class="reserved">this</span>.element || 
            <span class="reserved">this</span>._oDom.isAncestor(<span class="reserved">this</span>.element, oTarget)
        )  &amp;&amp; 
        !<span class="reserved">this</span>._bFiredMouseOverEvent
    ) {
<span class="comment">
        // Fire the associated custom event</span>

        <span class="reserved">this</span>.mouseOverEvent.fire(p_oEvent);

        <span class="reserved">this</span>._bFiredMouseOverEvent = true;
        <span class="reserved">this</span>._bFiredMouseOutEvent = false;

    }


    <span class="reserved">if</span>(!<span class="reserved">this</span>._oCurrentMenuItem) {

        var oNode = oTarget;
    
        do {

            <span class="reserved">if</span>(
                oNode &amp;&amp; 
                oNode.tagName == <span class="literal">"LI"</span> &amp;&amp; 
                oNode.parentNode.parentNode.parentNode == <span class="reserved">this</span>.element
            ) {

                var nGroupIndex = parseInt(oNode.getAttribute(<span class="literal">"groupindex"</span>), 10),
                    nIndex = parseInt(oNode.getAttribute(<span class="literal">"index"</span>), 10),
                    oMenuItem = <span class="reserved">this</span>._aMenuItemGroups[nGroupIndex][nIndex];

                <span class="reserved">if</span>(oMenuItem &amp;&amp; !oMenuItem.cfg.getProperty(<span class="literal">"disabled"</span>)) {
<span class="comment">
                    // Keep a reference to the MenuItem</span>
    
                    <span class="reserved">this</span>._oCurrentMenuItem = oMenuItem;
<span class="comment">

                    // Fire the associated custom event</span>

                    oMenuItem.mouseOverEvent.fire(p_oEvent);
<span class="comment">            

                    // Deselect the previously active MenuItem</span>

                    <span class="reserved">if</span>(<span class="reserved">this</span>.activeMenuItem &amp;&amp; <span class="reserved">this</span>.activeMenuItem != oMenuItem) {
            
                        <span class="reserved">if</span>(<span class="reserved">this</span>.activeMenuItem.cfg.getProperty(<span class="literal">"selected"</span>)) {
            
                            <span class="reserved">this</span>.activeMenuItem.cfg.setProperty(
                                <span class="literal">"selected"</span>, 
                                false
                            );
                
                        }
            
                    }
<span class="comment">

                    // Select and focus the current MenuItem</span>

                    oMenuItem.cfg.setProperty(<span class="literal">"selected"</span>, true);
            
                    oMenuItem.focus();

                }

                break;

            }

        }
        <span class="reserved">while</span>((oNode = oNode.parentNode));

    }

};


<span class="comment">/**
* "mouseout" event handler for the Menu's root HTMLDivElement.
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {Event} p_oEvent Event object passed back by the 
* event utility (YAHOO.util.Event).
* <span class="attrib">@param</span> {YAHOO.widget.Menu} p_oMenu The Menu instance corresponding to the 
* HTMLDivElement that fired the event.
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._onElementMouseOut = <span class="reserved">function</span>(p_oEvent, p_oMenu) {

    <span class="comment">/*
        Because Menus can be embedded in eachother, stop the 
        propagation of the event at each Menu instance to make handling 
        the event easier for the user.
    */</span>
        
    <span class="reserved">this</span>._oEventUtil.stopPropagation(p_oEvent);


    var oRelatedTarget = <span class="reserved">this</span>._oEventUtil.getRelatedTarget(p_oEvent);

    var bLIMouseOut = true;
    var bMovingToSubmenu = false;

    <span class="reserved">if</span>(<span class="reserved">this</span>._oCurrentMenuItem &amp;&amp; oRelatedTarget) {

        <span class="reserved">if</span>(
            oRelatedTarget == <span class="reserved">this</span>._oCurrentMenuItem.element || 
            <span class="reserved">this</span>._oDom.isAncestor(<span class="reserved">this</span>._oCurrentMenuItem.element, oRelatedTarget)
        ) {

            bLIMouseOut = false;

        }


        var oSubmenu = <span class="reserved">this</span>._oCurrentMenuItem.cfg.getProperty(<span class="literal">"submenu"</span>);

        <span class="reserved">if</span>(
            oSubmenu &amp;&amp; 
            (
                oRelatedTarget == oSubmenu.element ||
                <span class="reserved">this</span>._oDom.isAncestor(oSubmenu.element, oRelatedTarget)
            )
        ) {

            bMovingToSubmenu = true;

        }

    }


    <span class="reserved">if</span>(<span class="reserved">this</span>._oCurrentMenuItem &amp;&amp; (bLIMouseOut || bMovingToSubmenu)) {
<span class="comment">
        // Fire the associated custom event</span>

        <span class="reserved">this</span>._oCurrentMenuItem.mouseOutEvent.fire(p_oEvent);

        <span class="reserved">this</span>._oCurrentMenuItem.cfg.setProperty(<span class="literal">"selected"</span>, false);

        <span class="reserved">this</span>._oCurrentMenuItem = null;

    }


    <span class="reserved">if</span>(
        !<span class="reserved">this</span>._bFiredMouseOutEvent &amp;&amp; 
        (
            !<span class="reserved">this</span>._oDom.isAncestor(<span class="reserved">this</span>.element, oRelatedTarget) ||
            bMovingToSubmenu
        )
    ) {
<span class="comment">
        // Fire the associated custom event</span>

        <span class="reserved">this</span>.mouseOutEvent.fire(p_oEvent);

        <span class="reserved">this</span>._bFiredMouseOutEvent = true;
        <span class="reserved">this</span>._bFiredMouseOverEvent = false;

    }

};


<span class="comment">/**
* "mousedown" event handler for the Menu's root HTMLDivElement.
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {Event} p_oEvent Event object passed back by the 
* event utility (YAHOO.util.Event).
* <span class="attrib">@param</span> {YAHOO.widget.Menu} p_oMenu The Menu instance corresponding to the 
* HTMLDivElement that fired the event.
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._onElementMouseDown = <span class="reserved">function</span>(p_oEvent, p_oMenu) {

    <span class="comment">/*
        Because Menus can be embedded in eachother, stop the 
        propagation of the event at each Menu instance to make handling 
        the event easier for the user.
    */</span>
        
    <span class="reserved">this</span>._oEventUtil.stopPropagation(p_oEvent);


    <span class="comment">/*
        Check if the target was a DOM element that is a part of a 
        MenuItem instance and (if so), fire the associated custom event.
    */</span>    

    var oTarget = <span class="reserved">this</span>._oEventUtil.getTarget(p_oEvent, true),
        oNode = oTarget;

    do {

        <span class="reserved">if</span>(
            oNode &amp;&amp; 
            oNode.tagName == <span class="literal">"LI"</span> &amp;&amp; 
            oNode.parentNode.parentNode.parentNode == <span class="reserved">this</span>.element
        ) {

            var nGroupIndex = parseInt(oNode.getAttribute(<span class="literal">"groupindex"</span>), 10),
                nIndex = parseInt(oNode.getAttribute(<span class="literal">"index"</span>), 10),
                oMenuItem = <span class="reserved">this</span>._aMenuItemGroups[nGroupIndex][nIndex];

            <span class="reserved">if</span>(oMenuItem &amp;&amp; !oMenuItem.cfg.getProperty(<span class="literal">"disabled"</span>)) {
<span class="comment">
                // Fire the associated custom event</span>

                oMenuItem.mouseDownEvent.fire(p_oEvent);

            }

            break;

        }

    }
    <span class="reserved">while</span>((oNode = oNode.parentNode));
<span class="comment">

    // Fire the associated custom event</span>

    <span class="reserved">this</span>.mouseDownEvent.fire(p_oEvent);

};


<span class="comment">/**
* "mouseup" event handler for the Menu's root HTMLDivElement.
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {Event} p_oEvent Event object passed back by the 
* event utility (YAHOO.util.Event).
* <span class="attrib">@param</span> {YAHOO.widget.Menu} p_oMenu The Menu instance corresponding to the 
* HTMLDivElement that fired the event.
*/</span>    
YAHOO.widget.Menu.<span class="reserved">prototype</span>._onElementMouseUp = <span class="reserved">function</span>(p_oEvent, p_oMenu) {

    <span class="comment">/*
        Because Menus can be embedded in eachother, stop the 
        propagation of the event at each Menu instance to make handling 
        the event easier for the user.
    */</span>
        
    <span class="reserved">this</span>._oEventUtil.stopPropagation(p_oEvent);


    <span class="comment">/*
        Check if the target was a DOM element that is a part of a 
        MenuItem instance and (if so), fire the associated custom event.
    */</span>    

    var oTarget = <span class="reserved">this</span>._oEventUtil.getTarget(p_oEvent, true),
        oNode = oTarget;

    do {

        <span class="reserved">if</span>(
            oNode &amp;&amp; 
            oNode.tagName == <span class="literal">"LI"</span> &amp;&amp; 
            oNode.parentNode.parentNode.parentNode == <span class="reserved">this</span>.element
        ) {

            var nGroupIndex = parseInt(oNode.getAttribute(<span class="literal">"groupindex"</span>), 10),
                nIndex = parseInt(oNode.getAttribute(<span class="literal">"index"</span>), 10),
                oMenuItem = <span class="reserved">this</span>._aMenuItemGroups[nGroupIndex][nIndex];

            <span class="reserved">if</span>(oMenuItem &amp;&amp; !oMenuItem.cfg.getProperty(<span class="literal">"disabled"</span>)) {
<span class="comment">
                // Fire the associated custom event</span>

                oMenuItem.mouseUpEvent.fire(p_oEvent);

            }

            break;

        }

    }
    <span class="reserved">while</span>((oNode = oNode.parentNode));
<span class="comment">

    // Fire the associated custom event</span>

    <span class="reserved">this</span>.mouseUpEvent.fire(p_oEvent);

};


<span class="comment">/**
* "click" Event handler for the Menu's root HTMLDivElement.
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {Event} p_oEvent Event object passed back by the 
* event utility (YAHOO.util.Event).
* <span class="attrib">@param</span> {YAHOO.widget.Menu} p_oMenu The Menu instance corresponding to the 
* HTMLDivElement that fired the event.
*/</span>         
YAHOO.widget.Menu.<span class="reserved">prototype</span>._onElementClick = <span class="reserved">function</span>(p_oEvent, p_oMenu) {

    <span class="comment">/*
        Because Menus can be embedded in eachother, stop the 
        propagation of the event at each Menu instance to make handling 
        the event easier for the user.
    */</span>

    var oTarget = <span class="reserved">this</span>._oEventUtil.getTarget(p_oEvent, true);

    <span class="reserved">if</span>(
        oTarget.tagName != <span class="literal">"A"</span> || 
        (oTarget.tagName == <span class="literal">"A"</span> &amp;&amp; oTarget.getAttribute(<span class="literal">"href"</span>) == <span class="literal">"#"</span>)
    ) {

        <span class="comment">/*
            Don't stop propagation of the event for anchors so that Safari
            can follow the URL
        */</span>

        <span class="reserved">this</span>._oEventUtil.stopPropagation(p_oEvent);

    }


    <span class="comment">/*
        Check if the target was a DOM element that is a part of a 
        MenuItem instance and (if so), fire the associated custom event.
    */</span>

    var oNode = oTarget;

    do {

        <span class="reserved">if</span>(
            oNode &amp;&amp; 
            oNode.tagName == <span class="literal">"LI"</span> &amp;&amp; 
            oNode.parentNode.parentNode.parentNode == <span class="reserved">this</span>.element
        ) {

            var nGroupIndex = parseInt(oNode.getAttribute(<span class="literal">"groupindex"</span>), 10),
                nIndex = parseInt(oNode.getAttribute(<span class="literal">"index"</span>), 10),
                oMenuItem = <span class="reserved">this</span>._aMenuItemGroups[nGroupIndex][nIndex];

            <span class="reserved">if</span>(oMenuItem &amp;&amp; !oMenuItem.cfg.getProperty(<span class="literal">"disabled"</span>)) {
<span class="comment">
                // Fire the associated custom event</span>

                oMenuItem.clickEvent.fire(p_oEvent);    

                var sURL = oMenuItem.cfg.getProperty(<span class="literal">"url"</span>);

                <span class="reserved">if</span>(oTarget.tagName == <span class="literal">"A"</span> &amp;&amp; sURL &amp;&amp; sURL.substr((sURL.length-1),1) == <span class="literal">"#"</span>) {
<span class="comment">
                    // Prevent the browser from following the link</span>
    
                    <span class="reserved">this</span>._oEventUtil.preventDefault(p_oEvent);

                }
                <span class="reserved">else</span> {

                    var oSubmenu = oMenuItem.cfg.getProperty(<span class="literal">"submenu"</span>);

                    <span class="reserved">if</span>(oTarget == oMenuItem.subMenuIndicator &amp;&amp; oSubmenu) {
        
                        <span class="reserved">if</span>(oSubmenu.cfg.getProperty(<span class="literal">"visible"</span>)) {
            
                            oSubmenu.hide();
            
                            oMenuItem.focus();
            
                        }
                        <span class="reserved">else</span> {
            
                            oMenuItem.cfg.setProperty(<span class="literal">"selected"</span>, true);
                            
                            oSubmenu.show();
            
                            oSubmenu.setInitialSelection();
                            oSubmenu.setInitialFocus();
            
                        }                
        
                    }
                    <span class="reserved">else</span> <span class="reserved">if</span>(sURL &amp;&amp; sURL.substr((sURL.length-1),1) != <span class="literal">"#"</span>) {
                        
                        document.location = sURL;

                    }

                }

            }

            break;

        }

    }
    <span class="reserved">while</span>((oNode = oNode.parentNode));
<span class="comment">

    // Fire the associated custom event</span>

    <span class="reserved">this</span>.clickEvent.fire(p_oEvent);

};


<span class="comment">/**
* "keydown" Event handler for the Menu's root HTMLDivElement.
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {Event} p_oEvent Event object passed back by the 
* event utility (YAHOO.util.Event).
* <span class="attrib">@param</span> {YAHOO.widget.Menu} p_oMenu The Menu instance corresponding to the 
* HTMLDivElement that fired the event.
*/</span>         
YAHOO.widget.Menu.<span class="reserved">prototype</span>._onElementKeyDown = <span class="reserved">function</span>(p_oEvent, p_oMenu) {

    <span class="comment">/*
        Because Menus can be embedded in eachother, stop the 
        propagation of the event at each Menu instance to make handling 
        the event easier for the user.
    */</span>

    <span class="reserved">this</span>._oEventUtil.stopPropagation(p_oEvent);


    <span class="comment">/*
        Check if the target was a DOM element that is a part of a 
        MenuItem instance and (if so), fire the associated custom event.
    */</span>

    var oTarget = <span class="reserved">this</span>._oEventUtil.getTarget(p_oEvent, true);

    <span class="reserved">if</span>(
        oTarget.tagName == <span class="literal">"A"</span> &amp;&amp; 
        oTarget.parentNode.parentNode.parentNode.parentNode == <span class="reserved">this</span>.element
    ) {

        var nGroupIndex = parseInt(oTarget.parentNode.getAttribute(<span class="literal">"groupindex"</span>), 10),
            nIndex = parseInt(oTarget.parentNode.getAttribute(<span class="literal">"index"</span>), 10),
            oMenuItem = <span class="reserved">this</span>._aMenuItemGroups[nGroupIndex][nIndex];

        <span class="reserved">if</span>(oMenuItem &amp;&amp; !oMenuItem.cfg.getProperty(<span class="literal">"disabled"</span>)) {
<span class="comment">
            // Fire the associated custom event</span>

            oMenuItem.keyDownEvent.fire(p_oEvent);

        }

    }
<span class="comment">

    // Fire the associated custom event</span>

    <span class="reserved">this</span>.keyDownEvent.fire(p_oEvent);

};


<span class="comment">/**
* "keyup" Event handler for the Menu's root HTMLDivElement.
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {Event} p_oEvent Event object passed back by the 
* event utility (YAHOO.util.Event).
* <span class="attrib">@param</span> {YAHOO.widget.Menu} p_oMenu The Menu instance corresponding to the 
* HTMLDivElement that fired the event.
*/</span>         
YAHOO.widget.Menu.<span class="reserved">prototype</span>._onElementKeyUp = <span class="reserved">function</span>(p_oEvent, p_oMenu) {

    <span class="comment">/*
        Because Menus can be embedded in eachother, stop the 
        propagation of the event at each Menu instance to make handling 
        the event easier for the user.
    */</span>

    <span class="reserved">this</span>._oEventUtil.stopPropagation(p_oEvent);


    <span class="comment">/*
        Check if the target was a DOM element that is a part of a 
        MenuItem instance and (if so), fire the associated custom event.
    */</span>

    var oTarget = <span class="reserved">this</span>._oEventUtil.getTarget(p_oEvent, true);

    <span class="reserved">if</span>(
        oTarget.tagName == <span class="literal">"A"</span> &amp;&amp; 
        oTarget.parentNode.parentNode.parentNode.parentNode == <span class="reserved">this</span>.element
    ) {

        var nGroupIndex = parseInt(oTarget.parentNode.getAttribute(<span class="literal">"groupindex"</span>), 10),
            nIndex = parseInt(oTarget.parentNode.getAttribute(<span class="literal">"index"</span>), 10),
            oMenuItem = <span class="reserved">this</span>._aMenuItemGroups[nGroupIndex][nIndex];

        <span class="reserved">if</span>(oMenuItem &amp;&amp; !oMenuItem.cfg.getProperty(<span class="literal">"disabled"</span>)) {
<span class="comment">
            // Fire the associated custom event</span>

            oMenuItem.keyUpEvent.fire(p_oEvent);

        }

    }
<span class="comment">

    // Fire the associated custom event</span>

    <span class="reserved">this</span>.keyUpEvent.fire(p_oEvent);

};


<span class="comment">/**
* "keypress" Event handler for the Menu's root HTMLDivElement.
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {Event} p_oEvent Event object passed back by the 
* event utility (YAHOO.util.Event).
* <span class="attrib">@param</span> {YAHOO.widget.Menu} p_oMenu The Menu instance corresponding to the 
* HTMLDivElement that fired the event.
*/</span>         
YAHOO.widget.Menu.<span class="reserved">prototype</span>._onElementKeyPress = <span class="reserved">function</span>(p_oEvent, p_oMenu) {

    <span class="comment">/*
        Because Menus can be embedded in eachother, stop the 
        propagation of the event at each Menu instance to make handling 
        the event easier for the user.
    */</span>

    <span class="reserved">this</span>._oEventUtil.stopPropagation(p_oEvent);


    <span class="comment">/*
        Check if the target was a DOM element that is a part of a 
        MenuItem instance and (if so), fire the associated custom event.
    */</span>

    var oTarget = <span class="reserved">this</span>._oEventUtil.getTarget(p_oEvent, true);

    <span class="reserved">if</span>(
        oTarget.tagName == <span class="literal">"A"</span> &amp;&amp; 
        oTarget.parentNode.parentNode.parentNode.parentNode == <span class="reserved">this</span>.element
    ) {

        var nGroupIndex = parseInt(oTarget.parentNode.getAttribute(<span class="literal">"groupindex"</span>), 10),
            nIndex = parseInt(oTarget.parentNode.getAttribute(<span class="literal">"index"</span>), 10),
            oMenuItem = <span class="reserved">this</span>._aMenuItemGroups[nGroupIndex][nIndex];

        <span class="reserved">if</span>(oMenuItem &amp;&amp; !oMenuItem.cfg.getProperty(<span class="literal">"disabled"</span>)) {
<span class="comment">
            // Fire the associated custom event</span>

            oMenuItem.keyPressEvent.fire(p_oEvent);

        }

    }
<span class="comment">

    // Fire the associated custom event</span>

    <span class="reserved">this</span>.keyPressEvent.fire(p_oEvent);

};
<span class="comment">

// Private CustomEvent handlers</span>

<span class="comment">/**
* "render" YAHOO.util.CustomEvent handler for a Menu instance.  Calls the 
* render method of a Menu instance's submenus.
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {String} p_sType The name of the event that was fired.
* <span class="attrib">@param</span> {Array} p_aArguments Collection of arguments sent when the event 
* was fired.
* <span class="attrib">@param</span> {YAHOO.widget.Menu} p_oMenu The submenu instance to be rendered.
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._onRender = <span class="reserved">function</span>(p_sType, p_aArguments, p_oMenu) {

    p_oMenu.render(p_oMenu.parent.element);

};


<span class="comment">/**
* "focus" YAHOO.util.CustomEvent handler for the Menu's
* MenuItem instance(s).
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {String} p_sType The name of the event that was fired.
* <span class="attrib">@param</span> {Array} p_aArguments Collection of arguments sent when the event 
* was fired.
* <span class="attrib">@param</span> {Array} p_aObjects Array containing the current Menu instance and the 
* MenuItem instance that fired the event.
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._onMenuItemFocus = <span class="reserved">function</span>(p_sType, p_aArguments, p_aObjects) {

    var me = p_aObjects[0],
        oMenuItem = p_aObjects[1];

    me.activeMenuItem = oMenuItem;

};


<span class="comment">/**
* "blur" YAHOO.util.CustomEvent handler for the Menu's
* MenuItem instance(s).
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {String} p_sType The name of the event that was fired.
* <span class="attrib">@param</span> {Array} p_aArguments Collection of arguments sent when the event 
* was fired.
* <span class="attrib">@param</span> {Array} p_aObjects Array containing the current Menu instance and the 
* MenuItem instance that fired the event.
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._onMenuItemBlur = <span class="reserved">function</span>(p_sType, p_aArguments, p_aObjects) {

    var me = p_aObjects[0],
        oMenuItem = p_aObjects[1],
        oSubmenu = oMenuItem.cfg.getProperty(<span class="literal">"submenu"</span>);

    <span class="reserved">if</span>(!oSubmenu || (oSubmenu &amp;&amp; !oSubmenu.cfg.getProperty(<span class="literal">"visible"</span>))) {

        me.activeMenuItem = null;

    }

};


<span class="comment">/**
* "configchange" YAHOO.util.CustomEvent handler for the Menu's 
* MenuItem instance(s).
* <span class="attrib">@private</span>
* <span class="attrib">@param</span> {String} p_sType The name of the event that was fired.
* <span class="attrib">@param</span> {Array} p_aArguments Collection of arguments sent when the 
* event was fired.
* <span class="attrib">@param</span> {Array} p_aObjects Array containing the current Menu instance and the 
* MenuItem instance that fired the event.
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>._onMenuItemConfigChange = <span class="reserved">function</span>(p_sType, p_aArguments, p_aObjects) {

    var sProperty = p_aArguments[0][0],
        me = p_aObjects[0],
        oMenuItem = p_aObjects[1];

    switch(sProperty) {

        case <span class="literal">"submenu"</span>:

            var oSubmenu = p_aArguments[0][1];

            <span class="reserved">if</span>(oSubmenu) {

                me._subscribeSubMenuToRenderEvent(oMenuItem);

            }

        break;

        case <span class="literal">"text"</span>:
        case <span class="literal">"helptext"</span>:

            <span class="comment">/*
                A change to a MenuItem instance's "text" or "helptext"
                configuration properties requires the width of the parent
                Menu instance to be recalculated.
            */</span>

            <span class="reserved">if</span>(me.element.style.width) {

                var oClone = me.element.cloneNode(true);
    
                me._oDom.setStyle(oClone, <span class="literal">"width"</span>, <span class="literal">""</span>);
    
                document.body.appendChild(oClone);
    
                var sWidth = oClone.offsetWidth + <span class="literal">"px"</span>;

                me._oDom.setStyle(me.element, <span class="literal">"width"</span>, sWidth);
    
                document.body.removeChild(oClone);

            }

        break;

    }

};
<span class="comment">


// Public methods</span>

<span class="comment">/**
* Appends the specified MenuItem instance to a Menu instance.
* <span class="attrib">@param</span> {YAHOO.widget.MenuItem} p_oMenuItem MenuItem instance to be added.
* <span class="attrib">@param</span> {Number} p_nGroupIndex Optional. Number indicating the group to which
* the MenuItem belongs.
* <span class="attrib">@return</span> The MenuItem that was added to the Menu.
* <span class="attrib">@type</span> YAHOO.widget.MenuItem
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.addMenuItem = <span class="reserved">function</span>(p_oMenuItem, p_nGroupIndex) {

    <span class="reserved">if</span>(p_oMenuItem &amp;&amp; p_oMenuItem instanceof YAHOO.widget.MenuItem) {

        <span class="reserved">return</span> <span class="reserved">this</span>._addMenuItemToGroup(p_nGroupIndex, p_oMenuItem);

    }

};


<span class="comment">/**
* Inserts a MenuItem instance into a Menu instance at the specified index.
* <span class="attrib">@param</span> {YAHOO.widget.MenuItem} p_oMenuItem MenuItem instance to be inserted.
* <span class="attrib">@param</span> {Number} p_nMenuItemIndex Number indicating the ordinal position 
* at which the MenuItem should be added.
* <span class="attrib">@param</span> {Number} p_nGroupIndex Optional. Number indicating the group to which
* the MenuItem instance belongs.
* <span class="attrib">@return</span> The MenuItem that was inserted into the Menu.
* <span class="attrib">@type</span> YAHOO.widget.MenuItem
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.insertMenuItem = <span class="reserved">function</span>(p_oMenuItem, p_nMenuItemIndex, p_nGroupIndex) {

    <span class="reserved">if</span>(p_oMenuItem &amp;&amp; p_oMenuItem instanceof YAHOO.widget.MenuItem) {

        <span class="reserved">return</span> <span class="reserved">this</span>._addMenuItemToGroup(p_nGroupIndex, p_oMenuItem, p_nMenuItemIndex);

    }

};


<span class="comment">/**
* Removes the specified MenuItem instance from a Menu instance.
* <span class="attrib">@param</span> {YAHOO.widget.MenuItem/Number} p_oObject MenuItem or index of the
* MenuItem instance to be removed.
* <span class="attrib">@param</span> {Number} p_nGroupIndex Optional. Number indicating the group to which
* the MenuItem belongs.
* <span class="attrib">@return</span> The MenuItem that was removed from the Menu.
* <span class="attrib">@type</span> YAHOO.widget.MenuItem
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.removeMenuItem = <span class="reserved">function</span>(p_oObject, p_nGroupIndex) {

    <span class="reserved">if</span>(typeof p_oObject != <span class="literal">"undefined"</span>) {

        var oMenuItem;

        <span class="reserved">if</span>(p_oObject instanceof YAHOO.widget.MenuItem) {

            oMenuItem = <span class="reserved">this</span>._removeMenuItemFromGroupByValue(p_nGroupIndex, p_oObject);           

        }
        <span class="reserved">else</span> <span class="reserved">if</span>(typeof p_oObject == <span class="literal">"number"</span>) {

            oMenuItem = <span class="reserved">this</span>._removeMenuItemFromGroupByIndex(p_nGroupIndex, p_oObject);

        }

        <span class="reserved">if</span>(oMenuItem) {

            oMenuItem.destroy();

            <span class="reserved">return</span> oMenuItem;

        }

    }

};


<span class="comment">/**
* Returns a multi-dimensional array of all of a Menu's MenuItem instances.
* <span class="attrib">@return</span> An array of MenuItem instances.
* <span class="attrib">@type</span> Array
*/</span>        
YAHOO.widget.Menu.<span class="reserved">prototype</span>.getMenuItemGroups = <span class="reserved">function</span>() {

    <span class="reserved">return</span> <span class="reserved">this</span>._aMenuItemGroups;

};


<span class="comment">/**
* Returns the MenuItem instance at the specified index.
* <span class="attrib">@param</span> {Number} p_nMenuItemIndex Number indicating the ordinal position of the 
* MenuItem instance to be retrieved.
* <span class="attrib">@param</span> {Number} p_nGroupIndex Optional. Number indicating the group to which
* the MenuItem belongs.
* <span class="attrib">@return</span> A MenuItem instance.
* <span class="attrib">@type</span> YAHOO.widget.MenuItem
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.getMenuItem = <span class="reserved">function</span>(p_nMenuItemIndex, p_nGroupIndex) {

    <span class="reserved">if</span>(typeof p_nMenuItemIndex == <span class="literal">"number"</span>) {

        var aGroup = <span class="reserved">this</span>._getMenuItemGroup(p_nGroupIndex);

        <span class="reserved">if</span>(aGroup) {

            <span class="reserved">return</span> aGroup[p_nMenuItemIndex];
        
        }

    }

};


<span class="comment">/**
* Renders the Menu by inserting the elements that are not already in the 
* main Module format into their correct places. Optionally appends the 
* Menu to the specified node prior to the render's execution.
* <span class="attrib">@param</span> {String/HTMLElement} p_oAppendToNode The element or element id to 
* that the Module should be appended to prior to rendering.
* <span class="attrib">@param</span> {Boolean} p_bHideSourceElement Boolean indicating if the source
* element should be hidden rather than destroyed. Default is false.
* <span class="attrib">@see</span> YAHOO.widget.Module#render
*/</span>    
YAHOO.widget.Menu.<span class="reserved">prototype</span>.render = <span class="reserved">function</span>(p_oAppendToNode, p_bHideSourceElement) {

    <span class="reserved">this</span>.beforeRenderEvent.fire();


    <span class="comment">/*
        Append all of the HTMLUListElement nodes (and their child HTMLLIElement)
        nodes to the body of the module.
    */</span>

    var nListElements = <span class="reserved">this</span>._aListElements.length;

    <span class="reserved">if</span>(nListElements &gt; 0) {

        var i = 0, 
            bFirstList = true;

        do {

            <span class="reserved">if</span>(<span class="reserved">this</span>._aListElements[i]) {

                <span class="reserved">if</span>(bFirstList) {
        
                    <span class="reserved">this</span>._oDom.addClass(<span class="reserved">this</span>._aListElements[i], <span class="literal">"first"</span>);
                    bFirstList = false;
        
                }

                <span class="reserved">if</span>(
                    !<span class="reserved">this</span>._aListElements[i].parentNode ||
<span class="comment">
                    // Check if the parentNode is a document fragment</span>

                    (
                        <span class="reserved">this</span>._aListElements[i].parentNode &amp;&amp; 
                        <span class="reserved">this</span>._aListElements[i].parentNode.nodeType == 11
                    )
                ) {

                    <span class="reserved">this</span>.appendToBody(<span class="reserved">this</span>._aListElements[i]);

                }

            }

            i++;

        }
        <span class="reserved">while</span>(i &lt; nListElements);

    }
<span class="comment">

    // Need to get everything into the DOM if it isn't already</span>
    
    <span class="reserved">if</span>((!<span class="reserved">this</span>.childNodesInDOM[0]) &amp;&amp; <span class="reserved">this</span>.header) {
<span class="comment">
        // There is a header, but it's not in the DOM yet... need to add it</span>
        var firstChild = <span class="reserved">this</span>.element.firstChild;

        <span class="reserved">if</span>(firstChild) { // Insert before first child <span class="reserved">if</span> exists

            <span class="reserved">this</span>.element.insertBefore(<span class="reserved">this</span>.header, firstChild);

        } <span class="reserved">else</span> { // Append to empty body because there are no children

            <span class="reserved">this</span>.element.appendChild(<span class="reserved">this</span>.header);

        }

    }


    <span class="reserved">if</span>((!<span class="reserved">this</span>.childNodesInDOM[1]) &amp;&amp; <span class="reserved">this</span>.body) {
<span class="comment">
        // There is a body, but it's not in the DOM yet... need to add it</span>

        <span class="reserved">if</span>(<span class="reserved">this</span>.childNodesInDOM[2]) { // Insert before footer <span class="reserved">if</span> exists in DOM

            <span class="reserved">this</span>.element.insertBefore(<span class="reserved">this</span>.body, <span class="reserved">this</span>.childNodesInDOM[2]);

        } <span class="reserved">else</span> { // Append to element because there is no footer

            <span class="reserved">this</span>.element.appendChild(<span class="reserved">this</span>.body);

        }

    }


    <span class="reserved">if</span>((!<span class="reserved">this</span>.childNodesInDOM[2]) &amp;&amp; <span class="reserved">this</span>.footer) {
<span class="comment">
        // There is a footer, but it's not in the DOM yet... need to add it</span>
        <span class="reserved">this</span>.element.appendChild(<span class="reserved">this</span>.footer);

    }


    var me = <span class="reserved">this</span>;
    
    <span class="reserved">function</span> appendTo(element) {

        <span class="reserved">if</span> (typeof element == <span class="literal">"string"</span>) {
            element = document.getElementById(element);
        }
        
        <span class="reserved">if</span> (element) {
            element.appendChild(me.element);
            me.appendEvent.fire();
        }

    }

    <span class="reserved">if</span>(p_oAppendToNode) {

        <span class="reserved">if</span> (typeof p_oAppendToNode == <span class="literal">"string"</span>) {

            el = document.getElementById(el);

            <span class="reserved">if</span> (! el) {
                el = document.createElement(<span class="literal">"DIV"</span>);
                el.id = elId;
            }

        }


        <span class="comment">/*
            In order to render the Menu correctly in Opera we need to 
            remove all of the submenu indicator images for each
            MenuItem instance.
        */</span>

        var aMenuItemNodes = [];

        <span class="reserved">if</span>(<span class="reserved">this</span>.browser == <span class="literal">"opera"</span>) {

            var nMenuItemGroups = <span class="reserved">this</span>._aMenuItemGroups.length;
        
            <span class="reserved">if</span>(nMenuItemGroups &gt; 0) {
        
                var i = nMenuItemGroups - 1,
                    nMenuItems,
                    n,
                    oImg,
                    oLI;
        
                do {
        
                    <span class="reserved">if</span>(<span class="reserved">this</span>._aMenuItemGroups[i]) {
        
                        nMenuItems = <span class="reserved">this</span>._aMenuItemGroups[i].length;
            
                        <span class="reserved">if</span>(nMenuItems &gt; 0) {
            
                            n = nMenuItems - 1;
            
                            do {

                                oImg = <span class="reserved">this</span>._aMenuItemGroups[i][n].subMenuIndicator;
                                oLI = <span class="reserved">this</span>._aMenuItemGroups[i][n].element;
                    
                                <span class="reserved">if</span>(<span class="reserved">this</span>._aMenuItemGroups[i][n] &amp;&amp; oImg) {

                                    <span class="reserved">this</span>._oDom.removeClass(oLI, <span class="literal">"hasusbmenu"</span>);

                                    oLI.removeChild(oImg);

                                    aMenuItemNodes[aMenuItemNodes.length] = [oLI, oImg];
        
                                }
                
                            }
                            <span class="reserved">while</span>(n--);
            
                        }
        
                    }
        
                }
                <span class="reserved">while</span>(i--);
        
            }

        }


        <span class="reserved">if</span>(p_oAppendToNode.tagName != <span class="literal">"BODY"</span> || <span class="reserved">this</span>.browser == <span class="literal">"opera"</span>) {

            document.body.appendChild(<span class="reserved">this</span>.element);

            var sWidth = <span class="reserved">this</span>.element.offsetWidth + <span class="literal">"px"</span>;
    
            <span class="reserved">this</span>.cfg.setProperty(<span class="literal">"width"</span>, sWidth);

        }

        appendTo(p_oAppendToNode);
<span class="comment">

        // Put the submenu indicator images back in place.</span>

        <span class="reserved">if</span>(aMenuItemNodes.length &gt; 0) {

            var i = aMenuItemNodes.length - 1;

            do {

                <span class="reserved">this</span>._oDom.addClass(aMenuItemNodes[i][0], <span class="literal">"hassubmenu"</span>);

                aMenuItemNodes[i][0].insertBefore(aMenuItemNodes[i][1], aMenuItemNodes[i][0].lastChild);

            }
            <span class="reserved">while</span>(i--);

        }


    }
    <span class="reserved">else</span> {

        <span class="comment">/*
            No node was passed in. If the element is not already in the 
            document, this fails.
        */</span>

        <span class="reserved">if</span>(!YAHOO.util.Dom._elementInDom(<span class="reserved">this</span>.element)) {

            <span class="reserved">return</span> false;

        }

    }


    <span class="comment">/*
        Determine whether to hide or destroy the source element
    */</span> 

    <span class="reserved">if</span>(<span class="reserved">this</span>.srcElement &amp;&amp; <span class="reserved">this</span>.srcElement.tagName != <span class="literal">"DIV"</span>) {

        <span class="reserved">if</span>(p_bHideSourceElement) {

            <span class="reserved">this</span>.srcElement.style.display = <span class="literal">"none"</span>;

        }
        <span class="reserved">else</span> {

            var oParentNode = <span class="reserved">this</span>.srcElement.parentNode;
            oParentNode.removeChild(<span class="reserved">this</span>.srcElement);

        }

    }


    <span class="reserved">this</span>.cfg.fireDeferredEvents();

    <span class="reserved">this</span>.renderEvent.fire();

    <span class="reserved">return</span> true;

};


<span class="comment">/**
* Removes the Menu instance's element from the DOM and sets all child 
* elements to null.
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.destroy = <span class="reserved">function</span>() {
<span class="comment">
    // Remove DOM event handlers</span>

    <span class="reserved">this</span>._oEventUtil.removeListener(<span class="reserved">this</span>.element, <span class="literal">"mouseover"</span>, <span class="reserved">this</span>._onElementMouseOver);
    <span class="reserved">this</span>._oEventUtil.removeListener(<span class="reserved">this</span>.element, <span class="literal">"mouseout"</span>, <span class="reserved">this</span>._onElementMouseOut);
    <span class="reserved">this</span>._oEventUtil.removeListener(<span class="reserved">this</span>.element, <span class="literal">"mousedown"</span>, <span class="reserved">this</span>._onElementMouseDown);
    <span class="reserved">this</span>._oEventUtil.removeListener(<span class="reserved">this</span>.element, <span class="literal">"mouseup"</span>, <span class="reserved">this</span>._onElementMouseUp);
    <span class="reserved">this</span>._oEventUtil.removeListener(<span class="reserved">this</span>.element, <span class="literal">"click"</span>, <span class="reserved">this</span>._onElementClick);
    <span class="reserved">this</span>._oEventUtil.removeListener(<span class="reserved">this</span>.element, <span class="literal">"keydown"</span>, <span class="reserved">this</span>._onElementKeyDown);
    <span class="reserved">this</span>._oEventUtil.removeListener(<span class="reserved">this</span>.element, <span class="literal">"keyup"</span>, <span class="reserved">this</span>._onElementKeyUp);
    <span class="reserved">this</span>._oEventUtil.removeListener(<span class="reserved">this</span>.element, <span class="literal">"keypress"</span>, <span class="reserved">this</span>._onElementKeyPress);
<span class="comment">

    // Remove CustomEvent listeners</span>

    <span class="reserved">this</span>.mouseOverEvent.unsubscribeAll();
    <span class="reserved">this</span>.mouseOutEvent.unsubscribeAll();
    <span class="reserved">this</span>.mouseDownEvent.unsubscribeAll();
    <span class="reserved">this</span>.mouseUpEvent.unsubscribeAll();
    <span class="reserved">this</span>.clickEvent.unsubscribeAll();
    <span class="reserved">this</span>.keyPressEvent.unsubscribeAll();
    <span class="reserved">this</span>.keyDownEvent.unsubscribeAll();
    <span class="reserved">this</span>.keyUpEvent.unsubscribeAll();
    <span class="reserved">this</span>.beforeMoveEvent.unsubscribeAll();


    var nMenuItemGroups = <span class="reserved">this</span>._aMenuItemGroups.length,
        nMenuItems,
        i,
        n;
<span class="comment">

    // Remove all MenuItem instances</span>

    <span class="reserved">if</span>(nMenuItemGroups &gt; 0) {

        i = nMenuItemGroups - 1;

        do {

            <span class="reserved">if</span>(<span class="reserved">this</span>._aMenuItemGroups[i]) {

                nMenuItems = <span class="reserved">this</span>._aMenuItemGroups[i].length;
    
                <span class="reserved">if</span>(nMenuItems &gt; 0) {
    
                    n = nMenuItems - 1;
        
                    do {

                        <span class="reserved">if</span>(<span class="reserved">this</span>._aMenuItemGroups[i][n]) {
        
                            <span class="reserved">this</span>._aMenuItemGroups[i][n].destroy();
                        }
        
                    }
                    <span class="reserved">while</span>(n--);
    
                }

            }

        }
        <span class="reserved">while</span>(i--);

    }        
<span class="comment">

    // Continue with the superclass implementation of this method</span>

    YAHOO.widget.Menu.superclass.destroy.call(<span class="reserved">this</span>);

};


<span class="comment">/**
* Keeps the Menu in the viewport.
* <span class="attrib">@see</span> YAHOO.widget.Overlay#enforceConstraints
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.enforceConstraints = <span class="reserved">function</span>(type, args, obj) {

    var pos = args[0];

    var bod = document.getElementsByTagName(<span class="literal">'body'</span>)[0];
    var htm = document.getElementsByTagName(<span class="literal">'html'</span>)[0];
    
    var bodyOverflow = YAHOO.util.Dom.getStyle(bod, <span class="literal">"overflow"</span>);
    var htmOverflow = YAHOO.util.Dom.getStyle(htm, <span class="literal">"overflow"</span>);

    var x = pos[0];
    var y = pos[1];

    var offsetHeight = <span class="reserved">this</span>.element.offsetHeight;
    var offsetWidth = <span class="reserved">this</span>.element.offsetWidth;

    var viewPortWidth = YAHOO.util.Dom.getClientWidth();
    var viewPortHeight = YAHOO.util.Dom.getClientHeight();

    var scrollX = window.scrollX || document.body.scrollLeft;
    var scrollY = window.scrollY || document.body.scrollTop;

    var topConstraint = scrollY + 10;
    var leftConstraint = scrollX + 10;
    var bottomConstraint = scrollY + viewPortHeight - offsetHeight - 10;
    var rightConstraint = scrollX + viewPortWidth - offsetWidth - 10;


    <span class="reserved">if</span> (x &lt; 10) {

        x = leftConstraint;

    } <span class="reserved">else</span> <span class="reserved">if</span> ((x + offsetWidth) &gt; viewPortWidth) {

        <span class="reserved">if</span>(
            <span class="reserved">this</span>.parent &amp;&amp; 
            ((x-<span class="reserved">this</span>.parent.element.offsetWidth) &gt; offsetWidth)
        ) {

            x = (x - (<span class="reserved">this</span>.parent.element.offsetWidth + offsetWidth));

        }
        <span class="reserved">else</span> {

            x = rightConstraint;

        }

    }

    <span class="reserved">if</span> (y &lt; 10) {

        y = topConstraint;

    } <span class="reserved">else</span> <span class="reserved">if</span> (y &gt; bottomConstraint) {

        <span class="reserved">if</span>(<span class="reserved">this</span>.parent &amp;&amp; (y &gt; offsetHeight)) {

            y = ((y + <span class="reserved">this</span>.parent.element.offsetHeight) - offsetHeight);

        }
        <span class="reserved">else</span> {

            y = bottomConstraint;

        }

    }

    <span class="reserved">this</span>.cfg.setProperty(<span class="literal">"x"</span>, x, true);
    <span class="reserved">this</span>.cfg.setProperty(<span class="literal">"y"</span>, y, true);

};


<span class="comment">/**
* Initializes the custom events for Menu which are fired automatically
* at appropriate times by the Menu class.
* <span class="attrib">@see</span> YAHOO.widget.Overlay#initDefaultConfig
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.initDefaultConfig = <span class="reserved">function</span>() {

    YAHOO.widget.Menu.superclass.initDefaultConfig.call(<span class="reserved">this</span>);

    <span class="reserved">this</span>.cfg.addProperty(<span class="literal">"initsubmenus"</span>, true);

};


<span class="comment">/**
* Sets focus to a Menu instance's first enabled MenuItem instance.
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.setInitialFocus = <span class="reserved">function</span>() {

    var oMenuItem = <span class="reserved">this</span>._aMenuItemGroups[0][0];

    <span class="reserved">if</span>(oMenuItem) {

        <span class="reserved">if</span>(oMenuItem.cfg.getProperty(<span class="literal">"disabled"</span>)) {

            oMenuItem = oMenuItem.getNextEnabledSibling();

        }

        oMenuItem.focus();

    }        

};


<span class="comment">/**
* Sets the "selected" configuration property of a Menu instance's first
* enabled MenuItem instance to "true."
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.setInitialSelection = <span class="reserved">function</span>() {

    var oMenuItem = <span class="reserved">this</span>._aMenuItemGroups[0][0];

    <span class="reserved">if</span>(oMenuItem) {

        <span class="reserved">if</span>(oMenuItem.cfg.getProperty(<span class="literal">"disabled"</span>)) {

            oMenuItem = oMenuItem.getNextEnabledSibling();

        }

        oMenuItem.cfg.setProperty(<span class="literal">"selected"</span>, true);

    }        

};
<span class="comment">

// Event handlers for configuration properties</span>


<span class="comment">/**
* The default event handler fired when the "fixedcenter" property is changed.
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.configFixedCenter = <span class="reserved">function</span>(type, args, obj) {

	var val = args[0];
	var me = <span class="reserved">this</span>;

	var refireIframe = <span class="reserved">function</span>(e, obj) {
		setTimeout(<span class="reserved">function</span>() {
			me.cfg.refireEvent(<span class="literal">"iframe"</span>);
		}, 0);	
	}

	<span class="reserved">if</span> (val) {

		<span class="reserved">this</span>.center();
		<span class="reserved">if</span> (YAHOO.util.Event._getCacheIndex(window, <span class="literal">"resize"</span>, <span class="reserved">this</span>.center) == -1) {
			YAHOO.util.Event.addListener(window, <span class="literal">"resize"</span>, <span class="reserved">this</span>.center, <span class="reserved">this</span>, true);
		}
		<span class="reserved">if</span> (YAHOO.util.Event._getCacheIndex(window, <span class="literal">"resize"</span>, refireIframe) == -1) {
			YAHOO.util.Event.addListener(window, <span class="literal">"resize"</span>, refireIframe, <span class="reserved">this</span>, true);
		}
		<span class="reserved">if</span> (YAHOO.util.Event._getCacheIndex(window, <span class="literal">"scroll"</span>, <span class="reserved">this</span>.center) == -1) {
			YAHOO.util.Event.addListener(window, <span class="literal">"scroll"</span>, <span class="reserved">this</span>.center, <span class="reserved">this</span>, true);
		}
		<span class="reserved">if</span> (YAHOO.util.Event._getCacheIndex(window, <span class="literal">"scroll"</span>, refireIframe) == -1) {
			YAHOO.util.Event.addListener(window, <span class="literal">"scroll"</span>, refireIframe, <span class="reserved">this</span>, true);
		}

	} <span class="reserved">else</span> {

		YAHOO.util.Event.removeListener(window, <span class="literal">"resize"</span>, <span class="reserved">this</span>.center);
		YAHOO.util.Event.removeListener(window, <span class="literal">"resize"</span>, refireIframe);
		YAHOO.util.Event.removeListener(window, <span class="literal">"scroll"</span>, <span class="reserved">this</span>.center);
		YAHOO.util.Event.removeListener(window, <span class="literal">"scroll"</span>, refireIframe);


        var sPosition = <span class="reserved">this</span>._oDom.getStyle(<span class="reserved">this</span>.element, <span class="literal">"position"</span>);
    
        <span class="reserved">if</span>(<span class="reserved">this</span>.iframe &amp;&amp; sPosition == <span class="literal">"absolute"</span>) {
    
		  <span class="reserved">this</span>.syncPosition();
    
        }

	}

};


<span class="comment">/**
* Event handler for when the "iframe" configuration property of a
* Menu changes.
* <span class="attrib">@param</span> {String} p_sType The name of the event that was fired.
* <span class="attrib">@param</span> {Array} p_aArguments Collection of arguments sent when the event 
* was fired.
* <span class="attrib">@param</span> {YAHOO.widget.Menu} p_oMenu The Menu instance fired the event.
* <span class="attrib">@see</span> YAHOO.widget.Overlay#configIframe
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.configIframe = <span class="reserved">function</span>(p_sType, p_aArguments, p_oMenu) {

    YAHOO.widget.Menu.superclass.configIframe.call(
        <span class="reserved">this</span>, 
        p_sType, 
        p_aArguments, 
        p_oMenu
    );

    var sPosition = <span class="reserved">this</span>._oDom.getStyle(<span class="reserved">this</span>.element, <span class="literal">"position"</span>);

    <span class="reserved">if</span>(<span class="reserved">this</span>.iframe &amp;&amp; (sPosition == <span class="literal">"static"</span> || sPosition == <span class="literal">"relative"</span>)) {

        <span class="reserved">this</span>.iframe.style.display = <span class="literal">"none"</span>;

    }

};


<span class="comment">/**
* Event handler for when the "visible" configuration property of a
* Menu changes. 
* <span class="attrib">@param</span> {String} p_sType The name of the event that was fired.
* <span class="attrib">@param</span> {Array} p_aArguments Collection of arguments sent when the event 
* was fired.
* <span class="attrib">@param</span> {YAHOO.widget.Menu} p_oMenu The Menu instance fired the event.
* <span class="attrib">@see</span> YAHOO.widget.Overlay#configVisible
*/</span>
YAHOO.widget.Menu.<span class="reserved">prototype</span>.configVisible = <span class="reserved">function</span>(p_sType, p_aArguments, p_oMenu) {

    var bVisible = p_aArguments[0];

    <span class="reserved">if</span>(bVisible) {

        <span class="reserved">if</span>(<span class="reserved">this</span>.parent) {

            var oParentMenu = <span class="reserved">this</span>.parent.parent;

            var bConstrainToViewport = 
                    oParentMenu.cfg.getProperty(<span class="literal">"constraintoviewport"</span>);

            <span class="reserved">this</span>.cfg.setProperty(<span class="literal">"constraintoviewport"</span>, bConstrainToViewport);

            <span class="reserved">this</span>.parent.subMenuIndicator.alt = 
                <span class="reserved">this</span>.parent.EXPANDED_SUBMENU_INDICATOR_ALT_TEXT;
        
        }
<span class="comment">
        // Continue with the superclass implementation of this method</span>

        YAHOO.widget.Menu.superclass.configVisible.call(
            <span class="reserved">this</span>, 
            p_sType, 
            p_aArguments, 
            p_oMenu
        );


    } <span class="reserved">else</span> {
<span class="comment">
        // Continue with the superclass implementation of this method</span>

        YAHOO.widget.Menu.superclass.configVisible.call(
            <span class="reserved">this</span>, 
            p_sType, 
            p_aArguments, 
            p_oMenu
        );
        

        <span class="reserved">if</span>(<span class="reserved">this</span>.parent) {

            <span class="reserved">this</span>.parent.subMenuIndicator.alt = 
                <span class="reserved">this</span>.parent.COLLAPSED_SUBMENU_INDICATOR_ALT_TEXT;
        
        }


        <span class="reserved">if</span>(<span class="reserved">this</span>.activeMenuItem) {
    
            <span class="reserved">if</span>(<span class="reserved">this</span>.activeMenuItem.cfg.getProperty(<span class="literal">"selected"</span>)) {
    
                <span class="reserved">this</span>.activeMenuItem.cfg.setProperty(<span class="literal">"selected"</span>, false);
    
            }
    
            var oSubmenu = <span class="reserved">this</span>.activeMenuItem.cfg.getProperty(<span class="literal">"submenu"</span>);
    
            <span class="reserved">if</span>(oSubmenu &amp;&amp; oSubmenu.cfg.getProperty(<span class="literal">"visible"</span>)) {
    
                oSubmenu.hide();
    
            }
    
        }

    }

};</pre>
			</div>
		
	</div>
</div>


<div id="footer">
	<hr />
	Copyright &copy; 2006 Yahoo! Inc. All rights reserved.
	<br />
	Yahoo! Confidential.
	<br /><br />
	Documentation generated by <a href="http://jsdoc.sourceforge.net/">
	JSDoc</a>
</div>



</body>
</html>
