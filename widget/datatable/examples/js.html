<!doctype html public "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>Build Table from Scratch</title>
<link type="text/css" rel="stylesheet" href="../../build/fonts/fonts.css">
<link type="text/css" rel="stylesheet" href="../../build/logger/assets/logger.css">
<style type="text/css">
/* customizable css*/
#fixed table{width:30em;}
.example {margin:1em;}
table {border-collapse:collapse;cursor:default;}
th, td {border:1px solid #000;}
th {background-color:#696969;color:#fff;}/*dark gray*/
.yui-dt-odd {background-color:#eee;} /*light gray*/
.yui-dt-selected {background-color:#97C0A5;} /*green*/


/*foundational css*/
.yui-dt-headcontainer {position:relative;}
.yui-dt-headresizer {position:absolute;right:-4px;bottom:0;width:6px;height:100%;cursor:w-resize;cursor:col-resize;}
.yui-dt-sortable {cursor:hand;cursor:pointer;margin:0 4px 0 4px;}

#scroll  {
   width:20em;margin-bottom:3em;
}


#scroll  thead {
   background:#696969; /*  IE needs a bgcolor to hide tbody as it scrolls */
   border:1px solid #000;
   display:block; /* enables tbody scrolling for safari and opera */
}

#scroll  thead th {
   width:10em; /* any value seems to here, just need something */
}

#scroll  tbody {
   display:block; /* enables tbody scrolling for safari and opera */
   height:10em;
   overflow:auto; /* for scrolling other than IE */
}

/* IE specific */
#scroll  {
   height:10em;
   *overflow-y:auto;
}

#scroll  tbody {
   *height:auto; /* override the non IE height */
}

#scroll thead tr {
   position:relative;  /* IE cant scroll tbody, so trick it into fixing thead */
}

#scroll tbody td {
    width:10em;
}



</style>
</head>
<body>
<h1>Build Table from Scratch</h1>

<div id="webstats" class="example"></div>

<div id="fixed" class="example"></div>

<div id="scroll" class="example"></div>

<div id="page" class="example"><form id="pageform"><input id="pagesubmitprev" type="submit" value="Get Prev Set" disabled><input id="pagesubmitnext" type="submit" value="Get Next Set"><select id="pagerange"><option id="10">10</option><option id="25">25</option><option id="50">50</option><option id="100">100</option></select></form></div>

<div id="xhr" class="example"><form id="xhrform"><input id="xhrinput" type="text"><input id="xhrsubmit" type="submit" value="Add Rows"></form></div>

<script type="text/javascript" src="../../build/yahoo/yahoo.js"></script>
<script type="text/javascript" src="../../build/dom/dom.js"></script>
<script type="text/javascript" src="../../build/event/event-debug.js"></script>
<script type="text/javascript" src="../../build/connection/connection.js"></script>
<script type="text/javascript" src="../../build/dragdrop/dragdrop.js"></script>
<script type="text/javascript" src="../../build/datatable/datatable-debug.js"></script>
<script type="text/javascript" src="../../build/logger/logger.js"></script>
<script type="text/javascript" src="./js/sampledata.js"></script>
<script language="JavaScript">
var myLogger = new YAHOO.widget.LogReader();

/****************************************************************************/
/****************************************************************************/
/****************************************************************************/


var myWebstatsColumnset =
[
    {id:"webstats20", key:"network", text:"Web statistics across Y! properties",
        columnset: [
            {id:"webstats00", key:"property", text:"Property Name", type:"text", sortable:true, resizeable:true},
            {id:"webstats10", key:"visits", text:"Visits", type: "number",
                columnset: [
                    {id:"webstats01",key:"visitspercent",text:"%", sortable:true, resizeable:true},
                    {id:"webstats02",key:"visitstotal",text:"Total", sortable:true, resizeable:true}
                ]
            },
            {id:"webstats11",key:"views",text:"Views",colspan:2,
                columnset: [
                    {id:"webstats03",key:"viewspercent",text:"%",type:"number", sortable:true, resizeable:true},
                    {id:"webstats04",key:"viewstotal",text:"Total",type:"number", sortable:true, resizeable:true}
                ]

            }
        ]
    }
];

var myWebstatsDataDriver = new YAHOO.widget.DataDriver();
var myWebstatsDataSource = new YAHOO.widget.DataSource(aWebstats, myWebstatsDataDriver);
var myWebstatsDataTable = new YAHOO.widget.DataTable("webstats", myWebstatsColumnset, myWebstatsDataSource);


/****************************************************************************/
/****************************************************************************/
/****************************************************************************/
YAHOO.example.Orders = function() {
    this.datadriver = new YAHOO.widget.DataDriver();
    // Customized DataDriver functionality
    this.datadriver.makeConnection = function(sRequest, oCallback, oCaller, oDataSource) {
        var aOrders = oDataSource.livedata;
        var oRawResponse = [];

        // Match the request against the orders database
        if(sRequest) {
            // Else here is where we go through and define the matching algorithm

            //for(var i=0; i<aOrders.length; i++) {
               //oRawResponse.push(aOrders
            //}
        }
        // Or just return all the orders
        else {
            oRawResponse = aOrders;
        }

        // The DataDriver forwards the raw response to the DataParser...
        if(oDataSource.dataparser) {
            oDataSource.dataparser.parseResponse(sRequest, oRawResponse, oCallback, oCaller);
        }
        // ...or else sends the raw response directly back to the caller
        else {
            // Cache the response first
            oDataSource.addToCache(sRequest, oRawResponse);
            oCallback(sRequest, oRawResponse, oCaller);
        }
    };

    this.columnset = [
        {id:"po_paid",type:"checkbox",text:"Paid",sortable:true},
        {id:"po_due",type:"radio",text:"Due Next"},
        {id:"po_deprecated",type:"html",key:"markup",text:"Deprecated Stuff"},
        {id:"po_id",key:"id",type:"number",text:"PO ID",sortable:true,resizeable:true},
        {id:"po_quantity",key:"quantity",type:"number",text:"Quantity",sortable:true,resizeable:true},
        {id:"po_total",key:"amount",type:"currency",text:"$ Total",sortable:true,resizeable:true,editable:true},
        {id:"po_date",key:"date",type:"date",text:"Date",sortable:true,sortOptions:{defaultOrder:"desc"},resizeable:true,isLast:true}
    ];

    this.datasource = new YAHOO.widget.DataSource(aPurchaseOrderObjects, this.datadriver);
    this.datatable = new YAHOO.widget.DataTable("fixed", this.columnset, this.datasource, {defaultRequest: "", fixedwidth:true});
}();

/****************************************************************************/
/****************************************************************************/
/****************************************************************************/

// Custom sort functionality to sort by areacode within states
YAHOO.example.sortStatesAsc = function(a, b) {
    var comp = YAHOO.util.Sort.compareAsc;
    var compState = comp(a.state, b.state);
    return (compState !== 0) ? compState : comp(a.areacode, b.areacode);
};
YAHOO.example.sortStatesDesc = function(a, b) {
    var comp = YAHOO.util.Sort.compareDesc;
    var compState = comp(a.state, b.state);
    return (compState !== 0) ? compState : comp(a.areacode, b.areacode);
};

var myAreacodesDataDriver = new YAHOO.widget.DataDriver();

var myAreacodesColumnset = [
    {id:"ac1",key:"areacode",text:"Area Codes",sortable:true},
    {id:"ac2",key:"state",text:"States",sortable:true,sortOptions:{ascHandler:YAHOO.example.sortStatesAsc,descHandler:YAHOO.example.sortStatesDesc}}
];

var myAreacodesDataSource = new YAHOO.widget.DataSource(aAreacodeObjects, myAreacodesDataDriver);
var myAreacodesDataTable = new YAHOO.widget.DataTable("scroll",myAreacodesColumnset,myAreacodesDataSource,{sortedBy:"ac1"});


/****************************************************************************/
/****************************************************************************/
/****************************************************************************/
var thispagestart = null;
var nextpagestart = null;
var pagerange = 10;
var fnAreaCodeObjects = function(oArgs) {
    thispagestart = (oArgs) ? parseInt(oArgs.nStart) : 0;
    nextpagestart = thispagestart + parseInt(pagerange);
    if(thispagestart <= 0) {
        //disable get prev btn
        YAHOO.util.Dom.get("pagesubmitprev").disabled = true;
    }
    else {
        YAHOO.util.Dom.get("pagesubmitprev").disabled = false;
    }
    
    if(nextpagestart > aAreacodeObjects.length) {
        // disable get next btn
        YAHOO.util.Dom.get("pagesubmitnext").disabled = true;
    }
    else {
        YAHOO.util.Dom.get("pagesubmitnext").disabled = false;
    }

    return aAreacodeObjects.slice(thispagestart, nextpagestart);
};

var myPagedAreacodesDataSource = new YAHOO.widget.DataSource(fnAreaCodeObjects, myAreacodesDataDriver);
var myPagedAreacodesDataTable = new YAHOO.widget.DataTable("page",myAreacodesColumnset,myPagedAreacodesDataSource);

var onPageNextSubmit = function(e, oDataTable) {
    YAHOO.util.Event.stopEvent(e);
    myPagedAreacodesDataTable.replaceRows({nStart:nextpagestart});
};
var onPagePrevSubmit = function(e, oDataTable) {
    YAHOO.util.Event.stopEvent(e);
    myPagedAreacodesDataTable.replaceRows({nStart:thispagestart-pagerange});
};
var onPageRangeChange = function(e, oDataTable) {
    YAHOO.util.Event.stopEvent(e);
    pagerange = this.value;
    myPagedAreacodesDataTable.replaceRows({nStart:thispagestart});
};
YAHOO.util.Event.addListener(YAHOO.util.Dom.get("pagesubmitnext"), "click", onPageNextSubmit, myPagedAreacodesDataTable);
YAHOO.util.Event.addListener(YAHOO.util.Dom.get("pagesubmitprev"), "click", onPagePrevSubmit, myPagedAreacodesDataTable);
YAHOO.util.Event.addListener(YAHOO.util.Dom.get("pagerange"), "change", onPageRangeChange, myPagedAreacodesDataTable);

/****************************************************************************/
/****************************************************************************/
/****************************************************************************/

var myXHRColumnset = [
    {id:"search1",key:"Title",text:"Title",sortable:true, sortOptions:{ascHandler:YAHOO.util.Sort.compareTextAsc,descHandler:YAHOO.util.Sort.compareTextDesc},resizeable:true},
    {id:"search1",key:"Summary",text:"Summary",sortable:true,sortOptions:{ascHandler:YAHOO.util.Sort.compareTextAsc,descHandler:YAHOO.util.Sort.compareTextDesc},resizeable:true}
];

// Converts XML results into an array of key/value objects
var myXMLDataParser = new YAHOO.widget.DataParser();
myXMLDataParser.parseResponse = function(sRequest, oRawResponse, oCallback, oCaller) {
    var aParsedResponse = [];
    var aSchema = ["Result","Title","Summary"];
    var xmlList = oRawResponse.responseXML.getElementsByTagName(aSchema[0]);
    if(!xmlList) {
        bError = true;
    }
    // Loop through each result
    for(var k = xmlList.length-1; k >= 0 ; k--) {
        var result = xmlList.item(k);
        var oResult = {};
        // Loop through each data field in each result using the schema
        for(var m = aSchema.length-1; m >= 1 ; m--) {
            var sValue = null;
            // Values may be held in an attribute...
            var xmlAttr = result.attributes.getNamedItem(aSchema[m]);
            if(xmlAttr) {
                sValue = xmlAttr.value;
            }
            // ...or in a node
            else {
                var xmlNode = result.getElementsByTagName(aSchema[m]);
                if(xmlNode && xmlNode.item(0) && xmlNode.item(0).firstChild) {
                    sValue = xmlNode.item(0).firstChild.nodeValue;
                }
                else {
                       sValue = "";
                }
            }
            // Capture the schema-mapped data field values into an array
            oResult[aSchema[m]] = sValue;
        }
        // Capture each array of values into an array of results
        aParsedResponse.unshift(oResult);
    }
    
    // Cache the response before sending it back to the widget
    oCaller.datasource.addToCache(sRequest, aParsedResponse);

    // The DataParser sends back the parsed response back to the caller
    oCallback(sRequest, aParsedResponse, oCaller);

}

var myXHRDataDriver = new YAHOO.widget.DataDriver();
var myXHRDataSource = new YAHOO.widget.DataSource("./php/ysearch_proxy.php", myXHRDataDriver, myXMLDataParser);
myXHRDataSource.responseType = myXHRDataSource.TYPE_XML;
myXHRDataSource.queryMatchContains = true;
myXHRDataSource.scriptQueryAppend = "results=5"; // Needed for YWS
myXHRDataSource.resultsAsObjects = true;

var myXHRDataTable = new YAHOO.widget.DataTable("xhr", myXHRColumnset, myXHRDataSource,{defaultRequest:"query=madonna&results=5"});
myXHRDataTable.aSchema = ["Result","Title","Summary"];
myXHRDataTable.responseStripAfter = "\n<!-";


var onXHRFormSubmit = function(e, oDataTable) {
    var value = YAHOO.util.Dom.get("xhrinput").value || "madonna";
    YAHOO.util.Event.stopEvent(e);
    myXHRDataTable.addRows("query="+YAHOO.util.Dom.get("xhrinput").value+"&results=5");
};
YAHOO.util.Event.addListener(YAHOO.util.Dom.get("xhrform"), "submit", onXHRFormSubmit, myXHRDataTable);


</script>

</body>
</html>
