<?php
$title="Yahoo! UI Library: Browser History Manager";
$section="history";
$component="Browser History Manager";
$highlightSyntax = true;
$releasenotes = true;
include "../inc/header.inc";
?>

<div id="yui-main">
  <div class="yui-b">
    <div class="yui-ge">
      <div class="yui-u first">
        <div id="promo" class="component">
          <h1>Yahoo! UI Library: Browser History Manager</h1>
          <p>
            Client-side changes to a web page's content and structure are not recorded by the browser's
            history engine. As a consequence, the navigation buttons (back/forward) we've learned to use as we traverse the World Wide Web of <em>documents</em> don't usually serve us well when we begin exploring the World Wide Web of <em>applications</em>.  Bookmarking, too, is problematic in web applications, as the application can change state hundreds of times through the course of a session without any change to the original document's URL.  These are significant problems in the current paradigm of web application development.</p>

			<p>The YUI Browser History Manager is a utility designed to facilitate
            the creation of web applications in which the navigation buttons
            are fully functional and in which broad aspects of an application's state &mdash; what panels are open, what tabs are active, etc. &mdash; can be bookmarked.
          </p>

          <p><strong>Note:</strong> Opera is not supported by the Browser History Manager at this time. Please refer to the <a href="#limitations">Known Limitations</a> section for more information.</p>

          <div>
            <h4>On This Page:</h4>
            <ul>
              <li><a href="#start">Getting Started</a></li>
              <li><a href="#using">Using the Browser History Manager</a></li>
              <li><a href="#appstate">Application State Management</a></li>
              <li><a href="#limitations">Known Limitations</a></li>
              <li><a href="#support">Support &amp; Community</a></li>
              <li><a href="#filingbugs">Filing Bugs and Feature Requests</a></li>
            </ul>
          </div>
<?php
include('../inc/quicklinks.inc');
?>
        </div>

        <h2 class="first" id="start">Getting Started</h2>

        <p>
          To use the Browser History Manager, include the following source
          files in your web page:
        </p>

<textarea name="code" class="HTML" cols="60" rows="1">
<!-- Dependencies -->
<script src="http://yui.yahooapis.com/<?php echo($yuiCurrentVersion);?>/build/yahoo/yahoo-min.js"></script>
<script src="http://yui.yahooapis.com/<?php echo($yuiCurrentVersion);?>/build/event/event-min.js"></script>

<!-- Browser History Manager source file -->
<script src="http://yui.yahooapis.com/<?php echo($yuiCurrentVersion);?>/build/history/history-min.js"></script>
</textarea>
<?php
include "../inc/include-notice.inc";
?>

        <h2 id="using">Using the Browser History Manager</h2>

        <p>
          This section describes the most common use of the Browser History Manager. It contains the following subsections:
        </p>

        <ul>
          <li><a href="#req_markup">Required markup</a></li>
          <li><a href="#mod_reg">Module registration</a></li>
          <li><a href="#bhm_onload">Using the <code>onReady</code> method</a></li>
          <li><a href="#bhm_init">Initializing the Browser History Manager</a></li>
          <li><a href="#store_history_entry">Storing new history entries</a></li>
        </ul>

        <h3 id="req_markup">Required markup</h3>

        <p>
          The Browser History Manager requires the following in-page markup:
        </p>

<textarea name="code" class="HTML" cols="60" rows="1">
&lt;iframe id="yui-history-iframe" src="path-to-existing-asset"&gt;&lt;/iframe&gt;
&lt;input id="yui-history-field" type="hidden"&gt;
</textarea>

        <p>
          <strong>Notes:</strong>
          <ol><li>The IFrame is only used to support Internet Explorer. If the markup is dynamically generated
              on the server (as a result of running a PHP script for example), you may want to create the IFrame
              <em>only</em> for Internet Explorer (use server side user agent sniffing)</li>
              <li>The asset loaded in the IFrame <em>must</em> be retrieved from the same domain as your page
              (use a relative path for the <code>src</code> attribute to make sure of that)</li>
              <li>The asset loaded in the IFrame does not have to be an HTML document. It can be an image for example.
              This trick is useful to avoid an additional server round-trip, which would degrade the performance of
              your site.</li>
              <li>This markup should appear right after the opening <code>&lt;body</code> tag.</li></oL>
        </p>

        <p>Don't forget to hide the IFrame using the following CSS code:</p>

<textarea name="code" class="CSS" cols="60" rows="1">
#yui-history-iframe {
  position:absolute;
  top:0; left:0;
  width:1px; height:1px;
  visibility:hidden;
}
</textarea>

        <h3 id="mod_reg">Module registration</h3>

        <p>
          A user interface module is simply a visible item on your page with which the user can interact.
          As such, modules are not immutable and their state is subject to change over time. If you
          wish to record the history of states visited by a specific module during a single browser
          session, to allow the user to navigate through that history using the browser's back/forward
          button, and to bookmark the page with your module in a specific state, you must first
          register it with the Browser History Manager.
        </p>

        <p>
          In order to register a module, simply call the <code>YAHOO.util.History.register</code> method, passing in
          the module identifier (a non-empty string that uniquely identifies your module), the initial state of
          your module (i.e. the state of your module corresponding to the <em>earliest</em> history entry within
          the current browser session) as a string, and a callback function that will be invoked by the Browser
          History Manager every time your module changes state (so you can update the UI of your module
          accordingly).
        </p>

        <p>
          Getting the initial state of the module is the trickiest part of this process. Indeed, the user might have
          previously visited your page and bookmarked it with your module in a specific state. If the
          user later on goes to your page using the same bookmark, you will likely wish to restore your module in
          the same state it was in when the page was bookmarked. To retrieve this "bookmarked state", simply
          call <code>YAHOO.util.History.getBookmarkedState</code>, passing in your module identifier:
        </p>

<textarea name="code" class="JScript" cols="60" rows="1">
var myModuleBookmarkedState = YAHOO.util.History.getBookmarkedState("myModule");
</textarea>

        <p>
          Of course, you also need a "default state" for your module in case the user accessed
          the page without using a bookmark. Having determined whether there is a bookmarked state in the code example above (<code>getBookmarkedState</code> will have returned <code>null</code> if there was no bookmarked state), the initial state of your module can be assigned as follows:
        </p>

<textarea name="code" class="JScript" cols="60" rows="1">
// If there is no bookmarked state, assign the default state:
var myModuleInitialState = myModuleBookmarkedState || "myModuleDefaultState";
</textarea>

        <p>
          The next step in configuring your module to use the YUI Browser History Manager is to define your module's <code>onStateChange</code> callback. This callback
          will be called every time the Browser History Manager has detected that the state of your
          module has changed (which may happen when the user triggers the browser's back/forward button,
          for example).
        </p>

<textarea name="code" class="JScript" cols="60" rows="1">
function myModuleStateChangeHandler (state) {
    // Update the UI of your module according to the "state" parameter
    ...
}
</textarea>

        <p>
          Finally, complete your module registration by calling <code>YAHOO.util.History.register</code>:
        </p>

<textarea name="code" class="JScript" cols="60" rows="1">
YAHOO.util.History.register("myModule", myModuleInitialState, myModuleStateChangeHandler);
</textarea>

        <p>
          <strong>Note:</strong> You may register as many modules as you want, but you must register
          at least one module before initializing the Browser History Manager. Modules cannot be
          registered once the Browser History Manager has been initialized.
        </p>

        <h3 id="bhm_onload">Using the <code>onReady</code> method</h3>

        <p>
          The Browser History Manager will initialize itself asynchronously and some of its methods
          cannot be called until it is fully initialized. You may want to know when this event occurs.
          In order to do that, you could subscribe to the Browser History Manager's <code>onLoad</code>
          event. However, using this approach, and if the subscription happens after the Browser History
          Manager has been initialized, the event never fires. Therefore, it is recommended to use the
          <code>onReady</code> method instead.
        </p>

        <p>
          One common task you'll find yourself executing in your Browser History Manager <code>onReady</code>
          callback is retrieving the current state of your module and updating its UI accordingly. Why would
          the current state of your module be different from its initial state? Remember that the "initial"
          state of your module corresponds to the <em>earliest</em> history entry. The Browser History
          Manager <code>onLoad</code> event will be fired every time the user visits the page. If the user
          comes back to the page using the browser's back button, the state of your module will correspond
          to the <em>latest</em> history entry &mdash; that is the last state of your module before the user left the
          page. You can retrieve the current state of your module using <code>YAHOO.util.History.getCurrentState</code>,
          passing in your module identifier:
        </p>

<textarea name="code" class="JScript" cols="60" rows="1">
YAHOO.util.History.onReady(function () {
    ...
    var myModuleCurrentState = YAHOO.util.History.getCurrentState("myModule");
    // Update the UI of your module according to "myModuleCurrentState"
    ...
});
</textarea>

        <h3 id="bhm_init">Initializing the Browser History Manager</h3>

        <p>
          The last step is to initialize the Browser History Manager, passing in a reference &mdash; or the id &mdash; of
          the required HTML elements previously created:
        </p>

<textarea name="code" class="JScript" cols="60" rows="1">
YAHOO.util.History.initialize("yui-history-field", "yui-history-iframe");
</textarea>

        <p><strong>Note:</strong>An exception may be thrown when initializing the Browser History Manager
            if the browser is not officially supported. Therefore, you may want to wrap this call within a
            <code>try...catch</code> block.</p>

        <h3 id="store_history_entry">Storing New History Entries</h3>

        <p>
          Call <code>YAHOO.util.History.navigate</code> to store a new state in the browser history,
          passing in the identifier of the module which state has changed, and a string representing
          the new state of the specified module:
        </p>

<textarea name="code" class="JScript" cols="60" rows="1">
YAHOO.util.History.navigate("myModule", "myModuleNewState");
</textarea>

        <p>
          The corresponding module <code>onStateChange</code> callback, specified at the time of the
          module registration, will then be called asynchronously (up to 50 msec later), giving you
          the opportunity to update the UI of your module. <strong>Note:</strong> The same callback
          will be called when the state of your module has changed after the user triggered the
          browser's back/forward button. There is no way to discriminate between these two situations.
        </p>

        <h2 id="appstate">Application State Management</h2>

        <p>
          The Browser History Manager only provides a way of storing/retrieving the history
          of states visited by an application. It is up to the implementer to name and handle
          each state appropriately.
        </p>

        <h2 id="limitations">Known Limitations</h2>

        <ul>
          <li>
            <strong>The Browser History Manager uses the URL fragment identifier to store the history.</strong>
            This means that there is a limit to how long the name of a state can be. Indeed,
            each browser has a built-in limit to how long a URL can be and this limit is browser
            dependent. For example, on Internet Explorer, this limit is 2083 characters. Also,
            keep in mind that this limit applies to the entire URL, not just the fragment identifier.
          </li>

          <li>
            <strong>A string is a one-dimensional way of saving state information.</strong> It is possible to save
            multi-dimension state information (such as the collapsed/expanded state of each
            node of a treeview) into a one-dimensional string. However, the maximum length of a
            state identifier limits this to comparatively simple cases.
          </li>

          <li>
            <strong>Web browsers never send the URL fragment identifier to the server.</strong> This means
            that some client-side processing is required in order to handle bookmarks. It is important to
            keep this amount of processing to a minimum in order not to degrade user experience. However,
            if an additional HTTP request at startup is not an issue, it is possible to send the URL
            fragment identifier back to the server and have the server do some processing instead
            (such as generating the appropriate markup).
          </li>

          <li>
            <strong>All browsers will forget part or all of the history if the page gets forcibly refreshed.</strong>
            This will happen on Internet Explorer by pressing F5 (sometimes several times repeatedly),
            and on Firefox by pressing Ctrl+F5 or Shift-Ctrl-R.
          </li>

          <li>
            <strong>On Internet Explorer, the title of the documents added to the history, listed in the browser's
            history drop down menu, is not correct.</strong> Instead of showing the title of each document, it shows
            part of the URL of each page.
          </li>

          <li>
            <strong>Opera is not supported at this time.</strong> This is due to the fact that Opera does
            not update the <code>location.hash</code> property when using the back/forward buttons. We
            expect this regression to be corrected in a future version of the Opera web browser.
          </li>

          <li>
            <strong>Safari 2.x seems to never stop loading a page that uses the Browser History Manager.</strong>
            This problem does not appear with later versions of the Safari web browser.
          </li>
        </ul>

<?php
include "../inc/support.inc";
?>

      </div>
      <div class="yui-u">
        <div id="cheatsheet">
          <h3>Browser History Manager Cheat Sheet:</h3>
          <a href="http://yuiblog.com/assets/pdf/cheatsheets/history.pdf"><img src="http://us.i1.yimg.com/us.yimg.com/i/ydn/yuiweb/img/cheatsheet-images/history.gif" width="178" height="136" alt="Cheat Sheet for the Browser History Manager."></a>
          <p><a href="/yui/docs/assets/cheatsheets.zip">Download full set of cheat sheets.</a></p>
        </div>
        <div id="examples">
<?php
	include("../inc/examplesNav/".$section.".inc");
?>        </div>
        <div id="morereading">
          <h3>More Reading about the YUI Browser History Manager:</h3>
          <ul>
            <li><a href="http://www.julienlecomte.net/blog/2007/12/37/">Adding Back Button and Bookmarking Support to Your DHTML Slide Show</a>, by Julien Lecomte</li>
          </ul>

          <h3>More Reading about History/Bookmark Management in DHTML Applications:</h3>
          <ul>
            <li><a href="http://yuiblog.com/blog/2007/02/21/browser-history-manager/">Building the YUI Browser History Manager</a>, by YUI Browser History Manager author Julien Lecomte</li>
            <li><a href="http://codinginparadise.org/projects/dhtml_history/README.html">Really Simple History Framework</a>, by Brad Neuberg</li>
            <li><a href="http://www.onjava.com/pub/a/onjava/2005/10/26/ajax-handling-bookmarks-and-back-button.html">AJAX: How to Handle Bookmarks and Back Buttons</a>, by Brad Neuberg</li>
            <li><a href="http://www.contentwithstyle.co.uk/Articles/38/fixing-the-back-button-and-enabling-bookmarking-for-ajax-apps">Fixing the Back Button and Enabling Bookmarking for AJAX Apps</a>, by Mike Stenhouse</li>
            <li><a href="http://dev2dev.bea.com/pub/a/2006/01/ajax-back-button.html">Developing Ajax Applications That Preserve Standard Browser Functionality</a>, by Mark Schiefelbein</li>
          </ul>
        </div>
<?php
$thisURI="http://developer.yahoo.com/yui/history/";
require_once('../inc/badge.inc');
?>
        <h3 id="delicious">YUI Browser History Manager on del.icio.us:</h3>
        <div class="delicious">

<?php require('../inc/badge-html.inc'); ?>

        </div>
      </div>
    </div>
  </div>
</div>

<?php include "../inc/side.inc" ?>
<?php include "../inc/footer.inc" ?>
