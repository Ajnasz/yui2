<?php
$prepend = '<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.6.0/build/logger/assets/skins/sam/logger.css" />
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.6.0/build/carousel/assets/skins/sam/carousel.css" />
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.6.0/build/button/assets/skins/sam/button.css" />
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/yuiloader/yuiloader-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/event/event-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/dom/dom-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/logger/logger-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/connection/connection-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/element/element-beta-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/carousel/carousel-beta-debug.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/button/button-min.js"></script>


<!--begin custom header content for this example-->
<style type="text/css">
    /* Style the spotlight container */
    #spotlight {
        border: 1px solid #ccc;
        height: 180px;
        margin: 10px auto;
        padding: 1px;
        width: 240px;
    }

    #carousel {
        margin: 0;
    }

    #container {
        margin: 0 auto;
    }

    .yui-skin-sam .yui-carousel-nav ul,
    .yui-skin-sam .yui-carousel-nav select {
        display: none;
    }
    
    .yui-carousel-element li {
        height: 75px;
        width: 75px;
    }
</style>

<!--end custom header content for this example-->

';
$section="examples";
$highlightSyntax = true;
$assetsDirectory = "assets/";
$releasenotes = false;
$bodyclass = " yui-skin-sam";
$title = "YUI Library Examples: Carousel Control: Using Ajax for deferred loading of items";
include("../../inc/header.inc"); 
?>
		
	
	<div id="yui-main">
		<div class="yui-b">
		  <div class="yui-ge">
			  <div class="yui-u first example">

    
	<div class="promo">
	<h1>Carousel Control: Using Ajax for deferred loading of items</h1>
	
	<div class="exampleIntro">
	<p>
    This example showcases the dynamic loading capabilities of the <a href="http://developer.yahoo.com/yui/carousel/">YUI Carousel Control</a>.  The YUI Carousel Control exposes an event called <code>loadItems</code>.  This
    event is fired whenever the Carousel needs items to be loaded into it for
    display.  Subscribing  to this event makes it easy to dynamically load
    the next set of images.
</p>
			
	</div>	
					
	<div class="example-container module ">
			<div class="hd exampleHd">
			<p class="newWindowButton yui-skin-sam"><!--<span id="newWindowLinkx"><span class="first-child">--><a href="csl_dynload2_clean.html" target="_blank">View example in new window.</a><!--</span></span>-->		
		</div>		<div id="example-canvas" class="bd">
	
		
	<!--BEGIN SOURCE CODE FOR EXAMPLE =============================== -->
	
	<!-- The Carousel container -->
<div id="container">
    <ol id="carousel"></ol>
</div>
<!-- The spotlight container -->
<div id="spotlight"></div>
<script>
    var carousel, curpos, items = [];

    function getImageTag(img) {
        return "<img src=\"" + img + "\" height=\"75\" width=\"75\">";
    }

    function getImages() {
        var carousel = this;
                
        YAHOO.util.Connect.asyncRequest("GET", "assets/php/getimages.php?pos="+curpos,
                {
                    success: function (o) {
                        var i = curpos,
                            j = 0,
                            r = eval('(' + o.responseText + ')');
                            
                        curpos += r.length;

                        while (i < curpos) {
                            if (r[j]) {
                                carousel.addItem(getImageTag(r[j]));
                            } else {
                                break;
                            }
                            i++;
                            j++;
                        }

                        carousel.set("selectedItem", carousel.get("firstVisible"));
                    },

                    failure: function (o) {
                        alert("Ajax request failed!");
                    }
        });
    }
                
    // Get the image link from within its (parent) container.
    function getLargeImage(parent) {
        var el = parent.firstChild;
                
        while (el) { // walk through till as long as there's an element
            if (el.nodeName.toUpperCase() == "IMG") { // found an image
                // flickr uses "_s" suffix for small, and "_m" for big
                // images respectively
                return el.src.replace(/_s\.jpg$/, "_m.jpg");
            }
            el = el.nextSibling;
        }
                
        return "";
    }

    YAHOO.util.Event.onDOMReady(function (ev) {
        var i, spotlight;
       
        carousel = new YAHOO.widget.Carousel("container", {
                numItems: 17
        });
        YAHOO.util.Connect.asyncRequest("GET", "assets/php/getimages.php", {
                success: function (o) {
                    var i, r = eval('(' + o.responseText + ')');
                    
                    curpos = r.length;

                    for (i = 0; i < curpos; i++) {
                        items.push(r[i]);
                    }

                    // check if the Carousel widget is available
                    if (typeof carousel != "undefined") {
                        for (i = 0; i < curpos; i++) {
                            // if so, shove the elements into it
                            carousel.addItem(getImageTag(items[i]));
                        }
                        carousel.set("selectedItem", 0);
                        items = [];
                    }
                },

                failure: function (o) {
                    alert("Ajax request failed!");
                }
        });
        spotlight   = YAHOO.util.Dom.get("spotlight"),
            
        carousel.render();
        carousel.show();
                
        carousel.on("loadItems", function (o) {
            // more items available?
            getImages.call(this);
        });
                
        carousel.on("itemSelected", function (index) {
            // item has the reference to the Carousel's item
            var el, item = carousel.getElementForItem(index);

            if (item) {
                spotlight.innerHTML = "<img src=\""+getLargeImage(item)+"\">";
            }
        });
    });

</script>
	
	<!--END SOURCE CODE FOR EXAMPLE =============================== -->
	
		
		</div>
		
	
	</div>			
	</div>
		
	<h2 class="first">Making the Carousel Widget to dynamically load images on the fly</h2>
<p>
    Here we will use the <a href="http://developer.yahoo.com/yui/carousel/">YUI Carousel Control</a>'s <code>loadItems</code> event to dynamically
    load the images on the fly.</p>
<p>
    This example has the following dependencies:
</p>

<textarea name="code" class="HTML" cols="60" rows="1"><link type="text/css" rel="stylesheet" href="http://yui.yahooapis.com/2.6.0/build/carousel/assets/skins/sam/carousel.css">
<script src="http://yui.yahooapis.com/2.6.0/build/yahoo/yahoo-dom-event.js"></script>
<script src="http://yui.yahooapis.com/2.6.0/build/element/element-beta-min.js"></script>
<script src="http://yui.yahooapis.com/2.6.0/build/connection/connection-min.js"></script>
<script src="http://yui.yahooapis.com/2.6.0/build/carousel/carousel-beta-min.js"></script></textarea>

<p>
    Initially we use <a href="http://developer.yahoo.com/yui/connection/">YUI Connection Manager</a> to load the initial set of items as
    soon as part of the DOM is visible.</p>

<textarea name="code" class="HTML" cols="60" rows="1"><div id="container">
  <ol id="carousel"></ol>
</div>
<!-- The spotlight container -->
<div id="spotlight"></div></textarea>

<p>
    We have a few simple CSS rules to set the dimensions for the Carousel items.
</p>

<textarea name="code" class="CSS" cols="60" rows="1">
.yui-carousel-element li {
    height: 75px;
    width: 75px;
}</textarea>

<p>
    We'll use Connection Manager to load a set of items into the
    Carousel as early as possible.
</p>


<textarea name="code" class="JScript" cols="60" rows="1">YAHOO.util.Event.onAvailable("bd", function (args) {
  YAHOO.util.Connect.asyncRequest("GET", "php/getimages.php", {
      success: function (o) {
        var i, r = eval('(' + o.responseText + ')');
        curpos = r.length;

        for (i = 0; i < curpos; i++) {
          items.push(r[i]);
        }

        // check if the Carousel widget is available
        if (typeof carousel != "undefined") {
          for (i = 0; i < curpos; i++) {
            // if so, shove the elements into it
            carousel.addItem(getImageTag(items[i]));
          }
          carousel.set("selectedItem", 0);
          items = [];
        }
      },

      failure: function (o) {
        alert("Ajax request failed!");
      }
  });
});</textarea>

<p>
    Let us invoke the Carousel's constructor.    The YUI Carousel Control's
    constructor is passed with the total number of items so that it triggers
    the <code>loadItems</code> event if the items are not available.
</p>

<textarea name="code" class="JScript" cols="60" rows="1">YAHOO.util.Event.onDOMReady(function (ev) {
    var i;
    
    myLogReader = new YAHOO.widget.LogReader();
    carousel    = new YAHOO.widget.Carousel("container", { numItems: 17 });
    carousel.render();
    carousel.show();
                
    if (items.length > 0) {
        for (i = 0; i < curpos; i++) {
            carousel.addItem(getImageTag(items[i]));
        }
        items = [];
    }
});</textarea>


<p>
    The YUI Carousel Control exposes a <code>loadItems</code> custom event that is fired
    when the Carousel needs more items to be loaded.  This becomes very handy
    for us since we can subscribe to it and add more items in to the Carousel
    widget when required.
</p>

<p>
    In our case, the server program returns an array (JSON) of images.  This is
    parsed in the Ajax callback and then the Carousel's <code>addItem()</code> is called for
    every image.
</p>


<textarea name="code" class="JScript" cols="60" rows="1">function getImageTag(img) {
    return "<img src=\"" + img + "\" height=\"75\" width=\"75\">";
}

function getImages() {
    YAHOO.util.Connect.asyncRequest("GET", "php/getimages.php?pos=" + curpos,
        {
            success: function (o) {
                var i = curpos,
                    j = 0,
                    r = eval('(' + o.responseText + ')');
                            
                curpos += r.length;

                while (i < curpos) {
                    if (r[j]) {
                        carousel.addItem(getImageTag(r[j]));
                    } else {
                        break;
                    }
                    i++;
                    j++;
                }
            },

            failure: function (o) {
                alert("Ajax request failed!");
            }
        });
}

carousel.on("beforeScroll", function (o) {
    var i, j,
        last  = o.last,
        num   = carousel.get("numVisible");

    if (!carousel.getItem(last+num)) {
        // more items available?
        getImages();
    }

    return true; // so that the event is not aborted
});</textarea>

<h2>Configuration for This Example</h2>

<p>You can load the necessary JavaScript and CSS for this example from Yahoo's servers.  <a href="http://developer.yahoo.com/yui/articles/hosting/?connection&carousel&MIN#configure">Click here to load the YUI Dependency Configurator with all of this example's dependencies preconfigured</a>.</p>

				</div>
				<div class="yui-u">
						<div id="loggerModule" class="yui-skin-sam">
						<h3 class="firstContent">YUI Logger Output:</h3>
								<div id="loggerDiv"></div>
							<div id="loggerGloss">
								<p><strong>Note:</strong> You are viewing this example in debug mode with logging enabled.  This can significantly slow performance.</p>
	
								<p class="loggerButton"><span id="loggerLink"><span class="first-child"><a href="csl_dynload2.html">Reload with logging<br />and debugging disabled.</a></span></span></p>
							</div>
						</div>
					
				
					<div id="examples">
						<h3>Carousel Control Examples:</h3>
	
						<div id="exampleToc">
							<ul>
								<li><a href='../carousel/csl_selection.html'>Spotlight example</a></li><li><a href='../carousel/csl_circular.html'>Circular Carousel example</a></li><li><a href='../carousel/csl_reveal.html'>Partially revealing previous and next items</a></li><li><a href='../carousel/csl_imagentext.html'>Using both images and text within an item</a></li><li class='selected'><a href='../carousel/csl_dynload2.html'>Using Ajax for deferred loading of items</a></li><li><a href='../carousel/carousel-ariaplugin.html'>Using the Carousel ARIA Plugin</a></li>							</ul>
						</div>
					</div>
					
					<div id="module">
						<h3>More Carousel Control Resources:</h3>
						<ul>
							<li><a href="http://developer.yahoo.com/yui/carousel/">User's Guide</a></li>
						<li><a href="../../docs/module_carousel.html">API Documentation</a></li>
                            
                            
							<li><a href="http://yuiblog.com/assets/pdf/cheatsheets/carousel.pdf">Cheat Sheet PDF</a></li></ul>
					</div>
			  </div>
		</div>
		
		</div>
	</div>


	<?php 
	$append = "

<script src='../../assets/YUIexamples.js'></script>

";
	include("../../inc/side.inc");
	include("../../inc/footer.inc");
	?>