<?php
$prepend = '<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.6.0/build/button/assets/skins/sam/button.css" />
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/yuiloader/yuiloader-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/event/event-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/connection/connection-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/dom/dom-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/element/element-beta-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/button/button-min.js"></script>


<!--begin custom header content for this example-->
<style>
#container {margin-left:2em;}
</style>
<!--end custom header content for this example-->

';
$section="examples";
$highlightSyntax = true;
$assetsDirectory = "assets/";
$releasenotes = false;
$bodyclass = " yui-skin-sam";
$title = "YUI Library Examples: Connection Manager: Subscribing to Connection Manager's Custom Events via the Callback Object";
include("../../inc/header.inc"); 
?>
		
	
	<div id="yui-main">
		<div class="yui-b">
		  <div class="yui-ge">
			  <div class="yui-u first example">

    
	<div class="promo">
	<h1>Connection Manager: Subscribing to Connection Manager's Custom Events via the Callback Object</h1>
	
	<div class="exampleIntro">
	<p>
<a href="http://developer.yahoo.com/yui/connection/">Connection Manager</a> exposes <a href="http://developer.yahoo.com/yui/event/#customevent">Custom Events</a> that track the progress of a transaction throughout its lifecycle.  These Custom Events are raised at the global level and at the transaction level.  The following code example provides a step-by-step approach to subscribing to transactional Custom Events raised by Connection Manager.  In this scenario, an event handler object is created to handle all of the Custom Events; this event handler object is passed to Connection Manager in the callback object.  Connection Manager will automatically subscribe to the events and fire the specified events.
</p>

<p>Click "Send a Request" below to try it out, then read the description below to learn how to subscribe to transactional Custom Events in Connection Manager.</p>			
	</div>	
					
	<div class="example-container module ">
			<div class="hd exampleHd">
			<p class="newWindowButton yui-skin-sam"><!--<span id="newWindowLinkx"><span class="first-child">--><a href="callback_customevents_clean.html" target="_blank">View example in new window.</a><!--</span></span>-->		
		</div>		<div id="example-canvas" class="bd">
	
		
	<!--BEGIN SOURCE CODE FOR EXAMPLE =============================== -->
	
	<form>
<input type="button" onclick="makeRequest();" value="Send a Request">
</form>
<div id="container"></div>
<script>
var div = document.getElementById('container');

var transactionObject = {
	start:function(type, args){
		YAHOO.log("Custom Event *start* fired for transaction" + args[0].tId + ".", "info", "example");
		div.innerHTML = "<li>Transaction " + args[0].tId + " " + type + " event fired.</li>";
	},

	complete:function(type, args){
		YAHOO.log("Custom Event *complete* fired for transaction" + args[0].tId + ".", "info", "example");
		div.innerHTML += "<li>Transaction " + args[0].tId + " " + type + " event fired.</li>";
	},

	success:function(type, args){
		YAHOO.log("Custom Event *success* fired for transaction" + args[0].tId + ".", "info", "example");
		div.innerHTML += "<li>Transaction " + args[0].tId + " " + type + " event fired.</li>";
		if(args[0].responseText !== undefined){
			div.innerHTML += "<li>Transaction id: " + args[0].tId + "</li>";
			div.innerHTML += "<li>HTTP status: " + args[0].status + "</li>";
			div.innerHTML += "<li>Status code message: " + args[0].statusText + "</li>";
			div.innerHTML += "<li>HTTP headers: " + args[0].getAllResponseHeaders + "</li>";
			div.innerHTML += "<li>Server response: " + args[0].responseText + "</li>";
			div.innerHTML += "<li>Argument object: Array ( [foo] =&gt; " + args[0].argument[0] +" [bar] =&gt; " + args[0].argument[1] +" )</li>";
			}
	},

	failure:function(type, args){
		YAHOO.log("Custom Event *failure* fired for transaction" + args[0].tId + ".", "info", "example");
		div.innerHTML += "<li>Transaction " + args[0].tId + " " + type + " event fired.</li>";
		if(args[0].responseText !== undefined){
			div.innerHTML += "<li>Transaction id: " + args[0].tId + "</li>";
			div.innerHTML += "<li>HTTP status: " + args[0].status + "</li>";
			div.innerHTML += "<li>Status code message: " + args[0].statusText + "</li>";
		}
	},

	abort:function(type, args){
		YAHOO.log("Custom Event *abort* fired for transaction" + args[0].tId + ".", "info", "example");
		div.innerHTML += "<li>Transaction " + args[0].tId + " " + type + " event fired.</li>";
	}
};

var handleSuccess = function(o){
	div.innerHTML += "<li>Success response handler triggered in callback.success</li>";
};

var handleFailure = function(o){
	div.innerHTML += "<li>Failure response handler triggered in callback.success</li>";
};

var callback = {
	success:handleSuccess,
	failure:handleFailure,
	customevents:{
		onStart:transactionObject.start,
		onComplete:transactionObject.complete,
		onSuccess:transactionObject.success,
		onFailure:transactionObject.failure,
		onAbort:transactionObject.abort
	},
 	argument:["foo","bar"]
};

function makeRequest(){
	var sUrl = "assets/get.php?s=hello%20world";
	var request = YAHOO.util.Connect.asyncRequest('GET', sUrl, callback);
};
</script>	
	<!--END SOURCE CODE FOR EXAMPLE =============================== -->
	
		
		</div>
		
	
	</div>			
	</div>
		
	<h2 class="first">Subscribing to Connection Manager's Custom Events via the Callback Object</h2>

<h3>Source file and dependencies</h3>
<p>Load the <a href="http://developer.yahoo.com/yui/yahoo/">Yahoo Global Object</a> and <a href="http://developer.yahoo.com/yui/connection/">Connection Manager</a> source files:</p>

<textarea name="code" class="JScript" cols="60" rows="1">
<script src="yahoo.js"></script>
<script src="event.js"></script>
<script src="connection.js"></script>
</textarea>

<h3>Create an Event Handler Object</h3>
<p>Create an object to handle all the custom events fired by Connection Manager.</p>

<textarea name="code" class="JScript" cols="60" rows="1">
var div = document.getElementById('container');

var transactionObject = {
	start:function(type, args){
		div.innerHTML = "&lt;li&gt;Transaction " + args[0].tId + " " + type + " fired.&lt;li&gt;";
	},

	complete:function(type, args){
		div.innerHTML += "&lt;li&gt;Transaction " + args[0].tId + " " + type + " fired.&lt;li&gt;";
	},

	success:function(type, args){
		div.innerHTML += "&lt;li&gt;Transaction " + args[0].tId + " " + type + " fired.&lt;li&gt;";
		if(args[0].responseText !== undefined){
			div.innerHTML += "&lt;li&gt;Transaction id: " + args[0].tId + "&lt;li&gt;";
			div.innerHTML += "&lt;li&gt;HTTP status: " + args[0].status + "&lt;li&gt;";
			div.innerHTML += "&lt;li&gt;Status code message: " + args[0].statusText + "&lt;li&gt;";
			div.innerHTML += "&lt;li&gt;HTTP headers: " + args[0].getAllResponseHeaders + "&lt;li&gt;";
			div.innerHTML += "&lt;li&gt;Server response: " + args[0].responseText + "&lt;li&gt;";
			div.innerHTML += "&lt;li&gt;Argument object: Array ( [foo] =&gt; " + args[0].argument[0] +" [bar] =&gt; " + args[0].argument[1] +" )&lt;li&gt;";
			}
	},

	failure:function(type, args){
		div.innerHTML += "&lt;li&gt;Transaction " + args[0].tId + " " + type + " fired.&lt;li&gt;";
		if(args[0].responseText !== undefined){
			div.innerHTML += "&lt;li&gt;Transaction id: " + args[0].tId + "&lt;li&gt;";
			div.innerHTML += "&lt;li&gt;HTTP status: " + args[0].status + "&lt;li&gt;";
			div.innerHTML += "&lt;li&gt;Status code message: " + args[0].statusText + "&lt;li&gt;";
		}
	},

	abort:function(type, args){
		div.innerHTML += "&lt;li&gt;Transaction " + args[0].tId + " " + type + " fired.&lt;li&gt;";
	}
};
</textarea>

<p>Let's create two functions to provide handlers for <code>callback.success</code> and <code>callback.failure</code> compatibility.  The inclusion of these handlers will demonstrate their backward compatibility with Custom Events.</p>
<textarea name="code" class="JScript" cols="60" rows="1">
var handleSuccess = function(o){
	div.innerHTML += "&lt;li&gt;Success response handler triggered in callback.success&lt;li&gt;";
};

var handleFailure = function(o){
	div.innerHTML += "&lt;li&gt;Failure response handler triggered in callback.success&lt;li&gt;";
};
</textarea>

<p>Subscribe to the transaction custom events fired by Connection Manager by creating a <code>customevents</code> object in the callback object.  NOTE: callback.success and callback.failure are provided here to demonstrate backward compatibility, and would be redundant to customevents.onSuccess and customevents.onFailure, respectively.</p>
<textarea name="code" class="JScript" cols="60" rows="1">

var callback = {
	success:handleSuccess,
	failure:handleFailure,
	customevents:{
		onStart:transactionObject.start,
		onComplete:transactionObject.complete,
		onSuccess:transactionObject.success,
		onFailure:transactionObject.failure,
		onAbort:transactionObject.abort
	},
 	argument:["foo","bar"]
};
</textarea>

<h3>Initiate the Transaction</h3>
<p>Call <code>YAHOO.util.Connect.asyncRequest</code> to make a request to <code>get.php</code>, and PHP will return the contents of <code>$_GET</code> via <code>print_r()</code>.
Each event handler in <code>transactionObject</code> will be triggered in response to its custom event(e.g., transactionObject.start will be called when startEvent fires).  In this example, event handlers are created and subscribed to all possible events raised by Connection Manager.
</p>


<textarea name="code" class="JScript" cols="60" rows="1">
var sUrl = "php/get.php?s=hello%20world";
var request = YAHOO.util.Connect.asyncRequest('GET', sUrl, callback);
</textarea>
<h2>Configuration for This Example</h2>

<p>You can load the necessary JavaScript and CSS for this example from Yahoo's servers.  <a href="http://developer.yahoo.com/yui/articles/hosting/?event&connection&MIN#configure">Click here to load the YUI Dependency Configurator with all of this example's dependencies preconfigured</a>.</p>

				</div>
				<div class="yui-u">
						<div id="loggerModule" class="yui-skin-sam">
						<h3 class="firstContent">YUI Logger Output:</h3>
								<div id="loggerGloss"><p><strong>Note:</strong> Logging and debugging is currently turned off for this example.</p> 
							<p class="loggerButton"><span id="loggerLink"><span class="first-child"><a href="callback_customevents_log.html">Reload with logging<br />
	 and debugging enabled.</a></span></span></p></div>
	
						</div>
					
				
					<div id="examples">
						<h3>Connection Manager Examples:</h3>
	
						<div id="exampleToc">
							<ul>
								<li><a href='../connection/get.html'>Connection Manager GET Transaction</a></li><li><a href='../connection/post.html'>Connection Manager POST Transaction</a></li><li><a href='../connection/abort.html'>Connection Manager Transaction Timeout</a></li><li><a href='../connection/weather.html'>Retrieving a Yahoo! Weather RSS Feed</a></li><li><a href='../connection/global_customevents.html'>Subscribing to Connection Manager Global Events</a></li><li class='selected'><a href='../connection/callback_customevents.html'>Subscribing to Connection Manager's Custom Events via the Callback Object</a></li><li><a href='../imagecropper/conn_crop.html'>Connection Manager assisted image crop (included with examples for ImageCropper Control (beta))</a></li><li><a href='../treeview/dynamic_tree.html'>Dynamically Loading Node Data (included with examples for TreeView Control)</a></li><li><a href='../editor/post_editor.html'>Editor Data Post with Connection Manager (included with examples for Rich Text Editor)</a></li><li><a href='../layout/calrte_layout.html'>Simple Application (included with examples for Layout Manager)</a></li>							</ul>
						</div>
					</div>
					
					<div id="module">
						<h3>More Connection Manager Resources:</h3>
						<ul>
							<li><a href="http://developer.yahoo.com/yui/connection/">User's Guide</a></li>
						<li><a href="../../docs/module_connection.html">API Documentation</a></li>
                            
                            
							<li><a href="http://yuiblog.com/assets/pdf/cheatsheets/connection.pdf">Cheat Sheet PDF</a></li></ul>
					</div>
			  </div>
		</div>
		
		</div>
	</div>


	<?php 
	$append = "

<script src='../../assets/YUIexamples.js'></script>

";
	include("../../inc/side.inc");
	include("../../inc/footer.inc");
	?>