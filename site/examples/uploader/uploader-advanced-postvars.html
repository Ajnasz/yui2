<?php
$prepend = '<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.6.0/build/logger/assets/skins/sam/logger.css" />
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.6.0/build/button/assets/skins/sam/button.css" />
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/yuiloader/yuiloader-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/event/event-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/dom/dom-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/logger/logger-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/element/element-beta-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/uploader/uploader-experimental.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/button/button-min.js"></script>

<!--there is no custom header content for this example-->

';
$section="examples";
$highlightSyntax = true;
$assetsDirectory = "assets/";
$releasenotes = false;
$bodyclass = " yui-skin-sam";
$title = "YUI Library Examples: Uploader Control (experimental): Advanced Uploader Example With Additional POST Variables and Server Data Return";
include("../../inc/header.inc"); 
?>
		
	
	<div id="yui-main">
		<div class="yui-b">
		  <div class="yui-ge">
			  <div class="yui-u first example">

    
	<div class="promo">
	<h1>Uploader Control (experimental): Advanced Uploader Example With Additional POST Variables and Server Data Return</h1>
	
	<div class="exampleIntro">
	<p>This example demonstrates how the Uploader can be rendered as a transparent layer on top of your own UI, and how custom variables can be added to the upload's POST request. In this example, the server-side script also echoes the POST variables accompanying the upload; we retrieve the data returned by the server and display it to the user.</p>
<p><strong>Note:</strong> The YUI Uploader Control requires Flash Player 9.0.45 or higher. The latest version of Flash Player is available at the <a href="http://www.adobe.com/go/getflashplayer">Adobe Flash Player Download Center</a>.</p>
<p><strong>Note:</strong> The YUI Uploader Control requires the uploader.swf Flash file that is distributed as part of the YUI package, in the uploader/assets folder. Copy the uploader.swf to your server and set the YAHOO.Uploader.SWFURL variable to its full path.</p>
<p><strong>Note:</strong> This example uses a server-side script to accept file uploads. The script used does not open or store the file data sent to it. It also does not store the accompanying POST variables, but it does echo them in the response relayed back to the sender of the request. When trying out the example, do not send any sensitive or private data. Do not exceed file size of 10 MB.			
	</div>	
					
	<div class="example-container module ">
			<div class="hd exampleHd">
			<p class="newWindowButton yui-skin-sam"><!--<span id="newWindowLinkx"><span class="first-child">--><a href="uploader-advanced-postvars_clean.html" target="_blank">View example in new window.</a><!--</span></span>-->		
		</div>		<div id="example-canvas" class="bd">
	
		
	<!--BEGIN SOURCE CODE FOR EXAMPLE =============================== -->
	
	<style>
#selectFilesLink a, #uploadFilesLink a, #clearFilesLink a {
	color: #0000CC;
	background-color: #FFFFFF;
}

#selectFilesLink a:visited, #uploadFilesLink a:visited, #clearFilesLink a:visited {
	color: #0000CC;
	background-color: #FFFFFF;
}

#uploadFilesLink a:hover, #clearFilesLink a:hover {	
	color: #FFFFFF;
	background-color: #000000;
}
</style>

<div id="uiElements" style="display:inline;">
		<div id="postVars">
		Set custom values for a couple POST vars:<br/>
		var1: <input type="text" id="var1Value" value="var1 default value" /><br/>
		var2: <input type="text" id="var2Value" value="var2 default value" /><br/><br/>
		</div>
		<div id="uploaderContainer">
			<div id="uploaderOverlay" style="position:absolute; z-index:2"></div>
			<div id="selectFilesLink" style="z-index:1"><a id="selectLink" href="#">Select File</a></div>
		</div>
		<div id="uploadFilesLink"><a id="uploadLink" onClick="upload(); return false;" href="#">Upload File</a></div><br/>
		<div id="selectedFileDisplay">
		Progress: <input type="text" cols="50" id="progressReport" value="" readonly /><br/><br/>
		</div>
		<div id="returnedDataDisplay">
		Data returned by the server:<br/>
		<textarea id="serverData" rows="5" cols="50"></textarea>
		</div>
</div>


<script type="text/javascript">

YAHOO.util.Event.onDOMReady(function () { 
var uiLayer = YAHOO.util.Dom.getRegion('selectLink');
var overlay = YAHOO.util.Dom.get('uploaderOverlay');
YAHOO.util.Dom.setStyle(overlay, 'width', uiLayer.right-uiLayer.left + "px");
YAHOO.util.Dom.setStyle(overlay, 'height', uiLayer.bottom-uiLayer.top + "px");
});

	// Custom URL for the uploader swf file (same folder).
	YAHOO.widget.Uploader.SWFURL = "assets/uploader.swf";

    // Instantiate the uploader and write it to its placeholder div.
	var uploader = new YAHOO.widget.Uploader( "uploaderOverlay" );
	
	// Add event listeners to various events on the uploader.
	// Methods on the uploader should only be called once the 
	// contentReady event has fired.
	
	uploader.addListener('contentReady', handleContentReady);
	uploader.addListener('fileSelect', onFileSelect)
	uploader.addListener('uploadStart', onUploadStart);
	uploader.addListener('uploadProgress', onUploadProgress);
	uploader.addListener('uploadCancel', onUploadCancel);
	uploader.addListener('uploadComplete', onUploadComplete);
	uploader.addListener('uploadCompleteData', onUploadResponse);
	uploader.addListener('uploadError', onUploadError);
    uploader.addListener('rollOver', handleRollOver);
    uploader.addListener('rollOut', handleRollOut);
    uploader.addListener('click', handleClick);
    	
    // Variable for holding the selected file id.
	var fileID;
	
	// When the mouse rolls over the uploader, this function
	// is called in response to the rollOver event.
	// It changes the appearance of the UI element below the Flash overlay.
	function handleRollOver () {
		YAHOO.util.Dom.setStyle(YAHOO.util.Dom.get('selectLink'), 'color', "#FFFFFF");
		YAHOO.util.Dom.setStyle(YAHOO.util.Dom.get('selectLink'), 'background-color', "#000000");
	}
	
	// On rollOut event, this function is called, which changes the appearance of the
	// UI element below the Flash layer back to its original state.
	function handleRollOut () {
		YAHOO.util.Dom.setStyle(YAHOO.util.Dom.get('selectLink'), 'color', "#0000CC");
		YAHOO.util.Dom.setStyle(YAHOO.util.Dom.get('selectLink'), 'background-color', "#FFFFFF");
	}
	
	// When the Flash layer is clicked, the "Browse" dialog is invoked.
	// The click event handler allows you to do something else if you need to.
	function handleClick () {
	}
	
	// When contentReady event is fired, you can call methods on the uploader.
	function handleContentReady () {
	    // Allows the uploader to send log messages to trace, as well as to YAHOO.log
		uploader.setAllowLogging(true);
		
		// Disallows multiple file selection in "Browse" dialog.
		uploader.setAllowMultipleFiles(false);
		
		// New set of file filters.
		var ff = new Array({description:"Images", extensions:"*.jpg;*.png;*.gif"},
		                   {description:"Videos", extensions:"*.avi;*.mov;*.mpg"});
		                   
		// Apply new set of file filters to the uploader.
		uploader.setFileFilters(ff);
	}

	// Actually uploads the files. Since we are only allowing one file
	// to be selected, we use the upload function, in conjunction with the id 
	// of the selected file (returned by the fileSelect event). We are also including
	// the text of the variables specified by the user in the input UI.

	function upload() {
	if (fileID != null) {
		uploader.upload(fileID, "http://www.yswfblog.com/upload/upload.php", 
		                "POST", 
		                {var1:document.getElementById("var1Value").value,
						 var2:document.getElementById("var2Value").value});
	}	
	}
	
	// Fired when the user selects files in the "Browse" dialog
	// and clicks "Ok". Here, we set the value of the progress
	// report textfield to reflect the fact that a file has been
	// selected.
	
	function onFileSelect(event) {
		for (var file in event.fileList) {
		    if(YAHOO.lang.hasOwnProperty(event.fileList, file)) {
				fileID = event.fileList[file].id;
			}
		}
		
		this.progressReport = document.getElementById("progressReport");
		this.progressReport.value = "Selected " + event.fileList[fileID].name;
	}


    // When the upload starts, we inform the user about it via
	// the progress report textfield. 
	function onUploadStart(event) {
		this.progressReport.value = "Starting upload...";
	}
	
	// As upload progresses, we report back to the user via the
	// progress report textfield.
	function onUploadProgress(event) {
		prog = Math.round(100*(event["bytesLoaded"]/event["bytesTotal"]));
		this.progressReport.value = prog + "% uploaded...";
	}
	
	// Report back to the user that the upload has completed.
	function onUploadComplete(event) {
		this.progressReport.value = "Upload complete.";
	}
	
	// Report back to the user if there has been an error.
	function onUploadError(event) {
		this.progressReport.value = "Upload error.";
	}
	
	// Do something if an upload is canceled.
	function onUploadCancel(event) {

	}
	
	// When the data is received back from the server, display it to the user
	// in the server data text area.
	function onUploadResponse(event) {
		this.serverData = document.getElementById("serverData");
		this.serverData.value = event.data;
	}
</script>


	
	<!--END SOURCE CODE FOR EXAMPLE =============================== -->
	
		
		</div>
		
	
	</div>			
	</div>
		
	<h2 class="first">Advanced Uploader Example With Additional POST Variables and Server Data Return</h2>

<p>In this example, we allow the user to select a single image or video, and upload it to the server, while tracking progress on the upload. The user can specify custom values for a couple POST vars sent along with the upload, and also get the response from the server (in this case, a simple echo of POSTed variables). 
	
Because of security changes in Flash Player 10, the UI for invoking the "Browse" dialog has to be contained within the Flash player. In this example, the Flash player is rendered as a transparent overlay on top of a custom HTML-based UI. The Uploader running in the Flash player dispatches necessary mouse events to the DOM to make visual changes to the overlaid UI.</p>

<p>For starters, let's define the necessary UI styles. We will use regular text links as the UI, and switch their background color when the mouse hovers over them.</p>

<textarea name="code" class="html" cols="60" rows="5">
	<style>
	#selectFilesLink a, #uploadFilesLink a, #clearFilesLink a {
		color: #0000CC;
		background-color: #FFFFFF;
	}

	#selectFilesLink a:visited, #uploadFilesLink a:visited, #clearFilesLink a:visited {
		color: #0000CC;
		background-color: #FFFFFF;
	}

	#uploadFilesLink a:hover, #clearFilesLink a:hover {	
		color: #FFFFFF;
		background-color: #000000;
	}
	</style>
</textarea>
<p>Next, we'll place the UI elements on the page. Notice that the <code>selectFilesLink</code> div is overlaid by the <code>uploaderOverlay</code> div. <code>uploaderOverlay</code> is where we'll place the transparent Flash UI layer, that will dispatch various mouse events, based on which we will be able to change the appearance of the UI below.</p>
<p>We are also placing a few input fields for the user to specify two custom POST variables that will be sent along with the file upload, as well as a text field to report back on the upload progress, and a text area to display the response received from the server:</p>
<textarea name="code" class="html" cols="60" rows="5">
	<div id="uiElements" style="display:inline;">
			<div id="postVars">
			Set custom values for a couple POST vars:<br/>
			var1: <input type="text" id="var1Value" value="var1 default value" /><br/>
			var2: <input type="text" id="var2Value" value="var2 default value" /><br/><br/>
			</div>
			<div id="uploaderContainer">
				<div id="uploaderOverlay" style="position:absolute; z-index:2"></div>
				<div id="selectFilesLink" style="z-index:1"><a id="selectLink" href="#">Select File</a></div>
			</div>
			<div id="uploadFilesLink"><a id="uploadLink" onClick="upload(); return false;" href="#">Upload File</a></div><br/>
			<div id="selectedFileDisplay">
			Progress: <input type="text" cols="50" id="progressReport" value="" readonly /><br/><br/>
			</div>
			<div id="returnedDataDisplay">
			Data returned by the server:<br/>
			<textarea id="serverData" rows="5" cols="50">&lt;/textarea&gt;
			</div>
	</div>
</textarea>

<p>Once the DOM is ready, we can size our container for the transparent UI to the link below it. The following code accomplishes that:</p>
<textarea name="code" class="js" cols="60" rows="5">
	<script type="text/javascript">
	YAHOO.util.Event.onDOMReady(function () { 
	var uiLayer = YAHOO.util.Dom.getRegion('selectLink');
	var overlay = YAHOO.util.Dom.get('uploaderOverlay');
	YAHOO.util.Dom.setStyle(overlay, 'width', uiLayer.right-uiLayer.left + "px");
	YAHOO.util.Dom.setStyle(overlay, 'height', uiLayer.bottom-uiLayer.top + "px");
	});
</textarea>

<p>Now we can instantiate the uploader and place it in the container div.</p>
<textarea name="code" class="js" cols="60" rows="5">
		YAHOO.widget.Uploader.SWFURL = "assets/uploader.swf";
		var uploader = new YAHOO.widget.Uploader( "uploaderOverlay" );
</textarea>

<p>We add handler functions to the uploader events. Note that methods on the uploader should not be called until the "contentReady" event has fired:</p>
<textarea name="code" class="js" cols="60" rows="5">
		uploader.addListener('contentReady', handleContentReady);
		uploader.addListener('fileSelect', onFileSelect)
		uploader.addListener('uploadStart', onUploadStart);
		uploader.addListener('uploadProgress', onUploadProgress);
		uploader.addListener('uploadCancel', onUploadCancel);
		uploader.addListener('uploadComplete', onUploadComplete);
		uploader.addListener('uploadCompleteData', onUploadResponse);
		uploader.addListener('uploadError', onUploadError);
		uploader.addListener('rollOver', handleRollOver);
		uploader.addListener('rollOut', handleRollOut);
		uploader.addListener('click', handleClick);
</textarea>
<p>These handlers are called when the mouse rolls over and out of the uploader, respectively. They modify the appearance of the UI layer under the transparent Flash layer to match the behavior of the rest of the UI.</p>
<textarea name="code" class="js" cols="60" rows="5">
		function handleRollOver () {
			YAHOO.util.Dom.setStyle(YAHOO.util.Dom.get('selectLink'), 'color', "#FFFFFF");
			YAHOO.util.Dom.setStyle(YAHOO.util.Dom.get('selectLink'), 'background-color', "#000000");
		}

		function handleRollOut () {
			YAHOO.util.Dom.setStyle(YAHOO.util.Dom.get('selectLink'), 'color', "#0000CC");
			YAHOO.util.Dom.setStyle(YAHOO.util.Dom.get('selectLink'), 'background-color', "#FFFFFF");
		}

		function handleClick () {
		}
</textarea>

<p>Once the contentReady event has fired, we can configure the uploader. In this case, we call a function that turns on logging (so that everything we do is reflected in the YUI logger, as well as in the Flash trace file), disallow multiple file selection, and define a set of filters on the file extensions that the user can choose.</p>
<textarea name="code" class="js" cols="60" rows="5">
		function handleContentReady () {
			uploader.setAllowLogging(true);
			uploader.setAllowMultipleFiles(false);

			var ff = new Array({description:"Images", extensions:"*.jpg;*.png;*.gif"},
			                   {description:"Videos", extensions:"*.avi;*.mov;*.mpg"});

			uploader.setFileFilters(ff);
		}
</textarea>

<p>The upload function is called when "Upload Files" link is clicked. It checks whether the fileID
variable has been populated, and if so, instructs the upload to send that file to the specified 
location. Note that we are overriding the default value for the variable submission method (default
is "GET", we are making it "POST"). We are also passing an object with two POST variables to
submit along with the upload; in this case, their values come from input fields that were presented
to the user.</p>
<textarea name="code" class="js" cols="60" rows="5">
		function upload() {
		if (fileID != null) {
			uploader.upload(fileID, "http://www.yswfblog.com/upload/upload.php", 
			                "POST", 
			                {var1:document.getElementById("var1Value").value,
							 var2:document.getElementById("var2Value").value});
		}	
		}
</textarea>

<p>The fileID variable that the upload() function checked for needs to be defined and populated.
This happens in the fileSelect event handler, that looks at the list of files passed in the event
(they are indexed by the file id, rather than by numerical index, and so an iterator is necessary).
Since we know the list will contain only one file, we can simply assign that file id to the fileID
variable.</p>
<p>We also update the progress report text field with the information on the selected file</p>
<textarea name="code" class="js" cols="60" rows="5">
		var fileID;

		function onFileSelect(event) {
    		for (var file in event.fileList) {
    		    if(YAHOO.lang.hasOwnProperty(event.fileList, file)) {
    				fileID = event.fileList[file].id;
    			}
    		}

			this.progressReport = document.getElementById("progressReport");
			this.progressReport.value = "Selected " + event.fileList[fileID].name;
		}
</textarea>

<p>Update the progress report when the upload starts:</p>
<textarea name="code" class="js" cols="60" rows="5">
		function onUploadStart(event) {
			this.progressReport.value = "Starting upload...";
		}
</textarea>

<p>Update the progress report on upload progress events:</p>
<textarea name="code" class="js" cols="60" rows="5">
		function onUploadProgress(event) {
			prog = Math.round(100*(event["bytesLoaded"]/event["bytesTotal"]));
			this.progressReport.value = prog + "% uploaded...";
		}
</textarea>

<p>Update the progress report on upload complete event:</p>
<textarea name="code" class="js" cols="60" rows="5">
		function onUploadComplete(event) {
			this.progressReport.value = "Upload complete.";
		}
</textarea>

<p>Update the progress report in case of an upload error:</p>
<textarea name="code" class="js" cols="60" rows="5">
		function onUploadError(event) {
			this.progressReport.value = "Upload error.";
		}
</textarea>

<p>When a response is received from the server, display it in the
provided text area:</p>
<textarea name="code" class="js" cols="60" rows="5">
		function onUploadResponse(event) {
			this.serverData = document.getElementById("serverData");
			this.serverData.value = event.data;
		}
	</script>
</textarea>

<h2>Configuration for This Example</h2>

<p>You can load the necessary JavaScript and CSS for this example from Yahoo's servers.  <a href="http://developer.yahoo.com/yui/articles/hosting/?uploader&MIN#configure">Click here to load the YUI Dependency Configurator with all of this example's dependencies preconfigured</a>.</p>

				</div>
				<div class="yui-u">
						<div id="loggerModule" class="yui-skin-sam">
						<h3 class="firstContent">YUI Logger Output:</h3>
								<div id="loggerDiv"></div>
						</div>
					
				
					<div id="examples">
						<h3>Uploader Control (experimental) Examples:</h3>
	
						<div id="exampleToc">
							<ul>
								<li><a href='../uploader/uploader-simple-button.html'>Simple Uploader Example With Button UI</a></li><li class='selected'><a href='../uploader/uploader-advanced-postvars.html'>Advanced Uploader Example With Additional POST Variables and Server Data Return</a></li><li><a href='../uploader/uploader-advanced-queue.html'>Advanced Uploader Example With Transparent UI and Automatic Queue Management</a></li>							</ul>
						</div>
					</div>
					
					<div id="module">
						<h3>More Uploader Control (experimental) Resources:</h3>
						<ul>
							<li><a href="http://developer.yahoo.com/yui/uploader/">User's Guide</a></li>
						<li><a href="../../docs/module_uploader.html">API Documentation</a></li>
                            
                            
							<li><a href="http://yuiblog.com/assets/pdf/cheatsheets/uploader.pdf">Cheat Sheet PDF</a></li></ul>
					</div>
			  </div>
		</div>
		
		</div>
	</div>


	<?php 
	$append = "

<script src='../../assets/YUIexamples.js'></script>

";
	include("../../inc/side.inc");
	include("../../inc/footer.inc");
	?>