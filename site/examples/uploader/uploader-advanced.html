<?php
$prepend = '<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.6.0test/build/button/assets/skins/sam/button.css" />
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0test/build/yuiloader/yuiloader-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0test/build/event/event-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0test/build/dom/dom-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0test/build/element/element-beta-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0test/build/button/button-min.js"></script>

<!--there is no custom header content for this example-->

';
$section="examples";
$highlightSyntax = true;
$assetsDirectory = "assets/";
$releasenotes = false;
$bodyclass = " yui-skin-sam";
$title = "YUI Library Examples: Uploader Control (experimental): Advanced Uploader Example";
include("../../inc/header.inc"); 
?>
		
	
	<div id="yui-main">
		<div class="yui-b">
		  <div class="yui-ge">
			  <div class="yui-u first example">

    
	<div class="promo">
	<h1>Uploader Control (experimental): Advanced Uploader Example</h1>
	
	<div class="exampleIntro">
	<p>In this example, we will pair the <a href="../../uploader/">YUI Uploader Control</a> with the <a href="../../datatable/">DataTable Control</a> to give the user visual feedback on the progress of their file upload. When the user selects multiple files for upload, a DataTable will be populated with the list of files and their sizes. When the user starts the upload process, they'll see progress bars next to each of the files as they upload.</p>

<p><strong>Note:</strong> The YUI Uploader Control requires Flash Player 9.0.45 or higher. The latest version of Flash Player is available at the <a href="http://www.adobe.com/go/getflashplayer">Adobe Flash Player Download Center</a>.</p>
<p><strong>Note:</strong> The YUI Uploader Control requires the uploader.swf Flash file that is distributed as part of the YUI package, in the uploader/assets folder. Copy the uploader.swf to your server and set the YAHOO.Uploader.SWFURL variable to its full path.</p>
			
	</div>	
					
	<div class="example-container module ">
			<div id="example-canvas" class="bd">
	
		
	<!--BEGIN SOURCE CODE FOR EXAMPLE =============================== -->
	
	<p><strong>Note:</strong> This example requires a backend component to receive uploaded files. Download the source for this example below to use on your own server.</p>

<p><a href="assets/uploader-advanced.zip"><strong>Download example source.</strong></a></p>

<p>When you have the example running on your own server, it should look like the screenshot below:</p>

<p><img src="assets/uploader-advanced.jpg" alt="Advanced Uploader Example Screenshot"/></p>
	
	<!--END SOURCE CODE FOR EXAMPLE =============================== -->
	
		
		</div>
		
	
	</div>			
	</div>
		
	<h2 class="first">Using Uploader with the DataTable Control to Handle Multi-file Uploads with Progress Feedback</h2>
<p>Just as we did in the <a href="uploader-simple.html">Simple Example</a>, we start with including all the necessary files. We will need the base YUI files, as well as files specific to the Logger, Uploader, and DataTable.</p>

<textarea name="code" class="html" cols="60" rows="5"><html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>Uploader With DataTable Example</title>
<!-- Required YUI files -->
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.6.0test/build/fonts/fonts-min.css" />
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.6.0test/build/datatable/assets/skins/sam/datatable.css" />
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0test/build/yahoo-dom-event/yahoo-dom-event.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0test/build/element/element-beta.js"></script>

<!-- Required JSON files -->
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0test/build/json/json-min.js"></script>

<!-- Required Datasource and Datatable files -->
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0test/build/datasource/datasource-beta.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0test/build/datatable/datatable-beta.js"></script>

<!-- Main Uploader script -->
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0test/build/uploader/uploader-experimental.js"></script>

<!-- Logger CSS and JS --> 
<link type="text/css" rel="stylesheet" href="http://yui.yahooapis.com/2.6.0test/build/logger/assets/skins/sam/logger.css"> 
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0test/build/logger/logger-min.js"></script>
</head>

<body class="yui-skin-sam">
</textarea>

<p>Next, just as we did in the <a href="uploader-simple.html">Simple Example</a>, we add a container <code>div</code> where the Uploader Control will be placed. If you don't want it to be visible,  feel free to set the size of the container element to <code>height:0; width:0</code> (with <code>overflow:hidden</code>). We also add the &quot;Browse&quot; and &quot;Upload&quot; buttons:</p>

<textarea name="code" class="html" cols="60" rows="5"><h1>Uploader With DataTable Example</h1>

<div id="toBeReplaced" style="width:400px;height:210px">
Unable to load Flash content. You can download the latest version of Flash Player from the 
<a href="http://www.adobe.com/go/getflashplayer">Adobe Flash Player Download Center</a>.
</div>
<input id="browseBtn" name="browse" value="Browse for Images" onclick="browse()" type="button" />
<input id="uploadBtn" name="upload" value="Upload Selected" onclick="upload()" type="button" /></textarea>

<p>We also need to put in one additional placeholder <code>div</code> into which we'll render the DataTable:</p>

<textarea name="code" class="html" cols="60" rows="2"><div id="single" style="margin-top:2em;"></div></textarea>

<p> Next, we initialize the Logger and the Uploader, and place them on the page. We'll also initialize an <code>uploadCounter</code> that we will use to upload the files one at a time, a <code>fileIdHash</code> to keep the record between rows of the DataTable and the file ids, and a <code>dataArr</code> where we'll hold the necessary file information (we'll also use it to instantiate the DataTable). </p>

<textarea name="code" class="JScript" cols="60" rows="5">this.myLogReader = new YAHOO.widget.LogReader();

YAHOO.widget.Uploader.SWFURL = "http://yui.yahooapis.com/2.6.0test/build/uploader/assets/uploader.swf";

var uploader = new YAHOO.widget.Uploader( "toBeReplaced" );
uploader.addListener('fileSelect',onFileSelect);
uploader.addListener('uploadComplete',onUploadComplete);
uploader.addListener('uploadProgress',onUploadProgress);
uploader.addListener('uploadStart',onUploadStart);
var uploadCounter = 0;
var fileIdHash;
var dataArr;</textarea>

<p>In the <code>browse()</code> function, we clear the file list, and call the <code>uploader.browse</code> function, passing <code>true</code> as the first argument (which means the user will be able to select multiple files by holding the Shift button). We also pass the file extension filter array, allowing for three types of image files:</p>

<textarea name="code" class="JScript" cols="60" rows="5">function browse() {
  uploader.clearFileList();
  uploader.browse(true, [{description:"Images", extensions:"*.jpg;*.png;*.gif"}]);
}</textarea>

<p>Once we have received the list of files from the <code>onFileSelect</code> function (defined below), we will call the <code>createDataTable</code> function that will populate our variables, create a new DataSource based on the file list, and create the DataTable to display it:</p>

<textarea name="code" class="JScript" cols="60" rows="5">function createDataTable(entries) {
  rowCounter = 0;
  fileIdHash = [];
  dataArr = [];
  for(var i in entries) {
     var entry = entries[i];
     dataObj = {};

     for (var j in entry) {
        dataObj[j] = entry[j];
     }
     dataArr.push(dataObj);
     fileIdHash[dataObj["id"]] = rowCounter;
     rowCounter++;
  }
  
  this.allData = {data: dataArr};

    var myColumnDefs = [
        {key:"name", label: "File Name", sortable:true},
     {key:"size", label: "Size", sortable:true},
     {key:"progress", label: "Upload progress", sortable:false}
    ];
  this.myDataSource = new YAHOO.util.DataSource(this.allData);
  this.myDataSource.dataType = YAHOO.util.DataSource.TYPE_JSARRAY;
  this.myDataSource.responseType = YAHOO.util.DataSource.TYPE_JSON;
  this.myDataSource.responseSchema = {
        resultsList: "data",
        fields: ["id","name","created","modified","type", "size", "progress"]
  };
  
  this.singleSelectDataTable = new YAHOO.widget.DataTable("single",
           myColumnDefs, this.myDataSource, {
               caption:"Files To Upload",
               selectionMode:"single"
           });
}</textarea>

<p> In the <code>upload</code> function, we initiate the upload of the file that&#39;s indicated by the <code>uploadCounter</code>. The <code>uploadCounter</code> is incremented every time a preceding upload is complete (see <code>onUploadComplete</code> below):</p>

<textarea name="code" class="JScript" cols="60" rows="5">function upload() {
  YAHOO.log(dataArr);
  var idToUpload = dataArr[uploadCounter]["id"];
  uploader.upload(idToUpload, 'YOUR UPLOAD URL HERE');
  document.getElementById('uploadBtn').disabled = true;
}</textarea>

<p>When we receive the <code>uploadProgress</code> event, we need to update the corresponding row of the DataTable. We use a simple HTML horizontal rule as a progress bar and update its width based on the progress of the upload:</p>

<textarea name="code" class="JScript" cols="60" rows="5">function onUploadProgress(event) {
  rowNum = fileIdHash[event["id"]];
  prog = Math.round(100*(event["bytesLoaded"]/event["bytesTotal"]));
  progbar = "<hr style=\"color: #f00; background-color: #f00; text-align:left; margin: 0 auto 0 0; height: 5px; width: " + prog + "px\"/>";
  singleSelectDataTable.updateRow(rowNum, {name: dataArr[rowNum]["name"], size: dataArr[rowNum]["size"], progress: progbar});
}</textarea>

<p>When files are selected, we call <code>createDataTable</code> (described above):</p>

<textarea name="code" class="JScript" cols="60" rows="5">function onFileSelect(event) {
  fileList = event.fileList;
  YAHOO.log(event);
  createDataTable(fileList);
}</textarea>

<p>After the start of each file upload, it may be awhile before the first <code>uploadProgress</code> event comes in. Thus, we want the user know that the upload has started. On the <code>uploadStart</code> event, we update the respective row of the DataTable to reflect that the upload is in progress:</p>

<textarea name="code" class="JScript" cols="60" rows="5">function onUploadStart(event) {
  YAHOO.log(event);
  rowNum = fileIdHash[event["id"]];
  singleSelectDataTable.updateRow(rowNum, {name: dataArr[rowNum]["name"], size: dataArr[rowNum]["size"], progress: "Starting..."});      
}</textarea>

<p>Finally, when the upload is complete, we either initiate the next upload, or, if the <code>uploadCounter</code> has equalized with the number of files, we send an appropriate message to the Logger and halt:</p>

<textarea name="code" class="JScript" cols="60" rows="5">function onUploadComplete(event) {
  YAHOO.log(event);
  rowNum = fileIdHash[event["id"]];
  progbar = "<hr style=\"color: #f00; background-color: #f00; text-align:left; margin: 0 auto 0 0; height: 5px; width: 100px\"/>";
  singleSelectDataTable.updateRow(rowNum, {name: dataArr[rowNum]["name"], size: dataArr[rowNum]["size"], progress: progbar});
  
  if (uploadCounter < dataArr.length - 1) {
     uploadCounter++;
     upload();
  }
  else {
     YAHOO.log("All files uploaded!");
  }
}</textarea>
				</div>
				<div class="yui-u">
					
				
					<div id="examples">
						<h3 class='firstContent'>Uploader Control (experimental) Examples:</h3>
	
						<div id="exampleToc">
							<ul>
								<li><a href='../uploader/uploader-simple.html'>Simple Uploader Example</a></li><li class='selected'><a href='../uploader/uploader-advanced.html'>Advanced Uploader Example</a></li>							</ul>
						</div>
					</div>
					
					<div id="module">
						<h3>More Uploader Control (experimental) Resources:</h3>
						<ul>
							<li><a href="http://developer.yahoo.com/yui/uploader/">User's Guide</a></li>
						<li><a href="../../docs/module_uploader.html">API Documentation</a></li>
                            
                            
							<li><a href="http://yuiblog.com/assets/pdf/cheatsheets/uploader.pdf">Cheat Sheet PDF</a></li></ul>
					</div>
			  </div>
		</div>
		
		</div>
	</div>


	<?php 
	$append = "

<script src='../../assets/YUIexamples.js'></script>

";
	include("../../inc/side.inc");
	include("../../inc/footer.inc");
	?>