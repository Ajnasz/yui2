<?php 
$title="Yahoo! UI Library: JSON utility";
$section="json";
$component="JSON Utility";
$highlightSyntax = true;
$releasenotes = true;
include "../inc/header.inc";
?>

<div id="yui-main">
<div class="yui-b">
  <div class="yui-ge">
      <div class="yui-u first">
	  
	  
<div id="promo" class="component">
  <h1>JSON Utility</h1>
  <p>The JSON Utility is a YUI implementation of <a href="http://json.org">Douglas Crockford's work</a> on JSON (JavaScript Object Notation).  JSON is a safe, efficient, and reliable data interchange format.  The JSON Utility provides methods for working with JSON in JavaScript, providing JSON-to-string and string-to-JSON conversion and validation.</p>

  <div>
    <h4>On This Page:</h4>
    <ul>
      <li><a href="#start">Getting Started</a></li>
      <li><a href="#using">Using lang.JSON</a></li>
      <li><a href="#about">About the JSON format</a></li>
      <li><a href="#support">Support &amp; Community</a></li>
      <li><a href="#filingbugs">Filing Bugs and Feature Requests</a></li>
    </ul>
  </div>

<?php
include('../inc/quicklinks.inc');
?>

</div>

<h2 class="first" id="start">Getting Started</h2>
<p>To use the JSON Utility, include the following source files in your web page with the script tag:</p>
<textarea name="code" class="HTML" cols="60" rows="1">
<!-- Dependencies -->
<script src="http://yui.yahooapis.com/<?php echo($yuiCurrentVersion);?>/build/yahoo/yahoo-min.js"></script>

<!-- Source file -->
<script src="http://yui.yahooapis.com/<?php echo($yuiCurrentVersion);?>/build/json/json-min.js"></script>
</textarea>
<?php
include "../inc/include-notice.inc";
?>

<p><code>YAHOO.lang.JSON</code> is a static class that does not require instantiation. Simply access the methods you need from <code>YAHOO.lang.JSON</code>.</p>

<h2 id="using">Using <code>YAHOO.lang.JSON</code></h2>
<p>The JSON Utility extends <code>YAHOO.lang</code>, providing two static methods used for transforming data to and from JSON string format.  These methods are described in the following sections.</p>

<ul>
    <li><a href="#parse">Parsing JSON strings into JavaScript data</a></li>
    <li><a href="#stringify">Turn JavaScript data into a JSON string</a></li>
</ul>

<h3 id="parse">Parsing JSON string data into JavaScript data</h3>
<p>Pass a JSON string to <code>YAHOO.lang.JSON.parse</code> to convert the JSON string into live data. Optionally provide a second argument to filter or format the parsed object data en route.</p>

<textarea name="code" class="JScript" rows="1" cols="60">
var jsonString = '{"productId":1234,"price":24.5,"inStock":true,"bananas":null}';

// Parsing JSON strings can throw a SyntaxError exception, so we wrap the call
// in a try catch block
try {
    var prod = YAHOO.lang.JSON.parse(jsonString);
}
catch (e) {
    alert("Invalid product data");
}

// We can now interact with the data
if (prod.price < 25) {
    prod.price += 10; // Price increase!
}
</textarea>

<p>You can filter out data or format data during parse by passing a function as the second argument to parse.  Values returned from the function will take the place of the original value.  Return undefined to omit a key:value pair from the returned object.</p>
<textarea name="code" class="JScript" rows="1" cols="60">
var currencySymbol = "$"
function myFilter(key,val) {
    // format price as a string
    if (key == "price") {
        var f_price = currencySymbol + (val % 1 ? val + "0" : val + ".00");
        return f_price.substr(0,f_price.indexOf('.') + 3);
    }

    // omit keys by returning undefined
    if (key == "bananas") {
        return undefined;
    }
}

var formattedProd = YAHOO.lang.JSON.parse(jsonString, myFilter);

// key "bananas" is not present in the formattedProd object
if (YAHOO.lang.isUndefined(formattedProd.bananas)) {
    alert("We have no bananas today");
}

// and the price is the formatted string "$24.50"
alert("Your price: " + formattedProd.price)
</textarea>

<h4>A word of caution against using <code>eval</code></h4>
<p>JSON data format is a <em>subset</em> of JavaScript notation, meaning that it is possible to use JavaScript <code>eval</code> to transform JSON data to live data.  However, it is unsafe practice to assume that data reaching your code is safe.  <code>eval</code> is capable of executing JavaScript's full notation, including calling functions and accessing cookies with all the privileges of a <code>&lt;script&gt;</code>.  To ensure that the data is safe, <code>YAHOO.lang.JSON.parse</code> inspects the incoming string (using methods derived from Douglas Crockford's <a href="http://json.org/json2.js">json2.js</a>) and verifies it as valid JSON before giving it the green light to parse.</p>

<textarea name="code" class="JScript" rows="1" cols="60">
// Potentially UNSAFE
var data = eval('(' + shouldBeJsonData + ')');

// Safe
var data = YAHOO.lang.JSON.parse(shouldBeJsonData);
</textarea>

<h3 id="stringify">Stringifying JavaScript data into a JSON string</h3>
<p>To convert a JavaScript object (or any permissable value) to a JSON string, pass that object to <code>YAHOO.lang.JSON.stringify</code> and capture the returned string.  Note that cyclical references will be converted to <code>null</code>.</p>

<textarea name="code" class="JScript" rows="1" cols="60">
var myData = {
    puppies : [
        { name: "Ashley", age: 12 },
        { name: "Abby", age:9 }
    ]
}; 

var jsonStr = YAHOO.lang.JSON.stringify(myData);

// jsonStr now contains the string (without the leading comment slashes)
// {"puppies":[{"name":"Ashley","age":12},{"name":"Abby","age":9}]}

// Create a cyclical reference
myData["puppies"][0]["NEWKEY"] = myData;

jsonStr = YAHOO.lang.JSON.stringify(myData);
// jsonStr now contains the string (without the leading comment slashes)
// {"puppies":[{"name":"Ashley","age":12,"NEWKEY":null},{"name":"Abby","age":9}]}
</textarea>

<p>Additionally, <code>stringify</code> supports optional whitelist and depth-limit parameters.</p>

<textarea name="code" class="JScript" rows="1" cols="60">
// a detailed object record set
var records = [
    {id:1, name: "Bob",   age: 47, favorite_color: "blue"},
    {id:2, name: "Sally", age: 30, favorite_color: "mauve"},
    {id:3, name: "Tommy", age: 13, favorite_color: "black"},
    {id:4, name: "Chaz",  age: 26, favorite_color: "plaid"}
];

// Use an array of acceptable object key names as a whitelist.
// To create a JSON string with only age and id
var jsonStr = YAHOO.lang.JSON.stringify(records,["id","age"]);

// jsonStr now contains the string
// [{"id":1,"age":47},{"id":2,"age":30},{"id":3,"age":13},{"id":4,"age":26}]


// A deeply nested structure
var deep = {
    name : "Level 1",
    children : {
        name : "Level 2",
        children : {
            name : "Level 3",
            children : {
                name : "Level 4",
                children : {
                    name : "Level 5",
                    children : {}
                }
            }
        },
        enough : true
    }
};

// Stop at Level 2
var jsonStr = YAHOO.lang.JSON.stringify(deep,null,2);

// jsonStr contains no content for the children object at Level 2
// {"name":"Level 1","children":{"name":"Level 2","children":{},"enough":true}}
</textarea>

<h2 id="about">About the JSON format</h2>
<p>JSON is a lightweight data format based on the object notation of the JavaScript language. It does not require JavaScript to read or write; it is easy to parse by any language and libraries and tools exist in many languages to handle JSON.  You'll find several examples of support for JSON data in the YUI Library.</p>

<p>There is a wealth of good information about JSON and its distinction from XML as a data interchange format at Douglas Crockford's site, <a href="http://json.org">JSON.org</a>.

<p>JSON data is characterized as a collection of objects, arrays, booleans, strings, numbers, and null. The notation follows these guidelines:</p>
<ul>
    <li>Objects begin and end with curly braces ({}).</li>
    <li>Object members consist of a string key and an associated value separated by a colon ( "key" : VALUE ).</li>
    <li>Objects may contain any number of members, separated by commas ({ "key1" : VALUE1, "key2" : VALUE2 }).</li>
    <li>Arrays begin and end with square braces and contain any number of values, separated by commas ([ VALUE1, VALUE2 ]).</li>
    <li>Values can be a string, a number, an object, an array, or the literals <code>true</code>, <code>false</code>, and <code>null</code>.</li>
    <li>Strings are surrounded by double quotes and can contain Unicode characters and common backslash escapes ("new\nline").</li>
</ul>

<p><a href="http://json.org/">JSON.org</a> has helpful format diagrams and specific information on allowable string characters.</p>

<p>Here is a simple example of a valid JSON string:</p>
<textarea name="code" class="JScript" rows="1" cols="60">
{
  "Image": {
    "Width":800,
    "Height":600,
    "Title":"View from 15th Floor",
    "Thumbnail":
    {
      "Url":"http:\/\/scd.mm-b1.yimg.com\/image\/481989943",
      "Height": 125,
      "Width": "100"
    },
    "IDs":[ 116, 943, 234, 38793 ]
  }
}
</textarea>

<p>This structure should look familiar to JavaScript programmers (for good reason).  Note, however the solidus (forward slash) characters in the &quot;Url&quot; value are escaped.</p>

<?php include "../inc/mobileSection.inc";?>
<p>There are no known concerns with the JSON Utility on mobile browsers at this time.</p>

<?php 
include "../inc/support.inc";
?>

		</div>
         <div class="yui-u">
			<div id="cheatsheet">
				<h3><?php echo $component;?> Cheat Sheet:</h3>
				
				<a href="http://yuiblog.com/assets/pdf/cheatsheets/<?php echo $section;?>.pdf"><img src="http://us.i1.yimg.com/us.yimg.com/i/ydn/yuiweb/img/cheatsheet-images/<?php echo $section;?>.gif" width="178" height="135" alt="Cheat Sheet for the <?php echo $component;?>."></a>
				
				<p><a href="/yui/docs/assets/cheatsheets.zip">Download full set of cheat sheets.</a></p>
			</div>
		 	
			<div id="examples">
<?php 
	include("../inc/examplesNav/".$section.".inc");
?>
		   </div>
		   
<?php 
$thisURI="http://developer.yahoo.com/yui/json/";
require_once('../inc/badge.inc');
?>
<h3 id="delicious">YUI JSON Utility on del.icio.us:</h3>
<div class="delicious">
<?php require('../inc/badge-html.inc'); ?>
</div>

		 </div>
      </div>

</div>
</div>

<?php include "../inc/side.inc" ?>
<?php include "../inc/footer.inc" ?>


